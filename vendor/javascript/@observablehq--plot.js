// @observablehq/plot@0.6.17 downloaded from https://ga.jspm.io/npm:@observablehq/plot@0.6.17/src/index.js

import{ascending as e,descending as t,timeSecond as n,timeMinute as r,timeHour as o,timeDay as a,timeMonday as i,timeTuesday as l,timeWednesday as s,timeThursday as c,timeFriday as u,timeSaturday as f,timeSunday as d,timeWeek as p,timeMonth as h,timeYear as m,utcSecond as y,utcMinute as g,utcHour as b,unixDay as x,utcMonday as w,utcTuesday as k,utcWednesday as S,utcThursday as A,utcFriday as $,utcSaturday as M,utcSunday as T,utcWeek as C,utcMonth as O,utcYear as I,bisector as L,timeFormat as N,utcFormat as R,max as z,pairs as D,quantile as E,range as F,symbolAsterisk as Y,symbolCircle as X,symbolCross as B,symbolDiamond as j,symbolDiamond2 as W,symbolPlus as P,symbolSquare as V,symbolSquare2 as q,symbolStar as G,symbolTimes as _,symbolTriangle as H,symbolTriangle2 as Z,symbolWye as K,randomLcg as U,group as Q,mode as J,variance as ee,median as te,mean as ne,maxIndex as re,minIndex as oe,min as ae,deviation as ie,sort as le,rollup as se,sum as ce,InternSet as ue,rollups as fe,schemeAccent as de,schemeCategory10 as pe,schemeDark2 as he,schemeObservable10 as me,schemePaired as ye,schemePastel1 as ge,schemePastel2 as be,schemeSet1 as ve,schemeSet2 as xe,schemeSet3 as we,schemeTableau10 as ke,schemeBrBG as Se,interpolateBrBG as Ae,schemePRGn as $e,interpolatePRGn as Me,schemePiYG as Te,interpolatePiYG as Ce,schemePuOr as Oe,interpolatePuOr as Ie,schemeRdBu as Le,interpolateRdBu as Ne,schemeRdGy as Re,interpolateRdGy as ze,schemeRdYlBu as De,interpolateRdYlBu as Ee,schemeRdYlGn as Fe,interpolateRdYlGn as Ye,schemeSpectral as Xe,interpolateSpectral as Be,schemeBlues as je,interpolateBlues as We,schemeGreens as Pe,interpolateGreens as Ve,schemeGreys as qe,interpolateGreys as Ge,schemeOranges as _e,interpolateOranges as He,schemePurples as Ze,interpolatePurples as Ke,schemeReds as Ue,interpolateReds as Qe,interpolateTurbo as Je,interpolateViridis as et,interpolateMagma as tt,interpolateInferno as nt,interpolatePlasma as rt,interpolateCividis as ot,interpolateCubehelixDefault as at,interpolateWarm as lt,interpolateCool as st,schemeBuGn as ct,interpolateBuGn as ut,schemeBuPu as ft,interpolateBuPu as dt,schemeGnBu as pt,interpolateGnBu as ht,schemeOrRd as mt,interpolateOrRd as yt,schemePuBu as gt,interpolatePuBu as bt,schemePuBuGn as vt,interpolatePuBuGn as xt,schemePuRd as wt,interpolatePuRd as kt,schemeRdPu as St,interpolateRdPu as At,schemeYlGn as $t,interpolateYlGn as Mt,schemeYlGnBu as Tt,interpolateYlGnBu as Ct,schemeYlOrBr as Ot,interpolateYlOrBr as It,schemeYlOrRd as Lt,interpolateYlOrRd as Nt,interpolateRainbow as Rt,interpolateSinebow as zt,quantize as Dt,interpolateNumber as Et,interpolateRgb as Ft,interpolateHsl as Yt,interpolateHcl as Xt,interpolateLab as Bt,interpolateRound as jt,piecewise as Wt,extent as Pt,reverse as Vt,scaleLinear as Gt,scalePow as _t,scaleLog as Ht,scaleSymlog as Zt,scaleQuantile as Kt,ticks as Ut,scaleThreshold as Qt,scaleIdentity as Jt,scaleDiverging as en,scaleDivergingPow as tn,scaleDivergingLog as nn,scaleDivergingSymlog as rn,scaleTime as on,scaleUtc as an,scaleImplicit as ln,scaleOrdinal as sn,scalePoint as cn,scaleBand as un,symbolsStroke as fn,symbolsFill as dn,cross as pn,InternMap as hn,geoPath as mn,geoTransform as yn,geoTransverseMercator as gn,geoStereographic as bn,geoOrthographic as vn,geoMercator as xn,geoGnomonic as wn,geoEquirectangular as kn,geoEqualEarth as Sn,geoConicEquidistant as An,geoConicEqualArea as $n,geoConicConformal as Mn,geoAzimuthalEquidistant as Tn,geoAzimuthalEqualArea as Cn,geoAlbers as On,geoAlbersUsa as In,geoClipRectangle as Ln,geoStream as Nn,select as Rn,creator as zn,namespaces as Dn,pointer as En,format as Fn,axisBottom as Yn,pathRound as Xn,rgb as Bn,cumsum as jn,groupSort as Wn,greatest as Pn,curveBasis as Vn,curveBasisClosed as qn,curveBasisOpen as Gn,curveBundle as _n,curveBumpX as Hn,curveBumpY as Zn,curveCardinal as Kn,curveCardinalClosed as Un,curveCardinalOpen as Qn,curveCatmullRom as Jn,curveCatmullRomClosed as er,curveCatmullRomOpen as tr,curveLinear as nr,curveLinearClosed as rr,curveMonotoneX as or,curveMonotoneY as ar,curveNatural as ir,curveStep as lr,curveStepAfter as sr,curveStepBefore as cr,utcTickInterval as ur,tickIncrement as fr,thresholdSturges as dr,thresholdScott as pr,thresholdFreedmanDiaconis as hr,bisect as mr,area as yr,line as gr,rank as br,count as vr,blurImage as xr,Delaunay as wr,blur2 as kr,contours as Sr,nice as Ar,contourDensity as $r,geoCentroid as Mr,geoGraticule10 as Tr,stratify as Cr,tree as Or,cluster as Ir,least as Lr}from"d3";import{parse as Nr,format as Rr}from"isoformat";import zr from"interval-tree-1d";function defined(e){return e!=null&&!Number.isNaN(e)}function ascendingDefined(t,n){return+defined(n)-+defined(t)||e(t,n)}function descendingDefined(e,n){return+defined(n)-+defined(e)||t(e,n)}function nonempty(e){return e!=null&&`${e}`!==""}function finite$1(e){return isFinite(e)?e:NaN}function positive(e){return e>0&&isFinite(e)?e:NaN}function negative(e){return e<0&&isFinite(e)?e:NaN}function orderof(e){if(e==null)return;const n=e[0];const r=e[e.length-1];return t(n,r)}const Dr=1e3;const Er=Dr*60;const Fr=Er*60;const Yr=Fr*24;const Xr=Yr*7;const Br=Yr*30;const jr=Yr*365;const Wr=[["millisecond",1],["2 milliseconds",2],["5 milliseconds",5],["10 milliseconds",10],["20 milliseconds",20],["50 milliseconds",50],["100 milliseconds",100],["200 milliseconds",200],["500 milliseconds",500],["second",Dr],["5 seconds",5*Dr],["15 seconds",15*Dr],["30 seconds",30*Dr],["minute",Er],["5 minutes",5*Er],["15 minutes",15*Er],["30 minutes",30*Er],["hour",Fr],["3 hours",3*Fr],["6 hours",6*Fr],["12 hours",12*Fr],["day",Yr],["2 days",2*Yr],["week",Xr],["2 weeks",2*Xr],["month",Br],["3 months",3*Br],["6 months",6*Br],["year",jr],["2 years",2*jr],["5 years",5*jr],["10 years",10*jr],["20 years",20*jr],["50 years",50*jr],["100 years",100*jr]];const Pr=new Map([["second",Dr],["minute",Er],["hour",Fr],["day",Yr],["monday",Xr],["tuesday",Xr],["wednesday",Xr],["thursday",Xr],["friday",Xr],["saturday",Xr],["sunday",Xr],["week",Xr],["month",Br],["year",jr]]);const Vr=new Map([["second",n],["minute",r],["hour",o],["day",a],["monday",i],["tuesday",l],["wednesday",s],["thursday",c],["friday",u],["saturday",f],["sunday",d],["week",p],["month",h],["year",m]]);const qr=new Map([["second",y],["minute",g],["hour",b],["day",x],["monday",w],["tuesday",k],["wednesday",S],["thursday",A],["friday",$],["saturday",M],["sunday",T],["week",C],["month",O],["year",I]]);const Gr=Symbol("intervalDuration");const _r=Symbol("intervalType");for(const[e,t]of Vr){t[Gr]=Pr.get(e);t[_r]="time"}for(const[e,t]of qr){t[Gr]=Pr.get(e);t[_r]="utc"}const Hr=[["year",I,"utc"],["month",O,"utc"],["day",x,"utc",6*Br],["hour",b,"utc",3*Yr],["minute",g,"utc",6*Fr],["second",y,"utc",30*Er]];const Zr=[["year",m,"time"],["month",h,"time"],["day",a,"time",6*Br],["hour",o,"time",3*Yr],["minute",r,"time",6*Fr],["second",n,"time",30*Er]];const Kr=[Hr[0],Zr[0],Hr[1],Zr[1],Hr[2],Zr[2],...Hr.slice(3)];function parseTimeInterval(e){let t=`${e}`.toLowerCase();t.endsWith("s")&&(t=t.slice(0,-1));let n=1;const r=/^(?:(\d+)\s+)/.exec(t);if(r){t=t.slice(r[0].length);n=+r[1]}switch(t){case"quarter":t="month";n*=3;break;case"half":t="month";n*=6;break}let o=qr.get(t);if(!o)throw new Error(`unknown interval: ${e}`);if(n>1&&!o.every)throw new Error(`non-periodic interval: ${t}`);return[t,n]}function timeInterval(e){return asInterval(parseTimeInterval(e),"time")}function utcInterval(e){return asInterval(parseTimeInterval(e),"utc")}function asInterval([e,t],n){let r=(n==="time"?Vr:qr).get(e);if(t>1){r=r.every(t);r[Gr]=Pr.get(e)*t;r[_r]=n}return r}function generalizeTimeInterval(e,t){if(!(t>1))return;const n=e[Gr];if(!Wr.some((([,e])=>e===n)))return;if(n%Yr===0&&Yr<n&&n<Br)return;const[r]=Wr[L((([,e])=>Math.log(e))).center(Wr,Math.log(n*t))];return(e[_r]==="time"?timeInterval:utcInterval)(r)}function formatTimeInterval(e,t,n){const r=t==="time"?N:R;if(n==null)return r(e==="year"?"%Y":e==="month"?"%Y-%m":e==="day"?"%Y-%m-%d":e==="hour"||e==="minute"?"%Y-%m-%dT%H:%M":e==="second"?"%Y-%m-%dT%H:%M:%S":"%Y-%m-%dT%H:%M:%S.%L");const o=getTimeTemplate(n);switch(e){case"millisecond":return formatConditional(r(".%L"),r(":%M:%S"),o);case"second":return formatConditional(r(":%S"),r("%-I:%M"),o);case"minute":return formatConditional(r("%-I:%M"),r("%p"),o);case"hour":return formatConditional(r("%-I %p"),r("%b %-d"),o);case"day":return formatConditional(r("%-d"),r("%b"),o);case"month":return formatConditional(r("%b"),r("%Y"),o);case"year":return r("%Y")}throw new Error("unable to format time ticks")}function getTimeTemplate(e){return e==="left"||e==="right"?(e,t)=>`\n${e}\n${t}`:e==="top"?(e,t)=>`${t}\n${e}`:(e,t)=>`${e}\n${t}`}function getFormatIntervals(e){return e==="time"?Zr:e==="utc"?Hr:Kr}function inferTimeFormat(e,t,n){const r=z(D(t,((e,t)=>Math.abs(t-e))));if(r<1e3)return formatTimeInterval("millisecond","utc",n);for(const[o,a,i,l]of getFormatIntervals(e)){if(r>l)break;if(o==="hour"&&!r)break;if(t.every((e=>a.floor(e)>=e)))return formatTimeInterval(o,i,n)}}function formatConditional(e,t,n){return(r,o,a)=>{const i=e(r,o);const l=t(r,o);const s=o-orderof(a);return o!==s&&a[s]!==void 0&&l===t(a[s],s)?i:n(i,l)}}const Ur=Object.getPrototypeOf(Uint8Array);const Qr=Object.prototype.toString;function isArray(e){return e instanceof Array||e instanceof Ur}function isNumberArray(e){return e instanceof Ur&&!isBigIntArray(e)}function isNumberType(e){return e?.prototype instanceof Ur&&!isBigIntType(e)}function isBigIntArray(e){return e instanceof BigInt64Array||e instanceof BigUint64Array}function isBigIntType(e){return e===BigInt64Array||e===BigUint64Array}const Jr=Symbol("reindex");function valueof(e,t,n){const r=typeof t;return r==="string"?isArrowTable(e)?maybeTypedArrowify(e.getChild(t),n):maybeTypedMap(e,field(t),n):r==="function"?maybeTypedMap(e,t,n):r==="number"||t instanceof Date||r==="boolean"?map$1(e,constant(t),n):typeof t?.transform==="function"?maybeTypedArrayify(t.transform(e),n):maybeTake(maybeTypedArrayify(t,n),e?.[Jr])}function maybeTake(e,t){return e!=null&&t?take(e,t):e}function maybeTypedMap(e,t,n){return map$1(e,isNumberType(n)?(e,n)=>coerceNumber(t(e,n)):t,n)}function maybeTypedArrayify(e,t){return t===void 0?arrayify(e):isArrowVector(e)?maybeTypedArrowify(e,t):e instanceof t?e:t.from(e,isNumberType(t)&&!isNumberArray(e)?coerceNumber:void 0)}function maybeTypedArrowify(e,t){return e==null?e:t!==void 0&&t!==Array||!isArrowDateType(e.type)?maybeTypedArrayify(vectorToArray(e),t):coerceDates(vectorToArray(e))}function vectorToArray(e){return e.nullCount?e.toJSON():e.toArray()}const eo=[null];const field=e=>t=>{const n=t[e];return n===void 0&&t.type==="Feature"?t.properties?.[e]:n};const to={transform:range};const no={transform:e=>e};const one=()=>1;const yes=()=>true;const string=e=>e==null?e:`${e}`;const number$1=e=>e==null?e:+e;const first=e=>e?e[0]:void 0;const second=e=>e?e[1]:void 0;const third=e=>e?e[2]:void 0;const constant=e=>()=>e;function percentile(e){const t=+`${e}`.slice(1)/100;return(e,n)=>E(e,t,n)}function coerceNumbers(e){return isNumberArray(e)?e:map$1(e,coerceNumber,Float64Array)}function coerceNumber(e){return e==null?NaN:Number(e)}function coerceDates(e){return map$1(e,coerceDate)}function coerceDate(e){return e instanceof Date&&!isNaN(e)?e:typeof e==="string"?Nr(e):e==null||isNaN(e=Number(e))?void 0:new Date(e)}function maybeColorChannel(e,t){e===void 0&&(e=t);return e===null?[void 0,"none"]:isColor(e)?[void 0,e]:[e,void 0]}function maybeNumberChannel(e,t){e===void 0&&(e=t);return e===null||typeof e==="number"?[void 0,e]:[e,void 0]}function maybeKeyword(e,t,n){if(e!=null)return keyword(e,t,n)}function keyword(e,t,n){const r=`${e}`.toLowerCase();if(!n.includes(r))throw new Error(`invalid ${t}: ${e}`);return r}function dataify(e){return isArrowTable(e)?e:arrayify(e)}function arrayify(e){if(e==null||isArray(e))return e;if(isArrowVector(e))return maybeTypedArrowify(e);if(isGeoJSON(e))switch(e.type){case"FeatureCollection":return e.features;case"GeometryCollection":return e.geometries;default:return[e]}return Array.from(e)}function isGeoJSON(e){switch(e?.type){case"FeatureCollection":case"GeometryCollection":case"Feature":case"LineString":case"MultiLineString":case"MultiPoint":case"MultiPolygon":case"Point":case"Polygon":case"Sphere":return true;default:return false}}function map$1(e,t,n=Array){return e==null?e:e instanceof n?e.map(t):n.from(e,t)}function slice(e,t=Array){return e instanceof t?e.slice():t.from(e)}function hasX({x:e,x1:t,x2:n}){return e!==void 0||t!==void 0||n!==void 0}function hasY({y:e,y1:t,y2:n}){return e!==void 0||t!==void 0||n!==void 0}function hasXY(e){return hasX(e)||hasY(e)||e.interval!==void 0}function isObject(e){return e?.toString===Qr}function isScaleOptions(e){return isObject(e)&&(e.type!==void 0||e.domain!==void 0)}function isOptions(e){return isObject(e)&&typeof e.transform!=="function"}function isDomainSort(e){return isOptions(e)&&e.value===void 0&&e.channel===void 0}function maybeZero(e,t,n,r=no){t===void 0&&n===void 0?(t=0,n=e===void 0?r:e):t===void 0?t=e===void 0?0:e:n===void 0&&(n=e===void 0?0:e);return[t,n]}function maybeTuple(e,t){return e===void 0&&t===void 0?[first,second]:[e,t]}function maybeZ({z:e,fill:t,stroke:n}={}){e===void 0&&([e]=maybeColorChannel(t));e===void 0&&([e]=maybeColorChannel(n));return e}function lengthof(e){return isArray(e)?e.length:e?.numRows}function range(e){const t=lengthof(e);const n=new Uint32Array(t);for(let e=0;e<t;++e)n[e]=e;return n}function take(e,t){return isArray(e)?map$1(t,(t=>e[t]),e.constructor):map$1(t,(t=>e.at(t)))}function taker(e){return e.length===1?(t,n)=>e(take(n,t)):e}function subarray(e,t,n){return e.subarray?e.subarray(t,n):e.slice(t,n)}function keyof(e){return e!==null&&typeof e==="object"?e.valueOf():e}function maybeInput(e,t){if(t[e]!==void 0)return t[e];switch(e){case"x1":case"x2":e="x";break;case"y1":case"y2":e="y";break}return t[e]}function column(e){let t;return[{transform:()=>t,label:labelof(e)},e=>t=e]}function maybeColumn(e){return e==null?[e]:column(e)}function labelof(e,t){return typeof e==="string"?e:e&&e.label!==void 0?e.label:t}function mid(e,t){return{transform(n){const r=e.transform(n);const o=t.transform(n);return isTemporal(r)||isTemporal(o)?map$1(r,((e,t)=>new Date((+r[t]+ +o[t])/2))):map$1(r,((e,t)=>(+r[t]+ +o[t])/2),Float64Array)},label:e.label}}function maybeApplyInterval(e,t){const n=maybeIntervalTransform(t?.interval,t?.type);return n?map$1(e,n):e}function maybeIntervalTransform(e,t){const n=maybeInterval(e,t);return n&&(e=>defined(e)?n.floor(e):e)}function maybeInterval(e,t){if(e!=null){if(typeof e==="number")return numberInterval(e);if(typeof e==="string")return(t==="time"?timeInterval:utcInterval)(e);if(typeof e.floor!=="function")throw new Error("invalid interval; missing floor method");if(typeof e.offset!=="function")throw new Error("invalid interval; missing offset method");return e}}function numberInterval(e){e=+e;0<e&&e<1&&Number.isInteger(1/e)&&(e=-1/e);const t=Math.abs(e);return e<0?{floor:e=>Math.floor(e*t)/t,offset:(e,n=1)=>(e*t+Math.floor(n))/t,range:(e,n)=>F(Math.ceil(e*t),n*t).map((e=>e/t))}:{floor:e=>Math.floor(e/t)*t,offset:(e,n=1)=>e+t*Math.floor(n),range:(e,n)=>F(Math.ceil(e/t),n/t).map((e=>e*t))}}function maybeRangeInterval(e,t){e=maybeInterval(e,t);if(e&&typeof e.range!=="function")throw new Error("invalid interval: missing range method");return e}function maybeNiceInterval(e,t){e=maybeRangeInterval(e,t);if(e&&typeof e.ceil!=="function")throw new Error("invalid interval: missing ceil method");return e}function isTimeInterval(e){return isInterval(e)&&typeof e?.floor==="function"&&e.floor()instanceof Date}function isInterval(e){return typeof e?.range==="function"}function maybeValue(e){return e===void 0||isOptions(e)?e:{value:e}}function numberChannel(e){return e==null?null:{transform:t=>valueof(t,e,Float64Array),label:labelof(e)}}function isTuples(e){if(!isIterable(e))return false;for(const t of e)if(t!=null)return typeof t==="object"&&"0"in t&&"1"in t}function isIterable(e){return e&&typeof e[Symbol.iterator]==="function"}function isTextual(e){for(const t of e)if(t!=null)return typeof t!=="object"||t instanceof Date}function isOrdinal(e){for(const t of e){if(t==null)continue;const e=typeof t;return e==="string"||e==="boolean"}}function isTemporal(e){for(const t of e)if(t!=null)return t instanceof Date}function isTemporalString(e){for(const t of e)if(t!=null)return typeof t==="string"&&isNaN(t)&&Nr(t)}function isNumericString(e){for(const t of e)if(t!=null){if(typeof t!=="string")return false;if(t.trim())return!isNaN(t)}}function isNumeric(e){for(const t of e)if(t!=null)return typeof t==="number"}function isEvery(e,t){let n;for(const r of e)if(r!=null){if(!t(r))return false;n=true}return n}const ro=new Set("none,currentcolor,transparent,aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow".split(","));function isColor(e){if(typeof e!=="string")return false;e=e.toLowerCase().trim();return/^#[0-9a-f]{3,8}$/.test(e)||/^(?:url|var|rgb|rgba|hsl|hsla|hwb|lab|lch|oklab|oklch|color|color-mix)\(.*\)$/.test(e)||ro.has(e)}function isOpacity(e){return typeof e==="number"&&(0<=e&&e<=1||isNaN(e))}function isNoneish(e){return e==null||isNone(e)}function isNone(e){return/^\s*none\s*$/i.test(e)}function isRound(e){return/^\s*round\s*$/i.test(e)}function maybeAnchor$3(e,t){return maybeKeyword(e,t,["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function maybeFrameAnchor(e="middle"){return maybeAnchor$3(e,"frameAnchor")}function inherit(e={},...t){let n=e;for(const r of t)for(const t in r)if(n[t]===void 0){const o=r[t];n===e?n={...n,[t]:o}:n[t]=o}return n}function named(e){console.warn("named iterables are deprecated; please use an object instead");const t=new Set;return Object.fromEntries(Array.from(e,(e=>{const{name:n}=e;if(n==null)throw new Error("missing name");const r=`${n}`;if(r==="__proto__")throw new Error(`illegal name: ${r}`);if(t.has(r))throw new Error(`duplicate name: ${r}`);t.add(r);return[n,e]})))}function maybeNamed(e){return isIterable(e)?named(e):e}function maybeClip(e){if(e===true)e="frame";else if(e===false)e=null;else if(!isGeoJSON(e)&&e!=null){e=keyword(e,"clip",["frame","sphere"]);e==="sphere"&&(e={type:"Sphere"})}return e}function isArrowTable(e){return e&&typeof e.getChild==="function"&&typeof e.toArray==="function"&&e.schema&&Array.isArray(e.schema.fields)}function isArrowVector(e){return e&&typeof e.toArray==="function"&&e.type}function isArrowDateType(e){return e&&(e.typeId===8||e.typeId===10)&&e.unit===1}const oo=Symbol("position");const ao=Symbol("color");const io=Symbol("radius");const lo=Symbol("length");const so=Symbol("opacity");const co=Symbol("symbol");const uo=Symbol("projection");const fo=new Map([["x",oo],["y",oo],["fx",oo],["fy",oo],["r",io],["color",ao],["opacity",so],["symbol",co],["length",lo],["projection",uo]]);function isPosition(e){return e===oo||e===uo}function hasNumericRange(e){return e===oo||e===io||e===lo||e===so}const po=Math.sqrt(3);const ho=2/po;const mo={draw(e,t){const n=Math.sqrt(t/Math.PI),r=n*ho,o=r/2;e.moveTo(0,r);e.lineTo(n,o);e.lineTo(n,-o);e.lineTo(0,-r);e.lineTo(-n,-o);e.lineTo(-n,o);e.closePath()}};const yo=new Map([["asterisk",Y],["circle",X],["cross",B],["diamond",j],["diamond2",W],["hexagon",mo],["plus",P],["square",V],["square2",q],["star",G],["times",_],["triangle",H],["triangle2",Z],["wye",K]]);function isSymbolObject(e){return e&&typeof e.draw==="function"}function isSymbol(e){return!!isSymbolObject(e)||typeof e==="string"&&yo.has(e.toLowerCase())}function maybeSymbol(e){if(e==null||isSymbolObject(e))return e;const t=yo.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function maybeSymbolChannel(e){if(e==null||isSymbolObject(e))return[void 0,e];if(typeof e==="string"){const t=yo.get(`${e}`.toLowerCase());if(t)return[void 0,t]}return[e,void 0]}function basic({filter:e,sort:t,reverse:n,transform:r,initializer:o,...a}={},i){if(r===void 0){e!=null&&(r=filterTransform(e));t==null||isDomainSort(t)||(r=composeTransform(r,sortTransform(t)));n&&(r=composeTransform(r,reverseTransform))}if(i!=null&&o!=null)throw new Error("transforms cannot be applied after initializers");return{...a,...(t===null||isDomainSort(t))&&{sort:t},transform:composeTransform(r,i)}}function initializer({filter:e,sort:t,reverse:n,initializer:r,...o}={},a){if(r===void 0){e!=null&&(r=filterTransform(e));t==null||isDomainSort(t)||(r=composeInitializer(r,sortTransform(t)));n&&(r=composeInitializer(r,reverseTransform))}return{...o,...(t===null||isDomainSort(t))&&{sort:t},initializer:composeInitializer(r,a)}}function composeTransform(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(n,r,o){({data:n,facets:r}=e.call(this,n,r,o));return t.call(this,dataify(n),r,o)}}function composeInitializer(e,t){return e==null?t===null?void 0:t:t==null?e===null?void 0:e:function(n,r,o,...a){let i,l,s,c,u,f;({data:l=n,facets:s=r,channels:i}=e.call(this,n,r,o,...a));({data:u=l,facets:f=s,channels:c}=t.call(this,l,s,{...o,...i},...a));return{data:u,facets:f,channels:{...i,...c}}}}function apply(e,t){return(e.initializer!=null?initializer:basic)(e,t)}function filter(e,t){return apply(t,filterTransform(e))}function filterTransform(e){return(t,n)=>{const r=valueof(t,e);return{data:t,facets:n.map((e=>e.filter((e=>r[e]))))}}}function reverse({sort:e,...t}={}){return{...apply(t,reverseTransform),sort:isDomainSort(e)?e:null}}function reverseTransform(e,t){return{data:e,facets:t.map((e=>e.slice().reverse()))}}function shuffle({seed:e,sort:t,...n}={}){return{...apply(n,sortValue(e==null?Math.random:U(e))),sort:isDomainSort(t)?t:null}}function sort(e,{sort:t,...n}={}){return{...(isOptions(e)&&e.channel!==void 0?initializer:apply)(n,sortTransform(e)),sort:isDomainSort(t)?t:null}}function sortTransform(e){return(typeof e==="function"&&e.length!==1?sortData:sortValue)(e)}function sortData(e){return(t,n)=>{const r=isArray(t)?(n,r)=>e(t[n],t[r]):(n,r)=>e(t.get(n),t.get(r));return{data:t,facets:n.map((e=>e.slice().sort(r)))}}}function sortValue(e){let t,n;({channel:t,value:e,order:n}={...maybeValue(e)});const r=t?.startsWith("-");r&&(t=t.slice(1));n===void 0&&(n=r?descendingDefined:ascendingDefined);if(typeof n!=="function")switch(`${n}`.toLowerCase()){case"ascending":n=ascendingDefined;break;case"descending":n=descendingDefined;break;default:throw new Error(`invalid order: ${n}`)}return(r,o,a)=>{let i;if(t===void 0)i=valueof(r,e);else{if(a===void 0)throw new Error("channel sort requires an initializer");i=a[t];if(!i)return{};i=i.value}const compareValue=(e,t)=>n(i[e],i[t]);return{data:r,facets:o.map((e=>e.slice().sort(compareValue)))}}}function groupZ$1(e,t){return groupn(null,null,e,t)}function groupX(e={y:"count"},t={}){const{x:n=no}=t;if(n==null)throw new Error("missing channel: x");return groupn(n,null,e,t)}function groupY(e={x:"count"},t={}){const{y:n=no}=t;if(n==null)throw new Error("missing channel: y");return groupn(null,n,e,t)}function group(e={fill:"count"},t={}){let{x:n,y:r}=t;[n,r]=maybeTuple(n,r);if(n==null)throw new Error("missing channel: x");if(r==null)throw new Error("missing channel: y");return groupn(n,r,e,t)}function groupn(e,t,{data:n=go,filter:r,sort:o,reverse:a,...i}={},l={}){i=maybeGroupOutputs(i,l);n=maybeGroupReduce(n,no);o=o==null?void 0:maybeGroupOutput("sort",o,l);r=r==null?void 0:maybeGroupEvaluator("filter",r,l);const[s,c]=maybeColumn(e);const[u,f]=maybeColumn(t);const{z:d,fill:p,stroke:h,x1:m,x2:y,y1:g,y2:b,...x}=l;const[w,k]=maybeColumn(d);const[S]=maybeColorChannel(p);const[A]=maybeColorChannel(h);const[$,M]=maybeColumn(S);const[T,C]=maybeColumn(A);return{..."z"in l&&{z:w||d},..."fill"in l&&{fill:$||p},..."stroke"in l&&{stroke:T||h},...basic(x,((l,s,u)=>{const p=maybeApplyInterval(valueof(l,e),u?.x);const h=maybeApplyInterval(valueof(l,t),u?.y);const m=valueof(l,d);const y=valueof(l,S);const g=valueof(l,A);const b=maybeSubgroup(i,{z:m,fill:y,stroke:g});const x=[];const w=[];const $=p&&c([]);const T=h&&f([]);const O=m&&k([]);const I=y&&M([]);const L=g&&C([]);let N=0;for(const e of i)e.initialize(l);o&&o.initialize(l);r&&r.initialize(l);for(const e of s){const t=[];for(const t of i)t.scope("facet",e);o&&o.scope("facet",e);r&&r.scope("facet",e);for(const[a,s]of maybeGroup(e,b))for(const[e,c]of maybeGroup(s,h))for(const[s,u]of maybeGroup(c,p)){const c={data:l};p&&(c.x=s);h&&(c.y=e);b&&(c.z=a);if(!r||r.reduce(u,c)){t.push(N++);w.push(n.reduceIndex(u,l,c));p&&$.push(s);h&&T.push(e);m&&O.push(b===m?a:m[u[0]]);y&&I.push(b===y?a:y[u[0]]);g&&L.push(b===g?a:g[u[0]]);for(const e of i)e.reduce(u,c);o&&o.reduce(u,c)}}x.push(t)}maybeSort(x,o,a);return{data:w,facets:x}})),...!hasOutput(i,"x")&&(s?{x:s}:{x1:m,x2:y}),...!hasOutput(i,"y")&&(u?{y:u}:{y1:g,y2:b}),...Object.fromEntries(i.map((({name:e,output:t})=>[e,t])))}}function hasOutput(e,...t){for(const{name:n}of e)if(t.includes(n))return true;return false}function maybeOutputs(e,t,n=maybeOutput){const r=Object.entries(e);t.title!=null&&e.title===void 0&&r.push(["title",vo]);t.href!=null&&e.href===void 0&&r.push(["href",bo]);return r.filter((([,e])=>e!==void 0)).map((([e,r])=>r===null?nullOutput(e):n(e,r,t)))}function maybeOutput(e,t,n,r=maybeEvaluator){let o;isObject(t)&&"reduce"in t&&(o=t.scale,t=t.reduce);const a=r(e,t,n);const[i,l]=column(a.label);let s;return{name:e,output:o===void 0?i:{value:i,scale:o},initialize(e){a.initialize(e);s=l([])},scope(e,t){a.scope(e,t)},reduce(e,t){s.push(a.reduce(e,t))}}}function nullOutput(e){return{name:e,initialize(){},scope(){},reduce(){}}}function maybeEvaluator(e,t,n,r=maybeReduce$1){const o=maybeInput(e,n);const a=r(t,o);let i,l;return{label:labelof(a===wo?null:o,a.label),initialize(e){i=o===void 0?e:valueof(e,o);a.scope==="data"&&(l=a.reduceIndex(range(e),i))},scope(e,t){a.scope===e&&(l=a.reduceIndex(t,i))},reduce(e,t){return a.scope==null?a.reduceIndex(e,i,t):a.reduceIndex(e,i,l,t)}}}function maybeGroup(e,t){return t?Q(e,(e=>t[e])):[[,e]]}function maybeReduce$1(e,t,n=invalidReduce){if(e==null)return n(e);if(typeof e.reduceIndex==="function")return e;if(typeof e.reduce==="function"&&isObject(e))return reduceReduce(e);if(typeof e==="function")return reduceFunction(e);if(/^p\d{2}$/i.test(e))return reduceAccessor$1(percentile(e));switch(`${e}`.toLowerCase()){case"first":return bo;case"last":return xo;case"identity":return go;case"count":return wo;case"distinct":return ko;case"sum":return t==null?wo:So;case"proportion":return reduceProportion(t,"data");case"proportion-facet":return reduceProportion(t,"facet");case"deviation":return reduceAccessor$1(ie);case"min":return reduceAccessor$1(ae);case"min-index":return reduceAccessor$1(oe);case"max":return reduceAccessor$1(z);case"max-index":return reduceAccessor$1(re);case"mean":return reduceMaybeTemporalAccessor(ne);case"median":return reduceMaybeTemporalAccessor(te);case"variance":return reduceAccessor$1(ee);case"mode":return reduceAccessor$1(J)}return n(e)}function invalidReduce(e){throw new Error(`invalid reduce: ${e}`)}function maybeGroupOutputs(e,t){return maybeOutputs(e,t,maybeGroupOutput)}function maybeGroupOutput(e,t,n){return maybeOutput(e,t,n,maybeGroupEvaluator)}function maybeGroupEvaluator(e,t,n){return maybeEvaluator(e,t,n,maybeGroupReduce)}function maybeGroupReduce(e,t){return maybeReduce$1(e,t,maybeGroupReduceFallback)}function maybeGroupReduceFallback(e){switch(`${e}`.toLowerCase()){case"x":return Ao;case"y":return $o;case"z":return Mo}throw new Error(`invalid group reduce: ${e}`)}function maybeSubgroup(e,t){for(const n in t){const r=t[n];if(r!==void 0&&!e.some((e=>e.name===n)))return r}}function maybeSort(e,t,n){if(t){const n=t.output.transform();const compare=(e,t)=>ascendingDefined(n[e],n[t]);e.forEach((e=>e.sort(compare)))}n&&e.forEach((e=>e.reverse()))}function reduceReduce(e){console.warn("deprecated reduce interface; implement reduceIndex instead.");return{...e,reduceIndex:e.reduce.bind(e)}}function reduceFunction(e){return{reduceIndex(t,n,r){return e(take(n,t),r)}}}function reduceAccessor$1(e){return{reduceIndex(t,n){return e(t,(e=>n[e]))}}}function reduceMaybeTemporalAccessor(e){return{reduceIndex(t,n){const r=e(t,(e=>n[e]));return isTemporal(n)?new Date(r):r}}}const go={reduceIndex(e,t){return take(t,e)}};const bo={reduceIndex(e,t){return t[e[0]]}};const vo={reduceIndex(e,t){const n=5;const r=le(se(e,(e=>e.length),(e=>t[e])),second);const o=r.slice(-n).reverse();if(o.length<r.length){const e=r.slice(0,1-n);o[n-1]=[`â€¦ ${e.length.toLocaleString("en-US")} more`,ce(e,second)]}return o.map((([e,t])=>`${e} (${t.toLocaleString("en-US")})`)).join("\n")}};const xo={reduceIndex(e,t){return t[e[e.length-1]]}};const wo={label:"Frequency",reduceIndex(e){return e.length}};const ko={label:"Distinct",reduceIndex(e,t){const n=new ue;for(const r of e)n.add(t[r]);return n.size}};const So=reduceAccessor$1(ce);function reduceProportion(e,t){return e==null?{scope:t,label:"Frequency",reduceIndex:(e,t,n=1)=>e.length/n}:{scope:t,reduceIndex:(e,t,n=1)=>ce(e,(e=>t[e]))/n}}const Ao={reduceIndex(e,t,{x:n}){return n}};const $o={reduceIndex(e,t,{y:n}){return n}};const Mo={reduceIndex(e,t,{z:n}){return n}};function find(e){if(typeof e!=="function")throw new Error(`invalid test function: ${e}`);return{reduceIndex(t,n,{data:r}){return n[t.find(isArray(r)?t=>e(r[t],t,r):t=>e(r.get(t),t,r))]}}}function createChannel(e,{scale:t,type:n,value:r,filter:o,hint:a,label:i=labelof(r)},l){a===void 0&&typeof r?.transform==="function"&&(a=r.hint);return inferChannelScale(l,{scale:t,type:n,value:valueof(e,r),label:i,filter:o,hint:a})}function createChannels(e,t){return Object.fromEntries(Object.entries(e).map((([e,n])=>[e,createChannel(t,n,e)])))}function valueObject(e,t){const n=Object.fromEntries(Object.entries(e).map((([e,{scale:n,value:r}])=>{const o=n==null?null:t[n];return[e,o==null?r:map$1(r,o)]})));n.channels=e;return n}function inferChannelScale(e,t){const{scale:n,value:r}=t;if(n===true||n==="auto")switch(e){case"fill":case"stroke":case"color":t.scale=n!==true&&isEvery(r,isColor)?null:"color";t.defaultScale="color";break;case"fillOpacity":case"strokeOpacity":case"opacity":t.scale=n!==true&&isEvery(r,isOpacity)?null:"opacity";t.defaultScale="opacity";break;case"symbol":if(n!==true&&isEvery(r,isSymbol)){t.scale=null;t.value=map$1(r,maybeSymbol)}else t.scale="symbol";t.defaultScale="symbol";break;default:t.scale=fo.has(e)?e:null;break}else if(n===false)t.scale=null;else if(n!=null&&!fo.has(n))throw new Error(`unknown scale: ${n}`);return t}function channelDomain(e,t,n,r,o){const{order:a,reverse:i,reduce:l=true,limit:s}=o;for(const c in o){if(!fo.has(c))continue;let{value:u,order:f=a,reverse:d=i,reduce:p=l,limit:h=s}=maybeValue(o[c]);const m=u?.startsWith("-");m&&(u=u.slice(1));f=f===void 0?m!==(u==="width"||u==="height")?descendingGroup:ascendingGroup:maybeOrder$1(f);if(p==null||p===false)continue;const y=c==="fx"||c==="fy"?reindexFacetChannel(t,r[c]):findScaleChannel(n,c);if(!y)throw new Error(`missing channel for scale: ${c}`);const g=y.value;const[b=0,x=Infinity]=isIterable(h)?h:h<0?[h]:[0,h];if(u==null)y.domain=()=>{let e=Array.from(new ue(g));d&&(e=e.reverse());b===0&&x===Infinity||(e=e.slice(b,x));return e};else{const t=u==="data"?e:u==="height"?difference(n,"y1","y2"):u==="width"?difference(n,"x1","x2"):values(n,u,u==="y"?"y2":u==="x"?"x2":void 0);const r=maybeReduce$1(p===true?"max":p,t);y.domain=()=>{let e=fe(range(g),(e=>r.reduceIndex(e,t)),(e=>g[e]));f&&e.sort(f);d&&e.reverse();b===0&&x===Infinity||(e=e.slice(b,x));return e.map(first)}}}}function findScaleChannel(e,t){for(const n in e){const r=e[n];if(r.scale===t)return r}}function reindexFacetChannel(e,t){const n=e.original;if(n===e)return t;const r=t.value;const o=t.value=[];for(let t=0;t<n.length;++t){const a=r[n[t][0]];for(const n of e[t])o[n]=a}return t}function difference(e,t,n){const r=values(e,t);const o=values(e,n);return map$1(o,((e,t)=>Math.abs(e-r[t])),Float64Array)}function values(e,t,n){let r=e[t];r||n===void 0||(r=e[n]);if(r)return r.value;throw new Error(`missing channel: ${t}`)}function maybeOrder$1(e){if(e==null||typeof e==="function")return e;switch(`${e}`.toLowerCase()){case"ascending":return ascendingGroup;case"descending":return descendingGroup}throw new Error(`invalid order: ${e}`)}function ascendingGroup([e,t],[n,r]){return ascendingDefined(t,r)||ascendingDefined(e,n)}function descendingGroup([e,t],[n,r]){return descendingDefined(t,r)||ascendingDefined(e,n)}function getSource(e,t){let n=e[t];if(n){while(n.source)n=n.source;return n.source===null?null:n}}const To=new Map([["accent",de],["category10",pe],["dark2",he],["observable10",me],["paired",ye],["pastel1",ge],["pastel2",be],["set1",ve],["set2",xe],["set3",we],["tableau10",ke]]);function isCategoricalScheme(e){return e!=null&&To.has(`${e}`.toLowerCase())}const Co=new Map([...To,["brbg",scheme11(Se,Ae)],["prgn",scheme11($e,Me)],["piyg",scheme11(Te,Ce)],["puor",scheme11(Oe,Ie)],["rdbu",scheme11(Le,Ne)],["rdgy",scheme11(Re,ze)],["rdylbu",scheme11(De,Ee)],["rdylgn",scheme11(Fe,Ye)],["spectral",scheme11(Xe,Be)],["burd",scheme11r(Le,Ne)],["buylrd",scheme11r(De,Ee)],["blues",scheme9(je,We)],["greens",scheme9(Pe,Ve)],["greys",scheme9(qe,Ge)],["oranges",scheme9(_e,He)],["purples",scheme9(Ze,Ke)],["reds",scheme9(Ue,Qe)],["turbo",schemei(Je)],["viridis",schemei(et)],["magma",schemei(tt)],["inferno",schemei(nt)],["plasma",schemei(rt)],["cividis",schemei(ot)],["cubehelix",schemei(at)],["warm",schemei(lt)],["cool",schemei(st)],["bugn",scheme9(ct,ut)],["bupu",scheme9(ft,dt)],["gnbu",scheme9(pt,ht)],["orrd",scheme9(mt,yt)],["pubu",scheme9(gt,bt)],["pubugn",scheme9(vt,xt)],["purd",scheme9(wt,kt)],["rdpu",scheme9(St,At)],["ylgn",scheme9($t,Mt)],["ylgnbu",scheme9(Tt,Ct)],["ylorbr",scheme9(Ot,It)],["ylorrd",scheme9(Lt,Nt)],["rainbow",schemeicyclical(Rt)],["sinebow",schemeicyclical(zt)]]);function scheme9(e,t){return({length:n})=>{if(n===1)return[e[3][1]];if(n===2)return[e[3][1],e[3][2]];n=Math.max(3,Math.floor(n));return n>9?Dt(t,n):e[n]}}function scheme11(e,t){return({length:n})=>{if(n===2)return[e[3][0],e[3][2]];n=Math.max(3,Math.floor(n));return n>11?Dt(t,n):e[n]}}function scheme11r(e,t){return({length:n})=>{if(n===2)return[e[3][2],e[3][0]];n=Math.max(3,Math.floor(n));return n>11?Dt((e=>t(1-e)),n):e[n].slice().reverse()}}function schemei(e){return({length:t})=>Dt(e,Math.max(2,Math.floor(t)))}function schemeicyclical(e){return({length:t})=>Dt(e,Math.floor(t)+1).slice(0,-1)}function ordinalScheme(e){const t=`${e}`.toLowerCase();if(!Co.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return Co.get(t)}function ordinalRange(e,t){const n=ordinalScheme(e);const r=typeof n==="function"?n({length:t}):n;return r.length!==t?r.slice(0,t):r}function maybeBooleanRange(e,t="greys"){const n=new Set;const[r,o]=ordinalRange(t,2);for(const t of e)if(t!=null)if(t===true)n.add(o);else{if(t!==false)return;n.add(r)}return[...n]}const Oo=new Map([["brbg",Ae],["prgn",Me],["piyg",Ce],["puor",Ie],["rdbu",Ne],["rdgy",ze],["rdylbu",Ee],["rdylgn",Ye],["spectral",Be],["burd",e=>Ne(1-e)],["buylrd",e=>Ee(1-e)],["blues",We],["greens",Ve],["greys",Ge],["purples",Ke],["reds",Qe],["oranges",He],["turbo",Je],["viridis",et],["magma",tt],["inferno",nt],["plasma",rt],["cividis",ot],["cubehelix",at],["warm",lt],["cool",st],["bugn",ut],["bupu",dt],["gnbu",ht],["orrd",yt],["pubugn",xt],["pubu",bt],["purd",kt],["rdpu",At],["ylgnbu",Ct],["ylgn",Mt],["ylorbr",It],["ylorrd",Nt],["rainbow",Rt],["sinebow",zt]]);function quantitativeScheme(e){const t=`${e}`.toLowerCase();if(!Oo.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return Oo.get(t)}const Io=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function isDivergingScheme(e){return e!=null&&Io.has(`${e}`.toLowerCase())}const flip=e=>t=>e(1-t);const Lo=[0,1];const No=new Map([["number",Et],["rgb",Ft],["hsl",Yt],["hcl",Xt],["lab",Bt]]);function maybeInterpolator(e){const t=`${e}`.toLowerCase();if(!No.has(t))throw new Error(`unknown interpolator: ${t}`);return No.get(t)}function createScaleQ(e,t,n,{type:r,nice:o,clamp:a,zero:i,domain:l=inferAutoDomain(e,n),unknown:s,round:c,scheme:u,interval:f,range:d=(fo.get(e)===io?inferRadialRange(n,l):fo.get(e)===lo?inferLengthRange(n,l):fo.get(e)===so?Lo:void 0),interpolate:p=(fo.get(e)===ao?u==null&&d!==void 0?Ft:quantitativeScheme(u!==void 0?u:r==="cyclical"?"rainbow":"turbo"):c?jt:Et),reverse:h}){l=maybeRepeat(l);f=maybeRangeInterval(f,r);r!=="cyclical"&&r!=="sequential"||(r="linear");typeof p!=="function"&&(p=maybeInterpolator(p));h=!!h;if(d!==void 0){const e=l.length;const t=(d=maybeRepeat(d)).length;if(e!==t){if(p.length===1)throw new Error("invalid piecewise interpolator");p=Wt(p,d);d=void 0}}if(p.length===1){if(h){p=flip(p);h=false}if(d===void 0){d=Float64Array.from(l,((e,t)=>t/(l.length-1)));d.length===2&&(d=Lo)}t.interpolate((d===Lo?constant:interpolatePiecewise)(p))}else t.interpolate(p);if(i){const[e,t]=Pt(l);if(e>0||t<0){l=slice(l);const t=orderof(l)||1;t===Math.sign(e)?l[0]=0:l[l.length-1]=0}}h&&(l=Vt(l));t.domain(l).unknown(s);o&&(t.nice(maybeNice(o,r)),l=t.domain());d!==void 0&&t.range(d);a&&t.clamp(a);return{type:r,domain:l,range:d,scale:t,interpolate:p,interval:f}}function maybeRepeat(e){e=arrayify(e);return e.length>=2?e:[e[0],e[0]]}function maybeNice(e,t){return e===true?void 0:typeof e==="number"?e:maybeNiceInterval(e,t)}function createScaleLinear(e,t,n){return createScaleQ(e,Gt(),t,n)}function createScaleSqrt(e,t,n){return createScalePow(e,t,{...n,exponent:.5})}function createScalePow(e,t,{exponent:n=1,...r}){return createScaleQ(e,_t().exponent(n),t,{...r,type:"pow"})}function createScaleLog(e,t,{base:n=10,domain:r=inferLogDomain(t),...o}){return createScaleQ(e,Ht().base(n),t,{...o,domain:r})}function createScaleSymlog(e,t,{constant:n=1,...r}){return createScaleQ(e,Zt().constant(n),t,r)}function createScaleQuantile(e,t,{range:n,quantiles:r=(n===void 0?5:(n=[...n]).length),n:o=r,scheme:a="rdylbu",domain:i=inferQuantileDomain(t),unknown:l,interpolate:s,reverse:c}){n===void 0&&(n=s!==void 0?Dt(s,o):fo.get(e)===ao?ordinalRange(a,o):void 0);i.length>0&&(i=Kt(i,n===void 0?{length:o}:n).quantiles());return createScaleThreshold(e,t,{domain:i,range:n,reverse:c,unknown:l})}function createScaleQuantize(e,t,{range:n,n:r=(n===void 0?5:(n=[...n]).length),scheme:o="rdylbu",domain:a=inferAutoDomain(e,t),unknown:i,interpolate:l,reverse:s}){const[c,u]=Pt(a);let f;if(n===void 0){f=Ut(c,u,r);f[0]<=c&&f.splice(0,1);f[f.length-1]>=u&&f.pop();r=f.length+1;n=l!==void 0?Dt(l,r):fo.get(e)===ao?ordinalRange(o,r):void 0}else{f=Dt(Et(c,u),r+1).slice(1,-1);c instanceof Date&&(f=f.map((e=>new Date(e))))}orderof(arrayify(a))<0&&f.reverse();return createScaleThreshold(e,t,{domain:f,range:n,reverse:s,unknown:i})}function createScaleThreshold(e,t,{domain:n=[0],unknown:r,scheme:o="rdylbu",interpolate:a,range:i=(a!==void 0?Dt(a,n.length+1):fo.get(e)===ao?ordinalRange(o,n.length+1):void 0),reverse:l}){n=arrayify(n);const s=orderof(n);if(!isNaN(s)&&!isOrdered(n,s))throw new Error(`the ${e} scale has a non-monotonic domain`);l&&(i=Vt(i));return{type:"threshold",scale:Qt(s<0?Vt(n):n,i===void 0?[]:i).unknown(r),domain:n,range:i}}function isOrdered(e,n){for(let r=1,o=e.length,a=e[0];r<o;++r){const o=t(a,a=e[r]);if(o!==0&&o!==n)return false}return true}function createScaleIdentity(e){return{type:"identity",scale:hasNumericRange(fo.get(e))?Jt():e=>e}}function inferDomain$1(e,t=finite$1){return e.length?[ae(e,(({value:e})=>e===void 0?e:ae(e,t))),z(e,(({value:e})=>e===void 0?e:z(e,t)))]:[0,1]}function inferAutoDomain(e,t){const n=fo.get(e);return(n===io||n===so||n===lo?inferZeroDomain:inferDomain$1)(t)}function inferZeroDomain(e){return[0,e.length?z(e,(({value:e})=>e===void 0?e:z(e,finite$1))):1]}function inferRadialRange(e,t){const n=e.find((({radius:e})=>e!==void 0));if(n!==void 0)return[0,n.radius];const r=E(e,.5,(({value:e})=>e===void 0?NaN:E(e,.25,positive)));const o=t.map((e=>3*Math.sqrt(e/r)));const a=30/z(o);return a<1?o.map((e=>e*a)):o}function inferLengthRange(e,t){const n=te(e,(({value:e})=>e===void 0?NaN:te(e,Math.abs)));const r=t.map((e=>12*e/n));const o=60/z(r);return o<1?r.map((e=>e*o)):r}function inferLogDomain(e){for(const{value:t}of e)if(t!==void 0)for(let n of t){if(n>0)return inferDomain$1(e,positive);if(n<0)return inferDomain$1(e,negative)}return[1,10]}function inferQuantileDomain(e){const t=[];for(const{value:n}of e)if(n!==void 0)for(const e of n)t.push(e);return t}function interpolatePiecewise(e){return(t,n)=>r=>e(t+r*(n-t))}let Ro=0;let zo;function consumeWarnings(){const e=Ro;Ro=0;zo=void 0;return e}function warn(e){if(e!==zo){zo=e;console.warn(e);++Ro}}function createScaleD(e,n,r,o,{type:a,nice:i,clamp:l,domain:s=inferDomain$1(o),unknown:c,pivot:u=0,scheme:f,range:d,symmetric:p=true,interpolate:h=(fo.get(e)===ao?f==null&&d!==void 0?Ft:quantitativeScheme(f!==void 0?f:"rdbu"):Et),reverse:m}){u=+u;s=arrayify(s);let[y,g]=s;s.length>2&&warn(`Warning: the diverging ${e} scale domain contains extra elements.`);t(y,g)<0&&([y,g]=[g,y],m=!m);y=Math.min(y,u);g=Math.max(g,u);typeof h!=="function"&&(h=maybeInterpolator(h));d!==void 0&&(h=h.length===1?interpolatePiecewise(h)(...d):Wt(h,d));m&&(h=flip(h));if(p){const e=r.apply(u);const t=e-r.apply(y);const n=r.apply(g)-e;t<n?y=r.invert(e-n):t>n&&(g=r.invert(e+t))}n.domain([y,u,g]).unknown(c).interpolator(h);l&&n.clamp(l);i&&n.nice(i);return{type:a,domain:[y,g],pivot:u,interpolate:h,scale:n}}function createScaleDiverging(e,t,n){return createScaleD(e,en(),Do,t,n)}function createScaleDivergingSqrt(e,t,n){return createScaleDivergingPow(e,t,{...n,exponent:.5})}function createScaleDivergingPow(e,t,{exponent:n=1,...r}){return createScaleD(e,tn().exponent(n=+n),transformPow(n),t,{...r,type:"diverging-pow"})}function createScaleDivergingLog(e,t,{base:n=10,pivot:r=1,domain:o=inferDomain$1(t,r<0?negative:positive),...a}){return createScaleD(e,nn().base(n=+n),Eo,t,{domain:o,pivot:r,...a})}function createScaleDivergingSymlog(e,t,{constant:n=1,...r}){return createScaleD(e,rn().constant(n=+n),transformSymlog(n),t,r)}const Do={apply(e){return e},invert(e){return e}};const Eo={apply:Math.log,invert:Math.exp};const Fo={apply(e){return Math.sign(e)*Math.sqrt(Math.abs(e))},invert(e){return Math.sign(e)*(e*e)}};function transformPow(e){return e===.5?Fo:{apply(t){return Math.sign(t)*Math.pow(Math.abs(t),e)},invert(t){return Math.sign(t)*Math.pow(Math.abs(t),1/e)}}}function transformSymlog(e){return{apply(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))},invert(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}}function createScaleT(e,t,n,r){return createScaleQ(e,t,n,r)}function createScaleTime(e,t,n){return createScaleT(e,on(),t,n)}function createScaleUtc(e,t,n){return createScaleT(e,an(),t,n)}const Yo=Symbol("ordinal");function createScaleO(e,t,n,{type:r,interval:o,domain:a,range:i,reverse:l,hint:s}){o=maybeRangeInterval(o,r);a===void 0&&(a=inferDomain(n,o,e));r!=="categorical"&&r!==Yo||(r="ordinal");l&&(a=Vt(a));a=t.domain(a).domain();if(i!==void 0){typeof i==="function"&&(i=i(a));t.range(i)}return{type:r,domain:a,range:i,scale:t,hint:s,interval:o}}function createScaleOrdinal(e,t,{type:n,interval:r,domain:o,range:a,scheme:i,unknown:l,...s}){r=maybeRangeInterval(r,n);o===void 0&&(o=inferDomain(t,r,e));let c;if(fo.get(e)===co){c=inferSymbolHint(t);a=a===void 0?inferSymbolRange(c):map$1(a,maybeSymbol)}else if(fo.get(e)===ao){if(a===void 0&&(n==="ordinal"||n===Yo)){a=maybeBooleanRange(o,i);a!==void 0&&(i=void 0)}i===void 0&&a===void 0&&(i=n==="ordinal"?"turbo":"observable10");if(i!==void 0)if(a!==void 0){const e=quantitativeScheme(i);const t=a[0],n=a[1]-a[0];a=({length:r})=>Dt((r=>e(t+n*r)),r)}else a=ordinalScheme(i)}if(l===ln)throw new Error(`implicit unknown on ${e} scale is not supported`);return createScaleO(e,sn().unknown(l),t,{...s,type:n,domain:o,range:a,hint:c})}function createScalePoint(e,t,{align:n=.5,padding:r=.5,...o}){return maybeRound$1(cn().align(n).padding(r),t,o,e)}function createScaleBand(e,t,{align:n=.5,padding:r=.1,paddingInner:o=r,paddingOuter:a=(e==="fx"||e==="fy"?0:r),...i}){return maybeRound$1(un().align(n).paddingInner(o).paddingOuter(a),t,i,e)}function maybeRound$1(e,t,n,r){let{round:o}=n;o!==void 0&&e.round(o=!!o);e=createScaleO(r,e,t,n);e.round=o;return e}function inferDomain(e,t,n){const r=new ue;for(const{value:t,domain:n}of e){if(n!==void 0)return n();if(t!==void 0)for(const e of t)r.add(e)}if(t!==void 0){const[e,n]=Pt(r).map(t.floor,t);return t.range(e,t.offset(n))}if(r.size>1e4&&fo.get(n)===oo)throw new Error(`implicit ordinal domain of ${n} scale has more than 10,000 values`);return le(r,ascendingDefined)}function inferHint(e,t){let n;for(const{hint:r}of e){const e=r?.[t];if(e!==void 0)if(n===void 0)n=e;else if(n!==e)return}return n}function inferSymbolHint(e){return{fill:inferHint(e,"fill"),stroke:inferHint(e,"stroke")}}function inferSymbolRange(e){return isNoneish(e.fill)?fn:dn}function createScales(e,{label:t,inset:n=0,insetTop:r=n,insetRight:o=n,insetBottom:a=n,insetLeft:i=n,round:l,nice:s,clamp:c,zero:u,align:f,padding:d,projection:p,facet:{label:h=t}={},...m}={}){const y={};for(const[n,g]of e){const e=m[n];const b=createScale(n,g,{round:fo.get(n)===oo?l:void 0,nice:s,clamp:c,zero:u,align:f,padding:d,projection:p,...e});if(b){let{label:l=(n==="fx"||n==="fy"?h:t),percent:s,transform:c,inset:u,insetTop:f=(u!==void 0?u:n==="y"?r:0),insetRight:d=(u!==void 0?u:n==="x"?o:0),insetBottom:p=(u!==void 0?u:n==="y"?a:0),insetLeft:m=(u!==void 0?u:n==="x"?i:0)}=e||{};if(c==null)c=void 0;else if(typeof c!=="function")throw new Error("invalid scale transform; not a function");b.percent=!!s;b.label=l===void 0?inferScaleLabel(g,b):l;b.transform=c;if(n==="x"||n==="fx"){b.insetLeft=+m;b.insetRight=+d}else if(n==="y"||n==="fy"){b.insetTop=+f;b.insetBottom=+p}y[n]=b}}return y}function createScaleFunctions(e){const t={};const n={scales:t};for(const[r,o]of Object.entries(e)){const{scale:e,type:a,interval:i,label:l}=o;t[r]=exposeScale(o);n[r]=e;e.type=a;i!=null&&(e.interval=i);l!=null&&(e.label=l)}return n}function autoScaleRange(e,t){const{x:n,y:r,fx:o,fy:a}=e;const i=o||a?outerDimensions(t):t;o&&autoScaleRangeX(o,i);a&&autoScaleRangeY(a,i);const l=o||a?innerDimensions(e,t):t;n&&autoScaleRangeX(n,l);r&&autoScaleRangeY(r,l)}function inferScaleLabel(e=[],t){let n;for(const{label:t}of e)if(t!==void 0)if(n===void 0)n=t;else if(n!==t)return;if(n!==void 0){!isOrdinalScale(t)&&t.percent&&(n=`${n} (%)`);return{inferred:true,toString:()=>n}}}function inferScaleOrder(e){return Math.sign(orderof(e.domain()))*Math.sign(orderof(e.range()))}function outerDimensions(e){const{marginTop:t,marginRight:n,marginBottom:r,marginLeft:o,width:a,height:i,facet:{marginTop:l,marginRight:s,marginBottom:c,marginLeft:u}}=e;return{marginTop:Math.max(t,l),marginRight:Math.max(n,s),marginBottom:Math.max(r,c),marginLeft:Math.max(o,u),width:a,height:i}}function innerDimensions({fx:e,fy:t},n){const{marginTop:r,marginRight:o,marginBottom:a,marginLeft:i,width:l,height:s}=outerDimensions(n);return{marginTop:r,marginRight:o,marginBottom:a,marginLeft:i,width:e?e.scale.bandwidth()+i+o:l,height:t?t.scale.bandwidth()+r+a:s,facet:{width:l,height:s}}}function autoScaleRangeX(e,t){if(e.range===void 0){const{insetLeft:n,insetRight:r}=e;const{width:o,marginLeft:a=0,marginRight:i=0}=t;const l=a+n;const s=o-i-r;e.range=[l,Math.max(l,s)];isOrdinalScale(e)||(e.range=piecewiseRange(e));e.scale.range(e.range)}autoScaleRound(e)}function autoScaleRangeY(e,t){if(e.range===void 0){const{insetTop:n,insetBottom:r}=e;const{height:o,marginTop:a=0,marginBottom:i=0}=t;const l=a+n;const s=o-i-r;e.range=[Math.max(l,s),l];isOrdinalScale(e)?e.range.reverse():e.range=piecewiseRange(e);e.scale.range(e.range)}autoScaleRound(e)}function autoScaleRound(e){e.round===void 0&&isBandScale(e)&&roundError(e)<=30&&e.scale.round(true)}function roundError({scale:e}){const t=e.domain().length;const[n,r]=e.range();const o=e.paddingInner?e.paddingInner():1;const a=e.paddingOuter?e.paddingOuter():e.padding();const i=t-o;const l=Math.abs(r-n)/Math.max(1,i+a*2);return(l-Math.floor(l))*i}function piecewiseRange(e){const t=e.scale.domain().length+isThresholdScale(e);if(!(t>2))return e.range;const[n,r]=e.range;return Array.from({length:t},((e,o)=>n+o/(t-1)*(r-n)))}function normalizeScale(e,t,n){return createScale(e,n===void 0?void 0:[{hint:n}],{...t})}function createScale(e,t=[],n={}){const r=inferScaleType(e,t,n);if(n.type===void 0&&n.domain===void 0&&n.range===void 0&&n.interval==null&&e!=="fx"&&e!=="fy"&&isOrdinalScale({type:r})){const n=t.map((({value:e})=>e)).filter((e=>e!==void 0));n.some(isTemporal)?warn(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${formatScaleType(r)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${formatScaleType(r)}".`):n.some(isTemporalString)?warn(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${formatScaleType(r)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${formatScaleType(r)}".`):n.some(isNumericString)&&warn(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${formatScaleType(r)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${formatScaleType(r)}".`)}n.type=r;switch(r){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":n=coerceType(t,n,coerceNumbers);break;case"identity":switch(fo.get(e)){case oo:n=coerceType(t,n,coerceNumbers);break;case co:n=coerceType(t,n,coerceSymbols);break}break;case"utc":case"time":n=coerceType(t,n,coerceDates);break}switch(r){case"diverging":return createScaleDiverging(e,t,n);case"diverging-sqrt":return createScaleDivergingSqrt(e,t,n);case"diverging-pow":return createScaleDivergingPow(e,t,n);case"diverging-log":return createScaleDivergingLog(e,t,n);case"diverging-symlog":return createScaleDivergingSymlog(e,t,n);case"categorical":case"ordinal":case Yo:return createScaleOrdinal(e,t,n);case"cyclical":case"sequential":case"linear":return createScaleLinear(e,t,n);case"sqrt":return createScaleSqrt(e,t,n);case"threshold":return createScaleThreshold(e,t,n);case"quantile":return createScaleQuantile(e,t,n);case"quantize":return createScaleQuantize(e,t,n);case"pow":return createScalePow(e,t,n);case"log":return createScaleLog(e,t,n);case"symlog":return createScaleSymlog(e,t,n);case"utc":return createScaleUtc(e,t,n);case"time":return createScaleTime(e,t,n);case"point":return createScalePoint(e,t,n);case"band":return createScaleBand(e,t,n);case"identity":return createScaleIdentity(e);case void 0:return;default:throw new Error(`unknown scale type: ${r}`)}}function formatScaleType(e){return typeof e==="symbol"?e.description:e}function maybeScaleType(e){return typeof e==="string"?`${e}`.toLowerCase():e}const Xo={toString:()=>"projection"};function inferScaleType(e,t,{type:n,domain:r,range:o,scheme:a,pivot:i,projection:l}){n=maybeScaleType(n);if(e==="fx"||e==="fy")return"band";e!=="x"&&e!=="y"||l==null||(n=Xo);for(const e of t){const t=maybeScaleType(e.type);if(t!==void 0)if(n===void 0)n=t;else if(n!==t)throw new Error(`scale incompatible with channel: ${n} !== ${t}`)}if(n===Xo)return;if(n!==void 0)return n;if(r===void 0&&!t.some((({value:e})=>e!==void 0)))return;const s=fo.get(e);if(s===io)return"sqrt";if(s===so||s===lo)return"linear";if(s===co)return"ordinal";const c=(r??o)?.length;if(c<2||c>2)return asOrdinalType(s);if(r!==void 0){if(isOrdinal(r))return asOrdinalType(s);if(isTemporal(r))return"utc"}else{const e=t.map((({value:e})=>e)).filter((e=>e!==void 0));if(e.some(isOrdinal))return asOrdinalType(s);if(e.some(isTemporal))return"utc"}if(s===ao){if(i!=null||isDivergingScheme(a))return"diverging";if(isCategoricalScheme(a))return"categorical"}return"linear"}function asOrdinalType(e){switch(e){case oo:return"point";case ao:return Yo;default:return"ordinal"}}function isOrdinalScale({type:e}){return e==="ordinal"||e==="point"||e==="band"||e===Yo}function isThresholdScale({type:e}){return e==="threshold"}function isBandScale({type:e}){return e==="point"||e==="band"}function isCollapsed(e){if(e===void 0)return true;const t=e.domain();const n=e(t[0]);for(let r=1,o=t.length;r<o;++r)if(e(t[r])-n)return false;return true}function coerceType(e,{domain:t,...n},r){for(const n of e)if(n.value!==void 0){t===void 0&&(t=n.value?.domain);n.value=r(n.value)}return{domain:t===void 0?t:r(t),...n}}function coerceSymbols(e){return map$1(e,maybeSymbol)}function scale(e={}){let t;for(const n in e)if(fo.has(n)&&isScaleOptions(e[n])){if(t!==void 0)throw new Error("ambiguous scale definition; multiple scales found");t=exposeScale(normalizeScale(n,e[n]))}if(t===void 0)throw new Error("invalid scale definition; no scale found");return t}function exposeScales(e){return t=>{if(!fo.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return e[t]}}function exposeScale({scale:e,type:t,domain:n,range:r,interpolate:o,interval:a,transform:i,percent:l,pivot:s}){if(t==="identity")return{type:"identity",apply:e=>e,invert:e=>e};const c=e.unknown?e.unknown():void 0;return{type:t,domain:slice(n),...r!==void 0&&{range:slice(r)},...i!==void 0&&{transform:i},...l&&{percent:l},...c!==void 0&&{unknown:c},...a!==void 0&&{interval:a},...o!==void 0&&{interpolate:o},...e.clamp&&{clamp:e.clamp()},...s!==void 0&&{pivot:s,symmetric:false},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:t=>e(t),...e.invert&&{invert:t=>e.invert(t)}}}function createFacets(e,t){const{fx:n,fy:r}=createScales(e,t);const o=n?.scale.domain();const a=r?.scale.domain();return o&&a?pn(o,a).map((([e,t],n)=>({x:e,y:t,i:n}))):o?o.map(((e,t)=>({x:e,i:t}))):a?a.map(((e,t)=>({y:e,i:t}))):void 0}function recreateFacets(e,{x:t,y:n}){t&&=facetIndex(t);n&&=facetIndex(n);return e.filter(t&&n?e=>t.has(e.x)&&n.has(e.y):t?e=>t.has(e.x):e=>n.has(e.y)).sort(t&&n?(e,r)=>t.get(e.x)-t.get(r.x)||n.get(e.y)-n.get(r.y):t?(e,n)=>t.get(e.x)-t.get(n.x):(e,t)=>n.get(e.y)-n.get(t.y))}function facetGroups(e,{fx:t,fy:n}){const r=range(e);const o=t?.value;const a=n?.value;return t&&n?se(r,(e=>(e.fx=o[e[0]],e.fy=a[e[0]],e)),(e=>o[e]),(e=>a[e])):t?se(r,(e=>(e.fx=o[e[0]],e)),(e=>o[e])):se(r,(e=>(e.fy=a[e[0]],e)),(e=>a[e]))}function facetTranslator(e,t,{marginTop:n,marginLeft:r}){const o=e?({x:t})=>e(t)-r:()=>0;const a=t?({y:e})=>t(e)-n:()=>0;return function(e){if(this.tagName==="svg"){this.setAttribute("x",o(e));this.setAttribute("y",a(e))}else this.setAttribute("transform",`translate(${o(e)},${a(e)})`)}}function facetExclude(e){const t=[];const n=new Uint32Array(ce(e,(e=>e.length)));for(const r of e){let o=0;for(const t of e)if(r!==t){n.set(t,o);o+=t.length}t.push(n.slice(0,o))}return t}const Bo=new Map([["top",facetAnchorTop],["right",facetAnchorRight],["bottom",facetAnchorBottom],["left",facetAnchorLeft],["top-left",and(facetAnchorTop,facetAnchorLeft)],["top-right",and(facetAnchorTop,facetAnchorRight)],["bottom-left",and(facetAnchorBottom,facetAnchorLeft)],["bottom-right",and(facetAnchorBottom,facetAnchorRight)],["top-empty",facetAnchorTopEmpty],["right-empty",facetAnchorRightEmpty],["bottom-empty",facetAnchorBottomEmpty],["left-empty",facetAnchorLeftEmpty],["empty",facetAnchorEmpty]]);function maybeFacetAnchor(e){if(e==null)return null;const t=Bo.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}const jo=new WeakMap;function facetIndex(e){let t=jo.get(e);t||jo.set(e,t=new hn(map$1(e,((e,t)=>[e,t]))));return t}function facetIndexOf(e,t){return facetIndex(e).get(t)}function facetFind(e,t,n){t=keyof(t);n=keyof(n);return e.find((e=>Object.is(keyof(e.x),t)&&Object.is(keyof(e.y),n)))}function facetEmpty(e,t,n){return facetFind(e,t,n)?.empty}function facetAnchorTop(e,{y:t},{y:n}){return!t||facetIndexOf(t,n)===0}function facetAnchorBottom(e,{y:t},{y:n}){return!t||facetIndexOf(t,n)===t.length-1}function facetAnchorLeft(e,{x:t},{x:n}){return!t||facetIndexOf(t,n)===0}function facetAnchorRight(e,{x:t},{x:n}){return!t||facetIndexOf(t,n)===t.length-1}function facetAnchorTopEmpty(e,{y:t},{x:n,y:r,empty:o}){if(o)return false;if(!t)return;const a=facetIndexOf(t,r);return a>0?facetEmpty(e,n,t[a-1]):void 0}function facetAnchorBottomEmpty(e,{y:t},{x:n,y:r,empty:o}){if(o)return false;if(!t)return;const a=facetIndexOf(t,r);return a<t.length-1?facetEmpty(e,n,t[a+1]):void 0}function facetAnchorLeftEmpty(e,{x:t},{x:n,y:r,empty:o}){if(o)return false;if(!t)return;const a=facetIndexOf(t,n);return a>0?facetEmpty(e,t[a-1],r):void 0}function facetAnchorRightEmpty(e,{x:t},{x:n,y:r,empty:o}){if(o)return false;if(!t)return;const a=facetIndexOf(t,n);return a<t.length-1?facetEmpty(e,t[a+1],r):void 0}function facetAnchorEmpty(e,t,{empty:n}){return n}function and(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function facetFilter(e,{channels:{fx:t,fy:n},groups:r}){return t&&n?e.map((({x:e,y:t})=>r.get(e)?.get(t)??[])):t?e.map((({x:e})=>r.get(e)??[])):e.map((({y:e})=>r.get(e)??[]))}const Wo=Math.PI;const Po=2*Wo;const Vo=.618;function createProjection({projection:e,inset:t=0,insetTop:n=t,insetRight:r=t,insetBottom:o=t,insetLeft:a=t}={},i){if(e==null)return;if(typeof e.stream==="function")return e;let l;let s;let c="frame";if(isObject(e)){let t;({type:e,domain:s,inset:t,insetTop:n=(t!==void 0?t:n),insetRight:r=(t!==void 0?t:r),insetBottom:o=(t!==void 0?t:o),insetLeft:a=(t!==void 0?t:a),clip:c=c,...l}=e);if(e==null)return}typeof e!=="function"&&({type:e}=namedProjection(e));const{width:u,height:f,marginLeft:d,marginRight:p,marginTop:h,marginBottom:m}=i;const y=u-d-p-a-r;const g=f-h-m-n-o;e=e?.({width:y,height:g,clip:c,...l});if(e==null)return;c=maybePostClip(c,d,h,u-p,f-m);let b=d+a;let x=h+n;let w;if(s!=null){const[[t,n],[r,o]]=mn(e).bounds(s);const a=Math.min(y/(r-t),g/(o-n));if(a>0){b-=(a*(t+r)-y)/2;x-=(a*(n+o)-g)/2;w=yn({point(e,t){this.stream.point(e*a+b,t*a+x)}})}else warn("Warning: the projection could not be fit to the specified domain; using the default scale.")}w??=b===0&&x===0?qo():yn({point(e,t){this.stream.point(e+b,t+x)}});return{stream:t=>e.stream(w.stream(c(t)))}}function namedProjection(e){switch(`${e}`.toLowerCase()){case"albers-usa":return scaleProjection(In,.7463,.4673);case"albers":return conicProjection(On,.7463,.4673);case"azimuthal-equal-area":return scaleProjection(Cn,4,4);case"azimuthal-equidistant":return scaleProjection(Tn,Po,Po);case"conic-conformal":return conicProjection(Mn,Po,Po);case"conic-equal-area":return conicProjection($n,6.1702,2.9781);case"conic-equidistant":return conicProjection(An,7.312,3.6282);case"equal-earth":return scaleProjection(Sn,5.4133,2.6347);case"equirectangular":return scaleProjection(kn,Po,Wo);case"gnomonic":return scaleProjection(wn,3.4641,3.4641);case"identity":return{type:qo};case"reflect-y":return{type:Go};case"mercator":return scaleProjection(xn,Po,Po);case"orthographic":return scaleProjection(vn,2,2);case"stereographic":return scaleProjection(bn,2,2);case"transverse-mercator":return scaleProjection(gn,Po,Po);default:throw new Error(`unknown projection type: ${e}`)}}function maybePostClip(e,t,n,r,o){if(e===false||e==null||typeof e==="number")return e=>e;e===true&&(e="frame");switch(`${e}`.toLowerCase()){case"frame":return Ln(t,n,r,o);default:throw new Error(`unknown projection clip type: ${e}`)}}function scaleProjection(e,t,n){return{type:({width:r,height:o,rotate:a,precision:i=.15,clip:l})=>{const s=e();i!=null&&s.precision?.(i);a!=null&&s.rotate?.(a);typeof l==="number"&&s.clipAngle?.(l);if(r!=null){s.scale(Math.min(r/t,o/n));s.translate([r/2,o/2])}return s},aspectRatio:n/t}}function conicProjection(e,t,n){const{type:r,aspectRatio:o}=scaleProjection(e,t,n);return{type:e=>{const{parallels:t,domain:n,width:o,height:a}=e;const i=r(e);if(t!=null){i.parallels(t);n===void 0&&o!=null&&i.fitSize([o,a],{type:"Sphere"})}return i},aspectRatio:o}}const qo=constant({stream:e=>e});const Go=constant(yn({point(e,t){this.stream.point(e,-t)}}));function project(e,t,n,r){const o=n[e];const a=n[t];const i=o.length;const l=n[e]=new Float64Array(i).fill(NaN);const s=n[t]=new Float64Array(i).fill(NaN);let c;const u=r.stream({point(e,t){l[c]=e;s[c]=t}});for(c=0;c<i;++c)u.point(o[c],a[c])}function hasProjection({projection:e}={}){if(e==null)return false;if(typeof e.stream==="function")return true;isObject(e)&&(e=e.type);return e!=null}function projectionAspectRatio(e){if(typeof e?.stream==="function")return Vo;if(isObject(e)){let t,n;({domain:t,type:e,...n}=e);if(t!=null&&e!=null){const r=typeof e==="string"?namedProjection(e).type:e;const[[o,a],[i,l]]=mn(r({...n,width:100,height:100})).bounds(t);const s=(l-a)/(i-o);return s&&isFinite(s)?s<.2?.2:s>5?5:s:Vo}}if(e!=null){if(typeof e!=="function"){const{aspectRatio:t}=namedProjection(e);if(t)return t}return Vo}}function applyPosition(e,t,{projection:n}){const{x:r,y:o}=e;let a={};r&&(a.x=r);o&&(a.y=o);a=valueObject(a,t);n&&r?.scale==="x"&&o?.scale==="y"&&project("x","y",a,n);r&&(a.x=coerceNumbers(a.x));o&&(a.y=coerceNumbers(a.y));return a}function getGeometryChannels(e){const t=[];const n=[];const r={scale:"x",value:t};const o={scale:"y",value:n};const a={point(e,r){t.push(e);n.push(r)},lineStart(){},lineEnd(){},polygonStart(){},polygonEnd(){},sphere(){}};for(const t of e.value)Nn(t,a);return[r,o]}function xyProjection({x:e,y:t}){if(e||t){e??=e=>e;t??=e=>e;return yn({point(n,r){this.stream.point(e(n),t(r))}})}}function createContext(e={}){const{document:t=(typeof window!=="undefined"?window.document:void 0),clip:n}=e;return{document:t,clip:maybeClip(n)}}function create(e,{document:t}){return Rn(zn(e).call(t.documentElement))}const _o=Symbol("unset");function memoize1(e){return(e.length===1?memoize1Arg:memoize1Args)(e)}function memoize1Arg(e){let t;let n=_o;return r=>{if(!Object.is(n,r)){n=r;t=e(r)}return t}}function memoize1Args(e){let t,n;return(...r)=>{if(n?.length!==r.length||n.some(((e,t)=>!Object.is(e,r[t])))){n=r;t=e(...r)}return t}}const Ho=memoize1((e=>new Intl.NumberFormat(e)));const Zo=memoize1(((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})));const Ko=memoize1(((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}})));function formatNumber(e="en-US"){const t=Ho(e);return e=>e==null||isNaN(e)?void 0:t.format(e)}function formatMonth(e="en-US",t="short"){const n=Zo(e,t);return e=>e==null||isNaN(e=+new Date(Date.UTC(2e3,+e)))?void 0:n.format(e)}function formatWeekday(e="en-US",t="short"){const n=Ko(e,t);return e=>e==null||isNaN(e=+new Date(Date.UTC(2001,0,+e)))?void 0:n.format(e)}function formatIsoDate(e){return Rr(e,"Invalid Date")}function formatAuto(e="en-US"){const t=formatNumber(e);return e=>(e instanceof Date?formatIsoDate:typeof e==="number"?t:string)(e)}const Uo=formatAuto();const Qo=(typeof window!=="undefined"?window.devicePixelRatio>1:typeof it==="undefined")?0:.5;let Jo=0;let ea=0;function getClipId(){return"plot-clip-"+ ++Jo}function getPatternId(){return"plot-pattern-"+ ++ea}function styles(e,{title:t,href:n,ariaLabel:r,ariaDescription:o,ariaHidden:a,target:i,fill:l,fillOpacity:s,stroke:c,strokeWidth:u,strokeOpacity:f,strokeLinejoin:d,strokeLinecap:p,strokeMiterlimit:h,strokeDasharray:m,strokeDashoffset:y,opacity:g,mixBlendMode:b,imageFilter:x,paintOrder:w,pointerEvents:k,shapeRendering:S,channels:A},{ariaLabel:$,fill:M="currentColor",fillOpacity:T,stroke:C="none",strokeOpacity:O,strokeWidth:I,strokeLinecap:L,strokeLinejoin:N,strokeMiterlimit:R,paintOrder:z}){if(M===null){l=null;s=null}if(C===null){c=null;f=null}isNoneish(M)?isNoneish(C)||isNoneish(l)&&!A?.fill||(C="none"):!isNoneish(C)||isNoneish(c)&&!A?.stroke||(M="none");const[D,E]=maybeColorChannel(l,M);const[F,Y]=maybeNumberChannel(s,T);const[X,B]=maybeColorChannel(c,C);const[j,W]=maybeNumberChannel(f,O);const[P,V]=maybeNumberChannel(g);if(!isNone(B)){u===void 0&&(u=I);p===void 0&&(p=L);d===void 0&&(d=N);h!==void 0||isRound(d)||(h=R);isNone(E)||w!==void 0||(w=z)}const[q,G]=maybeNumberChannel(u);if(M!==null){e.fill=impliedString(E,"currentColor");e.fillOpacity=impliedNumber(Y,1)}if(C!==null){e.stroke=impliedString(B,"none");e.strokeWidth=impliedNumber(G,1);e.strokeOpacity=impliedNumber(W,1);e.strokeLinejoin=impliedString(d,"miter");e.strokeLinecap=impliedString(p,"butt");e.strokeMiterlimit=impliedNumber(h,4);e.strokeDasharray=impliedString(m,"none");e.strokeDashoffset=impliedString(y,"0")}e.target=string(i);e.ariaLabel=string($);e.ariaDescription=string(o);e.ariaHidden=string(a);e.opacity=impliedNumber(V,1);e.mixBlendMode=impliedString(b,"normal");e.imageFilter=impliedString(x,"none");e.paintOrder=impliedString(w,"normal");e.pointerEvents=impliedString(k,"auto");e.shapeRendering=impliedString(S,"auto");return{title:{value:t,optional:true,filter:null},href:{value:n,optional:true,filter:null},ariaLabel:{value:r,optional:true,filter:null},fill:{value:D,scale:"auto",optional:true},fillOpacity:{value:F,scale:"auto",optional:true},stroke:{value:X,scale:"auto",optional:true},strokeOpacity:{value:j,scale:"auto",optional:true},strokeWidth:{value:q,optional:true},opacity:{value:P,scale:"auto",optional:true}}}function applyTitle(e,t){t&&e.filter((e=>nonempty(t[e]))).append("title").call(applyText,t)}function applyTitleGroup(e,t){t&&e.filter((([e])=>nonempty(t[e]))).append("title").call(applyTextGroup,t)}function applyText(e,t){t&&e.text((e=>Uo(t[e])))}function applyTextGroup(e,t){t&&e.text((([e])=>Uo(t[e])))}function applyChannelStyles(e,{target:t,tip:n},{ariaLabel:r,title:o,fill:a,fillOpacity:i,stroke:l,strokeOpacity:s,strokeWidth:c,opacity:u,href:f}){r&&applyAttr(e,"aria-label",(e=>r[e]));a&&applyAttr(e,"fill",(e=>a[e]));i&&applyAttr(e,"fill-opacity",(e=>i[e]));l&&applyAttr(e,"stroke",(e=>l[e]));s&&applyAttr(e,"stroke-opacity",(e=>s[e]));c&&applyAttr(e,"stroke-width",(e=>c[e]));u&&applyAttr(e,"opacity",(e=>u[e]));f&&applyHref(e,(e=>f[e]),t);n||applyTitle(e,o)}function applyGroupedChannelStyles(e,{target:t,tip:n},{ariaLabel:r,title:o,fill:a,fillOpacity:i,stroke:l,strokeOpacity:s,strokeWidth:c,opacity:u,href:f}){r&&applyAttr(e,"aria-label",(([e])=>r[e]));a&&applyAttr(e,"fill",(([e])=>a[e]));i&&applyAttr(e,"fill-opacity",(([e])=>i[e]));l&&applyAttr(e,"stroke",(([e])=>l[e]));s&&applyAttr(e,"stroke-opacity",(([e])=>s[e]));c&&applyAttr(e,"stroke-width",(([e])=>c[e]));u&&applyAttr(e,"opacity",(([e])=>u[e]));f&&applyHref(e,(([e])=>f[e]),t);n||applyTitleGroup(e,o)}function groupAesthetics({ariaLabel:e,title:t,fill:n,fillOpacity:r,stroke:o,strokeOpacity:a,strokeWidth:i,opacity:l,href:s},{tip:c}){return[e,c?void 0:t,n,r,o,a,i,l,s].filter((e=>e!==void 0))}function groupZ(e,t,n){const r=Q(e,(e=>t[e]));n===void 0&&r.size>1+e.length>>1&&warn("Warning: the implicit z channel has high cardinality. This may occur when the fill or stroke channel is associated with quantitative data rather than ordinal or categorical data. You can suppress this warning by setting the z option explicitly; if this data represents a single series, set z to null.");return r.values()}function*groupIndex(e,t,n,r){const{z:o}=n;const{z:a}=r;const i=groupAesthetics(r,n);const l=[...t,...i];for(const t of a?groupZ(e,a,o):[e]){let e;let n;e:for(const r of t){for(const e of l)if(!defined(e[r])){n&&n.push(-1);continue e}if(e!==void 0){n.push(r);for(let t=0;t<i.length;++t){const o=keyof(i[t][r]);if(o!==e[t]){yield n;e=i.map((e=>keyof(e[r]))),n=[r];continue e}}}else{n&&(yield n);e=i.map((e=>keyof(e[r]))),n=[r]}}n&&(yield n)}}function applyClip(e,t,n,r){let o;const{clip:a=r.clip}=t;if(a==="frame"){e=create("svg:g",r).each((function(){this.appendChild(e.node());e.node=()=>this}));o=ta(r,n)}else a&&(o=getGeoClip(a,r));applyAttr(e,"aria-label",t.ariaLabel);applyAttr(e,"aria-description",t.ariaDescription);applyAttr(e,"aria-hidden",t.ariaHidden);applyAttr(e,"clip-path",o)}function memoizeClip(e){const t=new WeakMap;return(n,r)=>{let o=t.get(n);if(!o){const a=getClipId();Rn(n.ownerSVGElement).append("clipPath").attr("id",a).call(e,n,r);t.set(n,o=`url(#${a})`)}return o}}const ta=memoizeClip(((e,t,n)=>{const{width:r,height:o,marginLeft:a,marginRight:i,marginTop:l,marginBottom:s}=n;e.append("rect").attr("x",a).attr("y",l).attr("width",r-i-a).attr("height",o-l-s)}));const na=new WeakMap;const ra={type:"Sphere"};function getGeoClip(e,t){let n,r;(n=na.get(t))||na.set(t,n=new WeakMap);e.type==="Sphere"&&(e=ra);if(!(r=n.get(e))){const o=getClipId();Rn(t.ownerSVGElement).append("clipPath").attr("id",o).append("path").attr("d",t.path()(e));n.set(e,r=`url(#${o})`)}return r}function applyIndirectStyles(e,t,n,r){applyClip(e,t,n,r);applyAttr(e,"class",t.className);applyAttr(e,"fill",t.fill);applyAttr(e,"fill-opacity",t.fillOpacity);applyAttr(e,"stroke",t.stroke);applyAttr(e,"stroke-width",t.strokeWidth);applyAttr(e,"stroke-opacity",t.strokeOpacity);applyAttr(e,"stroke-linejoin",t.strokeLinejoin);applyAttr(e,"stroke-linecap",t.strokeLinecap);applyAttr(e,"stroke-miterlimit",t.strokeMiterlimit);applyAttr(e,"stroke-dasharray",t.strokeDasharray);applyAttr(e,"stroke-dashoffset",t.strokeDashoffset);applyAttr(e,"shape-rendering",t.shapeRendering);applyAttr(e,"filter",t.imageFilter);applyAttr(e,"paint-order",t.paintOrder);const{pointerEvents:o=(r.pointerSticky===false?"none":void 0)}=t;applyAttr(e,"pointer-events",o)}function applyDirectStyles(e,t){applyStyle(e,"mix-blend-mode",t.mixBlendMode);applyAttr(e,"opacity",t.opacity)}function applyHref(e,t,n){e.each((function(e){const r=t(e);if(r!=null){const e=this.ownerDocument.createElementNS(Dn.svg,"a");e.setAttribute("fill","inherit");e.setAttributeNS(Dn.xlink,"href",r);n!=null&&e.setAttribute("target",n);this.parentNode.insertBefore(e,this).appendChild(this)}}))}function applyAttr(e,t,n){n!=null&&e.attr(t,n)}function applyStyle(e,t,n){n!=null&&e.style(t,n)}function applyTransform(e,t,{x:n,y:r},o=Qo,a=Qo){o+=t.dx;a+=t.dy;n?.bandwidth&&(o+=n.bandwidth()/2);r?.bandwidth&&(a+=r.bandwidth()/2);(o||a)&&e.attr("transform",`translate(${o},${a})`)}function impliedString(e,t){if((e=string(e))!==t)return e}function impliedNumber(e,t){if((e=number$1(e))!==t)return e}const oa=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function maybeClassName(e){if(e===void 0)return"plot-d6a7b5";e=`${e}`;if(!oa.test(e))throw new Error(`invalid class name: ${e}`);return e}function applyInlineStyles(e,t){if(typeof t==="string")e.property("style",t);else if(t!=null)for(const n of e)Object.assign(n.style,t)}function applyFrameAnchor({frameAnchor:e},{width:t,height:n,marginTop:r,marginRight:o,marginBottom:a,marginLeft:i}){return[/left$/.test(e)?i:/right$/.test(e)?t-o:(i+t-o)/2,/^top/.test(e)?r:/^bottom/.test(e)?n-a:(r+n-a)/2]}class Mark{constructor(e,t={},n={},r){const{facet:o="auto",facetAnchor:a,fx:i,fy:l,sort:s,dx:c=0,dy:u=0,margin:f=0,marginTop:d=f,marginRight:p=f,marginBottom:h=f,marginLeft:m=f,className:y,clip:g=r?.clip,channels:b,tip:x,render:w}=n;this.data=e;this.sort=isDomainSort(s)?s:null;this.initializer=initializer(n).initializer;this.transform=this.initializer?n.transform:basic(n).transform;if(o===null||o===false)this.facet=null;else{this.facet=keyword(o===true?"include":o,"facet",["auto","include","exclude","super"]);this.fx=e===eo&&typeof i==="string"?[i]:i;this.fy=e===eo&&typeof l==="string"?[l]:l}this.facetAnchor=maybeFacetAnchor(a);t=maybeNamed(t);b!==void 0&&(t={...maybeChannels(b),...t});r!==void 0&&(t={...styles(this,n,r),...t});this.channels=Object.fromEntries(Object.entries(t).map((([t,n])=>{if(isOptions(n.value)){const{value:e,label:t=n.label,scale:r=n.scale}=n.value;n={...n,label:t,scale:r,value:e}}if(e===eo&&typeof n.value==="string"){const{value:e}=n;n={...n,value:[e]}}return[t,n]})).filter((([e,{value:t,optional:n}])=>{if(t!=null)return true;if(n)return false;throw new Error(`missing channel value: ${e}`)})));this.dx=+c;this.dy=+u;this.marginTop=+d;this.marginRight=+p;this.marginBottom=+h;this.marginLeft=+m;this.clip=maybeClip(g);this.tip=maybeTip(x);this.className=string(y);if(this.facet==="super"){if(i||l)throw new Error("super-faceting cannot use fx or fy");for(const e in this.channels){const{scale:n}=t[e];if(n==="x"||n==="y")throw new Error("super-faceting cannot use x or y")}}w!=null&&(this.render=composeRender(w,this.render))}initialize(e,t,n){let r=dataify(this.data);e===void 0&&r!=null&&(e=[range(r)]);const o=e;this.transform!=null&&(({facets:e,data:r}=this.transform(r,e,n)),r=dataify(r));e!==void 0&&(e.original=o);const a=createChannels(this.channels,r);this.sort!=null&&channelDomain(r,e,a,t,this.sort);return{data:r,facets:e,channels:a}}filter(e,t,n){for(const r in t){const{filter:o=defined}=t[r];if(o!==null){const t=n[r];e=e.filter((e=>o(t[e])))}}return e}project(e,t,n){for(const r in e)if(e[r].scale==="x"&&/^x|x$/.test(r)){const o=r.replace(/^x|x$/,"y");o in e&&e[o].scale==="y"&&project(r,o,t,n.projection)}}scale(e,t,n){const r=valueObject(e,t);n.projection&&this.project(e,r,n);return r}}function marks(...e){e.plot=Mark.prototype.plot;return e}function composeRender(e,t){if(e==null)return t===null?void 0:t;if(t==null)return e===null?void 0:e;if(typeof e!=="function")throw new TypeError(`invalid render transform: ${e}`);if(typeof t!=="function")throw new TypeError(`invalid render transform: ${t}`);return function(n,r,o,a,i,l){return e.call(this,n,r,o,a,i,((e,n,r,o,a)=>t.call(this,e,n,r,o,a,l)))}}function maybeChannels(e){return Object.fromEntries(Object.entries(maybeNamed(e)).map((([e,t])=>{t=typeof t==="string"?{value:t,label:e}:maybeValue(t);t.filter===void 0&&t.scale==null&&(t={...t,filter:null});return[e,t]})))}function maybeTip(e){return e===true?"xy":e===false||e==null?null:typeof e==="string"?keyword(e,"tip",["x","y","xy"]):e}function withTip(e,t){return e?.tip===true?{...e,tip:t}:isObject(e?.tip)&&e.tip.pointer===void 0?{...e,tip:{...e.tip,pointer:t}}:e}function createDimensions(e,t,n={}){let r=.5-Qo,o=.5+Qo,a=.5+Qo,i=.5-Qo;for(const{marginTop:e,marginRight:n,marginBottom:l,marginLeft:s}of t){e>r&&(r=e);n>o&&(o=n);l>a&&(a=l);s>i&&(i=s)}let{margin:l,marginTop:s=(l!==void 0?l:r),marginRight:c=(l!==void 0?l:o),marginBottom:u=(l!==void 0?l:a),marginLeft:f=(l!==void 0?l:i)}=n;s=+s;c=+c;u=+u;f=+f;let{width:d=640,height:p=autoHeight(e,n,{width:d,marginTopDefault:r,marginRightDefault:o,marginBottomDefault:a,marginLeftDefault:i})+Math.max(0,s-r+u-a)}=n;d=+d;p=+p;const h={width:d,height:p,marginTop:s,marginRight:c,marginBottom:u,marginLeft:f};if(e.fx||e.fy){let{margin:e,marginTop:t=(e!==void 0?e:s),marginRight:r=(e!==void 0?e:c),marginBottom:o=(e!==void 0?e:u),marginLeft:a=(e!==void 0?e:f)}=n.facet??{};t=+t;r=+r;o=+o;a=+a;h.facet={marginTop:t,marginRight:r,marginBottom:o,marginLeft:a}}return h}function autoHeight({x:e,y:t,fy:n,fx:r},{projection:o,aspectRatio:a},{width:i,marginTopDefault:l,marginRightDefault:s,marginBottomDefault:c,marginLeftDefault:u}){const f=n&&n.scale.domain().length||1;const d=projectionAspectRatio(o);if(d){const e=r?r.scale.domain().length:1;const t=(1.1*f-.1)/(1.1*e-.1)*d;const n=Math.max(.1,Math.min(10,t));return Math.round((i-u-s)*n+l+c)}const p=t?isOrdinalScale(t)?t.scale.domain().length||1:Math.max(7,17/f):1;if(a!=null){a=+a;if(!(isFinite(a)&&a>0))throw new Error(`invalid aspectRatio: ${a}`);const o=aspectRatioLength("y",t)/(aspectRatioLength("x",e)*a);const f=r?r.scale.bandwidth():1;const d=n?n.scale.bandwidth():1;const p=f*(i-u-s)-e.insetLeft-e.insetRight;return(o*p+t.insetTop+t.insetBottom)/d+l+c}return!!(t||n)*Math.max(1,Math.min(60,p*f))*20+!!r*30+60}function aspectRatioLength(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);const{type:n,domain:r}=t;let o;switch(n){case"linear":case"utc":case"time":o=Number;break;case"pow":{const e=t.scale.exponent();o=t=>Math.pow(t,e);break}case"log":o=Math.log;break;case"point":case"band":return r.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${n}`)}const[a,i]=Pt(r);return Math.abs(o(i)-o(a))}const aa=new WeakMap;function pointerK(e,t,{x:n,y:r,px:o,py:a,maxRadius:i=40,channels:l,render:s,...c}={}){i=+i;o!=null&&(n??=null,l={...l,px:{value:o,scale:"x"}});a!=null&&(r??=null,l={...l,py:{value:a,scale:"y"}});return{x:n,y:r,channels:l,...c,render:composeRender((function(n,r,o,a,l,s){l={...l,pointerSticky:false};const c=l.ownerSVGElement;const{data:u}=l.getMarkState(this);let f=aa.get(c);f||aa.set(c,f={sticky:false,roots:[],renders:[]});let d=f.renders.push(render)-1;const{x:p,y:h,fx:m,fy:y}=r;let g=m?m(n.fx)-a.marginLeft:0;let b=y?y(n.fy)-a.marginTop:0;p?.bandwidth&&(g+=p.bandwidth()/2);h?.bandwidth&&(b+=h.bandwidth()/2);const x=n.fi!=null;let w;if(x){let e=f.facetStates;e||(f.facetStates=e=new Map);w=e.get(this);w||e.set(this,w=new Map)}const[k,S]=applyFrameAnchor(this,a);const{px:A,py:$}=o;const M=A?e=>A[e]:anchorX$1(o,k);const T=$?e=>$[e]:anchorY$1(o,S);let C;let O;let I;let L;function update(e,t){if(x){L&&(L=cancelAnimationFrame(L));if(e!=null){w.set(n.fi,t);L=requestAnimationFrame((()=>{L=null;for(const[r,o]of w)if(o<t||o===t&&r<n.fi){e=null;break}render(e)}));return}w.delete(n.fi)}render(e)}function render(e){if(C===e&&I===f.sticky)return;C=e;I=l.pointerSticky=f.sticky;const t=C==null?[]:[C];x&&(t.fx=n.fx,t.fy=n.fy,t.fi=n.fi);const i=s(t,r,o,a,l);if(O){if(x){const e=O.parentNode;const t=O.getAttribute("transform");const n=i.getAttribute("transform");t?i.setAttribute("transform",t):i.removeAttribute("transform");n?e.setAttribute("transform",n):e.removeAttribute("transform");i.removeAttribute("aria-label");i.removeAttribute("aria-description");i.removeAttribute("aria-hidden")}O.replaceWith(i)}f.roots[d]=O=i;if(!(C==null&&w?.size>1)){const e=C==null?null:isArray(u)?u[C]:u.get(C);l.dispatchValue(e)}return i}function pointermove(r){if(f.sticky||r.pointerType==="mouse"&&r.buttons===1)return;let[o,l]=En(r);o-=g,l-=b;const s=o<a.marginLeft||o>a.width-a.marginRight?1:e;const c=l<a.marginTop||l>a.height-a.marginBottom?1:t;let u=null;let d=i*i;for(const e of n){const t=s*(M(e)-o);const n=c*(T(e)-l);const r=t*t+n*n;r<=d&&(u=e,d=r)}if(u!=null&&(e!==1||t!==1)){const e=M(u)-o;const t=T(u)-l;d=e*e+t*t}update(u,d)}function pointerdown(e){if(e.pointerType==="mouse"&&C!=null&&(!f.sticky||!f.roots.some((t=>t?.contains(e.target))))){f.sticky?(f.sticky=false,f.renders.forEach((e=>e(null)))):(f.sticky=true,render(C));e.stopImmediatePropagation()}}function pointerleave(e){e.pointerType==="mouse"&&(f.sticky||update(null))}c.addEventListener("pointerenter",pointermove);c.addEventListener("pointermove",pointermove);c.addEventListener("pointerdown",pointerdown);c.addEventListener("pointerleave",pointerleave);return render(null)}),s)}}function pointer(e){return pointerK(1,1,e)}function pointerX(e){return pointerK(1,.01,e)}function pointerY(e){return pointerK(.01,1,e)}function anchorX$1({x1:e,x2:t,x:n=e},r){return e&&t?n=>(e[n]+t[n])/2:n?e=>n[e]:()=>r}function anchorY$1({y1:e,y2:t,y:n=e},r){return e&&t?n=>(e[n]+t[n])/2:n?e=>n[e]:()=>r}function inferFontVariant$2(e){return isOrdinalScale(e)&&e.interval===void 0?void 0:"tabular-nums"}function legendRamp(e,t){let{label:n=e.label,tickSize:r=6,width:o=240,height:a=44+r,marginTop:i=18,marginRight:l=0,marginBottom:s=16+r,marginLeft:c=0,style:u,ticks:f=(o-c-l)/64,tickFormat:d,fontVariant:p=inferFontVariant$2(e),round:h=true,opacity:m,className:y}=t;const g=createContext(t);y=maybeClassName(y);m=maybeNumberChannel(m)[1];d===null&&(d=()=>null);const b=create("svg",g).attr("class",`${y}-ramp`).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",o).attr("height",a).attr("viewBox",`0 0 ${o} ${a}`).call((e=>e.append("style").text(`:where(.${y}-ramp) {\n  display: block;\n  height: auto;\n  height: intrinsic;\n  max-width: 100%;\n  overflow: visible;\n}\n:where(.${y}-ramp text) {\n  white-space: pre;\n}`))).call(applyInlineStyles,u);let tickAdjust=e=>e.selectAll(".tick line").attr("y1",i+s-a);let x;const w=h?(e,t)=>e.rangeRound(t):(e,t)=>e.range(t);const{type:k,domain:S,range:A,interpolate:$,scale:M,pivot:T}=e;if($){const e=A===void 0?$:Wt($.length===1?interpolatePiecewise($):$,A);x=w(M.copy(),Dt(Et(c,o-l),Math.min(S.length+(T!==void 0),A===void 0?Infinity:A.length)));const t=256;const n=g.document.createElement("canvas");n.width=t;n.height=1;const r=n.getContext("2d");for(let n=0,o=t-1;n<t;++n){r.fillStyle=e(n/o);r.fillRect(n,0,1,1)}b.append("image").attr("opacity",m).attr("x",c).attr("y",i).attr("width",o-c-l).attr("height",a-i-s).attr("preserveAspectRatio","none").attr("xlink:href",n.toDataURL())}else if(k==="threshold"){const e=S;const t=d===void 0?e=>e:typeof d==="string"?Fn(d):d;x=w(Gt().domain([-1,A.length-1]),[c,o-l]);b.append("g").attr("fill-opacity",m).selectAll().data(A).enter().append("rect").attr("x",((e,t)=>x(t-1))).attr("y",i).attr("width",((e,t)=>x(t)-x(t-1))).attr("height",a-i-s).attr("fill",(e=>e));f=map$1(e,((e,t)=>t));d=n=>t(e[n],n)}else{x=w(un().domain(S),[c,o-l]);b.append("g").attr("fill-opacity",m).selectAll().data(S).enter().append("rect").attr("x",x).attr("y",i).attr("width",Math.max(0,x.bandwidth()-1)).attr("height",a-i-s).attr("fill",M);tickAdjust=()=>{}}b.append("g").attr("transform",`translate(0,${a-s})`).call(Yn(x).ticks(Array.isArray(f)?null:f,typeof d==="string"?d:void 0).tickFormat(typeof d==="function"?d:void 0).tickSize(r).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",impliedString(p,"normal")).call(tickAdjust).call((e=>e.select(".domain").remove()));n!==void 0&&b.append("text").attr("x",c).attr("y",i-6).attr("fill","currentColor").attr("font-weight","bold").text(n);return b.node()}const ia=Math.PI/180;function markers(e,{marker:t,markerStart:n=t,markerMid:r=t,markerEnd:o=t}={}){e.markerStart=maybeMarker(n);e.markerMid=maybeMarker(r);e.markerEnd=maybeMarker(o)}function maybeMarker(e){if(e==null||e===false)return null;if(e===true)return markerCircleFill;if(typeof e==="function")return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return markerArrow("auto");case"arrow-reverse":return markerArrow("auto-start-reverse");case"dot":return markerDot;case"circle":case"circle-fill":return markerCircleFill;case"circle-stroke":return markerCircleStroke;case"tick":return markerTick("auto");case"tick-x":return markerTick(90);case"tick-y":return markerTick(0)}throw new Error(`invalid marker: ${e}`)}function markerArrow(e){return(t,n)=>create("svg:marker",n).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient",e).attr("fill","none").attr("stroke",t).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call((e=>e.append("path").attr("d","M-1.5,-3l3,3l-3,3"))).node()}function markerDot(e,t){return create("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call((e=>e.append("circle").attr("r",2.5))).node()}function markerCircleFill(e,t){return create("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","var(--plot-background)").attr("stroke-width",1.5).call((e=>e.append("circle").attr("r",3))).node()}function markerCircleStroke(e,t){return create("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","var(--plot-background)").attr("stroke",e).attr("stroke-width",1.5).call((e=>e.append("circle").attr("r",3))).node()}function markerTick(e){return(t,n)=>create("svg:marker",n).attr("viewBox","-3 -3 6 6").attr("markerWidth",6).attr("markerHeight",6).attr("orient",e).attr("stroke",t).call((e=>e.append("path").attr("d","M0,-3v6"))).node()}let la=0;function applyMarkers(e,t,{stroke:n},r){return applyMarkersColor(e,t,n&&(e=>n[e]),null,r)}function applyGroupedMarkers(e,t,{stroke:n,z:r},o){return applyMarkersColor(e,t,n&&(([e])=>n[e]),r,o)}const sa=1;const ca=2;function getGroupedOrientation(e,t){const n=new Uint8Array(t.length);const r=e.data().filter((e=>e.length>1));const o=r.length;for(let e=0,a=_o;e<o;++e){const o=r[e];if(o.length>1){const e=o[0];a!==(a=keyof(t[e]))&&(n[e]|=sa)}}for(let e=o-1,a=_o;e>=0;--e){const o=r[e];if(o.length>1){const e=o[0];a!==(a=keyof(t[e]))&&(n[e]|=ca)}}return([e])=>n[e]}function applyMarkersColor(e,{markerStart:t,markerMid:n,markerEnd:r,stroke:o},a=()=>o,i,l){if(!t&&!n&&!r)return;const s=new Map;const c=i&&getGroupedOrientation(e,i);function applyMarker(e,t,n){return function(r){if(n&&!n(r))return;const o=a(r);let i=s.get(t);i||s.set(t,i=new Map);let c=i.get(o);if(!c){const e=this.parentNode.insertBefore(t(o,l),this);const n="plot-marker-"+ ++la;e.setAttribute("id",n);i.set(o,c=`url(#${n})`)}this.setAttribute(e,c)}}t&&e.each(applyMarker("marker-start",t,c&&(e=>c(e)&sa)));n&&c&&e.each(applyMarker("marker-start",n,(e=>!(c(e)&sa))));n&&e.each(applyMarker("marker-mid",n));r&&e.each(applyMarker("marker-end",r,c&&(e=>c(e)&ca)))}function maybeInsetX({inset:e,insetLeft:t,insetRight:n,...r}={}){[t,n]=maybeInset(e,t,n);return{inset:e,insetLeft:t,insetRight:n,...r}}function maybeInsetY({inset:e,insetTop:t,insetBottom:n,...r}={}){[t,n]=maybeInset(e,t,n);return{inset:e,insetTop:t,insetBottom:n,...r}}function maybeInset(e,t,n){return e===void 0&&t===void 0&&n===void 0?Qo?[1,0]:[.5,.5]:[t,n]}function maybeIntervalValue(e,{interval:t}){e={...maybeValue(e)};e.interval=maybeInterval(e.interval===void 0?t:e.interval);return e}function maybeIntervalK(e,t,n,r){const{[e]:o,[`${e}1`]:a,[`${e}2`]:i}=n;const{value:l,interval:s}=maybeIntervalValue(o,n);if(l==null||s==null&&!r)return n;const c=labelof(o);if(s==null){let t;const o={transform:e=>t||(t=valueof(e,l)),label:c};return{...n,[e]:void 0,[`${e}1`]:a===void 0?o:a,[`${e}2`]:i!==void 0||a===i&&r?i:o}}let u,f;function transform(e){return f!==void 0&&e===u?f:f=map$1(valueof(u=e,l),(e=>s.floor(e)))}return t({...n,[e]:void 0,[`${e}1`]:a===void 0?{transform:transform,label:c}:a,[`${e}2`]:i===void 0?{transform:e=>transform(e).map((e=>s.offset(e))),label:c}:i})}function maybeIntervalMidK(e,t,n){const{[e]:r}=n;const{value:o,interval:a}=maybeIntervalValue(r,n);return o==null||a==null?n:t({...n,[e]:{label:labelof(r),transform:e=>{const t=map$1(valueof(e,o),(e=>a.floor(e)));const n=t.map((e=>a.offset(e)));return t.map(isTemporal(t)?(e,t)=>e==null||isNaN(e=+e)||(t=n[t],t==null)||isNaN(t=+t)?void 0:new Date((e+t)/2):(e,t)=>e==null||(t=n[t],t==null)?NaN:(+e+ +t)/2)}}})}function maybeTrivialIntervalX(e={}){return maybeIntervalK("x",maybeInsetX,e,true)}function maybeTrivialIntervalY(e={}){return maybeIntervalK("y",maybeInsetY,e,true)}function maybeIntervalX(e={}){return maybeIntervalK("x",maybeInsetX,e)}function maybeIntervalY(e={}){return maybeIntervalK("y",maybeInsetY,e)}function maybeIntervalMidX(e={}){return maybeIntervalMidK("x",maybeInsetX,e)}function maybeIntervalMidY(e={}){return maybeIntervalMidK("y",maybeInsetY,e)}const ua={ariaLabel:"rule",fill:null,stroke:"currentColor"};class RuleX extends Mark{constructor(e,t={}){const{x:n,y1:r,y2:o,inset:a=0,insetTop:i=a,insetBottom:l=a}=t;super(e,{x:{value:n,scale:"x",optional:true},y1:{value:r,scale:"y",optional:true},y2:{value:o,scale:"y",optional:true}},withTip(t,"x"),ua);this.insetTop=number$1(i);this.insetBottom=number$1(l);markers(this,t)}render(e,t,n,r,o){const{x:a,y:i}=t;const{x:l,y1:s,y2:c}=n;const{width:u,height:f,marginTop:d,marginRight:p,marginLeft:h,marginBottom:m}=r;const{insetTop:y,insetBottom:g}=this;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{x:l&&a},Qo,0).call((t=>t.selectAll().data(e).enter().append("line").call(applyDirectStyles,this).attr("x1",l?e=>l[e]:(h+u-p)/2).attr("x2",l?e=>l[e]:(h+u-p)/2).attr("y1",s&&!isCollapsed(i)?e=>s[e]+y:d+y).attr("y2",c&&!isCollapsed(i)?i.bandwidth?e=>c[e]+i.bandwidth()-g:e=>c[e]-g:f-m-g).call(applyChannelStyles,this,n).call(applyMarkers,this,n,o))).node()}}class RuleY extends Mark{constructor(e,t={}){const{x1:n,x2:r,y:o,inset:a=0,insetRight:i=a,insetLeft:l=a}=t;super(e,{y:{value:o,scale:"y",optional:true},x1:{value:n,scale:"x",optional:true},x2:{value:r,scale:"x",optional:true}},withTip(t,"y"),ua);this.insetRight=number$1(i);this.insetLeft=number$1(l);markers(this,t)}render(e,t,n,r,o){const{x:a,y:i}=t;const{y:l,x1:s,x2:c}=n;const{width:u,height:f,marginTop:d,marginRight:p,marginLeft:h,marginBottom:m}=r;const{insetLeft:y,insetRight:g}=this;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{y:l&&i},0,Qo).call((t=>t.selectAll().data(e).enter().append("line").call(applyDirectStyles,this).attr("x1",s&&!isCollapsed(a)?e=>s[e]+y:h+y).attr("x2",c&&!isCollapsed(a)?a.bandwidth?e=>c[e]+a.bandwidth()-g:e=>c[e]-g:u-p-g).attr("y1",l?e=>l[e]:(d+f-m)/2).attr("y2",l?e=>l[e]:(d+f-m)/2).call(applyChannelStyles,this,n).call(applyMarkers,this,n,o))).node()}}function ruleX(e,t){let{x:n=no,y:r,y1:o,y2:a,...i}=maybeIntervalY(t);[o,a]=maybeOptionalZero(r,o,a);return new RuleX(e,{...i,x:n,y1:o,y2:a})}function ruleY(e,t){let{y:n=no,x:r,x1:o,x2:a,...i}=maybeIntervalX(t);[o,a]=maybeOptionalZero(r,o,a);return new RuleY(e,{...i,y:n,x1:o,x2:a})}function maybeOptionalZero(e,t,n){if(e==null){if(t===void 0){if(n!==void 0)return[0,n]}else if(n===void 0)return[0,t]}else{if(t===void 0)return n===void 0?[0,e]:[e,n];if(n===void 0)return[e,t]}return[t,n]}function template(e,...t){let n=t.length;for(let r=0,o=true;r<n;++r)if(typeof t[r]!=="function"){if(o){e=e.slice();o=false}e.splice(r,2,e[r]+t[r]+e[r+1]);t.splice(r,1);--r,--n}return r=>{let o=e[0];for(let a=0;a<n;++a)o+=t[a](r)+e[a+1];return o}}const fa={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"};const da="Â­";class Text extends Mark{constructor(e,t={}){const{x:n,y:r,text:o=(isIterable(e)&&isTextual(e)?no:to),frameAnchor:a,textAnchor:i=(/right$/i.test(a)?"end":/left$/i.test(a)?"start":"middle"),lineAnchor:l=(/^top/i.test(a)?"top":/^bottom/i.test(a)?"bottom":"middle"),lineHeight:s=1,lineWidth:c=Infinity,textOverflow:u,monospace:f,fontFamily:d=(f?"ui-monospace, monospace":void 0),fontSize:p,fontStyle:h,fontVariant:m,fontWeight:y,rotate:g}=t;const[b,x]=maybeNumberChannel(g,0);const[w,k]=maybeFontSizeChannel(p);super(e,{x:{value:n,scale:"x",optional:true},y:{value:r,scale:"y",optional:true},fontSize:{value:w,optional:true},rotate:{value:numberChannel(b),optional:true},text:{value:o,filter:nonempty,optional:true}},t,fa);this.rotate=x;this.textAnchor=impliedString(i,"middle");this.lineAnchor=keyword(l,"lineAnchor",["top","middle","bottom"]);this.lineHeight=+s;this.lineWidth=+c;this.textOverflow=maybeTextOverflow(u);this.monospace=!!f;this.fontFamily=string(d);this.fontSize=k;this.fontStyle=string(h);this.fontVariant=string(m);this.fontWeight=string(y);this.frameAnchor=maybeFrameAnchor(a);if(!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${c}`);this.splitLines=splitter(this);this.clipLine=clipper(this)}render(e,t,n,r,o){const{x:a,y:i}=t;const{x:l,y:s,rotate:c,text:u,title:f,fontSize:d}=n;const{rotate:p}=this;const[h,m]=applyFrameAnchor(this,r);return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyIndirectTextStyles,this,u,r).call(applyTransform,this,{x:l&&a,y:s&&i}).call((t=>t.selectAll().data(e).enter().append("text").call(applyDirectStyles,this).call(applyMultilineText,this,u,f).attr("transform",template`translate(${l?e=>l[e]:h},${s?e=>s[e]:m})${c?e=>` rotate(${c[e]})`:p?` rotate(${p})`:""}`).call(applyAttr,"font-size",d&&(e=>d[e])).call(applyChannelStyles,this,n))).node()}}function maybeTextOverflow(e){return e==null?null:keyword(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}function applyMultilineText(e,t,n,r){if(!n)return;const{lineAnchor:o,lineHeight:a,textOverflow:i,splitLines:l,clipLine:s}=t;e.each((function(e){const t=l(Uo(n[e])??"").map(s);const c=t.length;const u=o==="top"?.71:o==="bottom"?1-c:(164-c*100)/200;if(c>1){let e=0;for(let n=0;n<c;++n){++e;if(!t[n])continue;const r=this.ownerDocument.createElementNS(Dn.svg,"tspan");r.setAttribute("x",0);n===e-1?r.setAttribute("y",(u+n)*a+"em"):r.setAttribute("dy",e*a+"em");r.textContent=t[n];this.appendChild(r);e=0}}else{u&&this.setAttribute("y",u*a+"em");this.textContent=t[0]}if(i&&!r&&t[0]!==n[e]){const t=this.ownerDocument.createElementNS(Dn.svg,"title");t.textContent=n[e];this.appendChild(t)}}))}function text(e,{x:t,y:n,...r}={}){r.frameAnchor===void 0&&([t,n]=maybeTuple(t,n));return new Text(e,{...r,x:t,y:n})}function textX(e,{x:t=no,...n}={}){return new Text(e,maybeIntervalMidY({...n,x:t}))}function textY(e,{y:t=no,...n}={}){return new Text(e,maybeIntervalMidX({...n,y:t}))}function applyIndirectTextStyles(e,t,n){applyAttr(e,"text-anchor",t.textAnchor);applyAttr(e,"font-family",t.fontFamily);applyAttr(e,"font-size",t.fontSize);applyAttr(e,"font-style",t.fontStyle);applyAttr(e,"font-variant",t.fontVariant===void 0?inferFontVariant$1(n):t.fontVariant);applyAttr(e,"font-weight",t.fontWeight)}function inferFontVariant$1(e){return e&&(isNumeric(e)||isTemporal(e))?"tabular-nums":void 0}const pa=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]);function maybeFontSizeChannel(e){if(e==null||typeof e==="number")return[void 0,e];if(typeof e!=="string")return[e,void 0];e=e.trim().toLowerCase();return pa.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0]}function lineWrap(e,t,n){const r=[];let o,a=0;for(const[i,l,s]of lineBreaks(e)){o===void 0&&(o=i);if(a>o&&n(e,o,l)>t){r.push(e.slice(o,a)+(e[a-1]===da?"-":""));o=i}if(s){r.push(e.slice(o,l));o=void 0}else a=l}return r}function*lineBreaks(e){let t=0,n=0;const r=e.length;while(n<r){let r=1;switch(e[n]){case da:case"-":++n;yield[t,n,false];t=n;break;case" ":yield[t,n,false];while(e[++n]===" ");t=n;break;case"\r":e[n+1]==="\n"&&++r;case"\n":yield[t,n,true];n+=r;t=n;break;default:++n;break}}yield[t,n,true]}const ha={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"â€˜":31,"â€™":31,"â€œ":47,"â€":47,"â€¦":82};function defaultWidth(e,t=0,n=e.length){let r=0;for(let o=t;o<n;o=readCharacter(e,o))r+=ha[e[o]]??(isPictographic(e,o)?120:ha.e);return r}function monospaceWidth(e,t=0,n=e.length){let r=0;for(let o=t;o<n;o=readCharacter(e,o))r+=isPictographic(e,o)?126:63;return r}function splitter({monospace:e,lineWidth:t,textOverflow:n}){if(n!=null||t==Infinity)return e=>e.split(/\r\n?|\n/g);const r=e?monospaceWidth:defaultWidth;const o=t*100;return e=>lineWrap(e,o,r)}function clipper({monospace:e,lineWidth:t,textOverflow:n}){if(n==null||t==Infinity)return e=>e;const r=e?monospaceWidth:defaultWidth;const o=t*100;switch(n){case"clip-start":return e=>clipStart(e,o,r,"");case"clip-end":return e=>clipEnd(e,o,r,"");case"ellipsis-start":return e=>clipStart(e,o,r,ma);case"ellipsis-middle":return e=>clipMiddle(e,o,r,ma);case"ellipsis-end":return e=>clipEnd(e,o,r,ma)}}const ma="â€¦";function cut(e,t,n,r){const o=[];let a=0;for(let i=0,l=0,s=e.length;i<s;i=l){l=readCharacter(e,i);const s=n(e,i,l);if(a+s>t){a+=r;while(a>t&&i>0)l=i,i=o.pop(),a-=n(e,i,l);return[i,t-a]}a+=s;o.push(i)}return[-1,0]}function clipEnd(e,t,n,r){e=e.trim();const o=n(r);const[a]=cut(e,t,n,o);return a<0?e:e.slice(0,a).trimEnd()+r}function clipMiddle(e,t,n,r){e=e.trim();const o=n(e);if(o<=t)return e;const a=n(r)/2;const[i,l]=cut(e,t/2,n,a);const[s]=cut(e,o-t/2-l+a,n,-a);return s<0?r:e.slice(0,i).trimEnd()+r+e.slice(readCharacter(e,s)).trimStart()}function clipStart(e,t,n,r){e=e.trim();const o=n(e);if(o<=t)return e;const a=n(r);const[i]=cut(e,o-t+a,n,-a);return i<0?r:r+e.slice(readCharacter(e,i)).trimStart()}const ya=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy;const ga=/\p{Extended_Pictographic}/uy;function readCharacter(e,t){t+=isSurrogatePair(e,t)?2:1;isCombiner(e,t)&&(t=ya.lastIndex);return isZeroWidthJoiner(e,t)?readCharacter(e,t+1):t}function isAscii(e,t){return e.charCodeAt(t)<128}function isSurrogatePair(e,t){const n=e.charCodeAt(t);if(n>=55296&&n<56320){const n=e.charCodeAt(t+1);return n>=56320&&n<57344}return false}function isZeroWidthJoiner(e,t){return e.charCodeAt(t)===8205}function isCombiner(e,t){return!isAscii(e,t)&&(ya.lastIndex=t,ya.test(e))}function isPictographic(e,t){return!isAscii(e,t)&&(ga.lastIndex=t,ga.test(e))}const ba={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"};const va=3.5;const xa=va*5;const wa={draw(e,t,n){const r=t*n/xa;e.moveTo(0,0);e.lineTo(0,-t);e.moveTo(-r,r-t);e.lineTo(0,-t);e.lineTo(r,r-t)}};const ka={draw(e,t,n){e.moveTo(-n,0);e.lineTo(0,-t);e.lineTo(n,0)}};const Sa=new Map([["arrow",wa],["spike",ka]]);function isShapeObject(e){return e&&typeof e.draw==="function"}function maybeShape(e){if(isShapeObject(e))return e;const t=Sa.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}class Vector extends Mark{constructor(e,t={}){const{x:n,y:r,r:o=va,length:a,rotate:i,shape:l=wa,anchor:s="middle",frameAnchor:c}=t;const[u,f]=maybeNumberChannel(a,12);const[d,p]=maybeNumberChannel(i,0);super(e,{x:{value:n,scale:"x",optional:true},y:{value:r,scale:"y",optional:true},length:{value:u,scale:"length",optional:true},rotate:{value:d,optional:true}},t,ba);this.r=+o;this.length=f;this.rotate=p;this.shape=maybeShape(l);this.anchor=keyword(s,"anchor",["start","middle","end"]);this.frameAnchor=maybeFrameAnchor(c)}render(e,t,n,r,o){const{x:a,y:i}=t;const{x:l,y:s,length:c,rotate:u}=n;const{length:f,rotate:d,anchor:p,shape:h,r:m}=this;const[y,g]=applyFrameAnchor(this,r);return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{x:l&&a,y:s&&i}).call((t=>t.selectAll().data(e).enter().append("path").call(applyDirectStyles,this).attr("transform",template`translate(${l?e=>l[e]:y},${s?e=>s[e]:g})${u?e=>` rotate(${u[e]})`:d?` rotate(${d})`:""}${p==="start"?"":p==="end"?c?e=>` translate(0,${c[e]})`:` translate(0,${f})`:c?e=>` translate(0,${c[e]/2})`:` translate(0,${f/2})`}`).attr("d",c?e=>{const t=Xn();h.draw(t,c[e],m);return t}:(()=>{const e=Xn();h.draw(e,f,m);return e})()).call(applyChannelStyles,this,n))).node()}}function vector(e,t={}){let{x:n,y:r,...o}=t;t.frameAnchor===void 0&&([n,r]=maybeTuple(n,r));return new Vector(e,{...o,x:n,y:r})}function vectorX(e,t={}){const{x:n=no,...r}=t;return new Vector(e,{...r,x:n})}function vectorY(e,t={}){const{y:n=no,...r}=t;return new Vector(e,{...r,y:n})}function spike(e,t={}){const{shape:n=ka,stroke:r=ba.stroke,strokeWidth:o=1,fill:a=r,fillOpacity:i=.3,anchor:l="start",...s}=t;return vector(e,{...s,shape:n,stroke:r,strokeWidth:o,fill:a,fillOpacity:i,anchor:l})}function maybeData(e,t){arguments.length<2&&!isIterable(e)&&(t=e,e=null);t===void 0&&(t={});return[e,t]}function maybeAnchor$2({anchor:e}={},t){return e===void 0?t[0]:keyword(e,"anchor",t)}function anchorY(e){return maybeAnchor$2(e,["left","right"])}function anchorFy(e){return maybeAnchor$2(e,["right","left"])}function anchorX(e){return maybeAnchor$2(e,["bottom","top"])}function anchorFx(e){return maybeAnchor$2(e,["top","bottom"])}function axisY(){const[e,t]=maybeData(...arguments);return axisKy("y",anchorY(t),e,t)}function axisFy(){const[e,t]=maybeData(...arguments);return axisKy("fy",anchorFy(t),e,t)}function axisX(){const[e,t]=maybeData(...arguments);return axisKx("x",anchorX(t),e,t)}function axisFx(){const[e,t]=maybeData(...arguments);return axisKx("fx",anchorFx(t),e,t)}function axisKy(e,t,n,{color:r="currentColor",opacity:o=1,stroke:a=r,strokeOpacity:i=o,strokeWidth:l=1,fill:s=r,fillOpacity:c=o,textAnchor:u,textStroke:f,textStrokeOpacity:d,textStrokeWidth:p,tickSize:h=(e==="y"?6:0),tickPadding:m,tickRotate:y,x:g,margin:b,marginTop:x=(b===void 0?20:b),marginRight:w=(b===void 0?t==="right"?40:0:b),marginBottom:k=(b===void 0?20:b),marginLeft:S=(b===void 0?t==="left"?40:0:b),label:A,labelAnchor:$,labelArrow:M,labelOffset:T,ariaLabel:C=`${e}-axis`,...O}){h=number$1(h);m=number$1(m);y=number$1(y);$!==void 0&&($=keyword($,"labelAnchor",["center","top","bottom"]));M=maybeLabelArrow(M);return marks(h&&!isNoneish(a)?axisTickKy(e,t,n,{stroke:a,strokeOpacity:i,strokeWidth:l,tickSize:h,tickPadding:m,tickRotate:y,x:g,ariaLabel:C,...O}):null,isNoneish(s)?null:axisTextKy(e,t,n,{fill:s,fillOpacity:c,stroke:f,strokeOpacity:d,strokeWidth:p,textAnchor:u,tickSize:h,tickPadding:m,tickRotate:y,x:g,marginTop:x,marginRight:w,marginBottom:k,marginLeft:S,ariaLabel:C,...O}),isNoneish(s)||A===null?null:text([],labelOptions({fill:s,fillOpacity:c,...O},(function(n,r,o,a,i){const l=a[e];const{marginTop:s,marginRight:c,marginBottom:u,marginLeft:f}=e==="y"&&i.inset||i;const d=$??(l.bandwidth?"center":"top");const p=T??(t==="right"?c:f)-3;if(d==="center"){this.textAnchor=void 0;this.lineAnchor=t==="right"?"bottom":"top";this.frameAnchor=t;this.rotate=-90}else{this.textAnchor=t==="right"?"end":"start";this.lineAnchor=d;this.frameAnchor=`${d}-${t}`;this.rotate=0}this.dy=d==="top"?3-s:d==="bottom"?u-3:0;this.dx=t==="right"?p:-p;this.ariaLabel=`${C} label`;return{facets:[[0]],channels:{text:{value:[formatAxisLabel(e,l,{anchor:t,label:A,labelAnchor:d,labelArrow:M})]}}}}))))}function axisKx(e,t,n,{color:r="currentColor",opacity:o=1,stroke:a=r,strokeOpacity:i=o,strokeWidth:l=1,fill:s=r,fillOpacity:c=o,textAnchor:u,textStroke:f,textStrokeOpacity:d,textStrokeWidth:p,tickSize:h=(e==="x"?6:0),tickPadding:m,tickRotate:y,y:g,margin:b,marginTop:x=(b===void 0?t==="top"?30:0:b),marginRight:w=(b===void 0?20:b),marginBottom:k=(b===void 0?t==="bottom"?30:0:b),marginLeft:S=(b===void 0?20:b),label:A,labelAnchor:$,labelArrow:M,labelOffset:T,ariaLabel:C=`${e}-axis`,...O}){h=number$1(h);m=number$1(m);y=number$1(y);$!==void 0&&($=keyword($,"labelAnchor",["center","left","right"]));M=maybeLabelArrow(M);return marks(h&&!isNoneish(a)?axisTickKx(e,t,n,{stroke:a,strokeOpacity:i,strokeWidth:l,tickSize:h,tickPadding:m,tickRotate:y,y:g,ariaLabel:C,...O}):null,isNoneish(s)?null:axisTextKx(e,t,n,{fill:s,fillOpacity:c,stroke:f,strokeOpacity:d,strokeWidth:p,textAnchor:u,tickSize:h,tickPadding:m,tickRotate:y,y:g,marginTop:x,marginRight:w,marginBottom:k,marginLeft:S,ariaLabel:C,...O}),isNoneish(s)||A===null?null:text([],labelOptions({fill:s,fillOpacity:c,...O},(function(n,r,o,a,i){const l=a[e];const{marginTop:s,marginRight:c,marginBottom:u,marginLeft:f}=e==="x"&&i.inset||i;const d=$??(l.bandwidth?"center":"right");const p=T??(t==="top"?s:u)-3;if(d==="center"){this.frameAnchor=t;this.textAnchor=void 0}else{this.frameAnchor=`${t}-${d}`;this.textAnchor=d==="right"?"end":"start"}this.lineAnchor=t;this.dy=t==="top"?-p:p;this.dx=d==="right"?c-3:d==="left"?3-f:0;this.ariaLabel=`${C} label`;return{facets:[[0]],channels:{text:{value:[formatAxisLabel(e,l,{anchor:t,label:A,labelAnchor:d,labelArrow:M})]}}}}))))}function axisTickKy(e,t,n,{strokeWidth:r=1,strokeLinecap:o=null,strokeLinejoin:a=null,facetAnchor:i=t+(e==="y"?"-empty":""),frameAnchor:l=t,tickSize:s,inset:c=0,insetLeft:u=c,insetRight:f=c,dx:d=0,y:p=(e==="y"?void 0:null),ariaLabel:h,...m}){return axisMark(vectorY,e,n,{ariaLabel:`${h} tick`,ariaHidden:true},{strokeWidth:r,strokeLinecap:o,strokeLinejoin:a,facetAnchor:i,frameAnchor:l,y:p,...m,dx:t==="left"?+d-Qo+ +u:+d+Qo-f,anchor:"start",length:s,shape:t==="left"?Ma:Ta})}function axisTickKx(e,t,n,{strokeWidth:r=1,strokeLinecap:o=null,strokeLinejoin:a=null,facetAnchor:i=t+(e==="x"?"-empty":""),frameAnchor:l=t,tickSize:s,inset:c=0,insetTop:u=c,insetBottom:f=c,dy:d=0,x:p=(e==="x"?void 0:null),ariaLabel:h,...m}){return axisMark(vectorX,e,n,{ariaLabel:`${h} tick`,ariaHidden:true},{strokeWidth:r,strokeLinejoin:a,strokeLinecap:o,facetAnchor:i,frameAnchor:l,x:p,...m,dy:t==="bottom"?+d-Qo-f:+d+Qo+ +u,anchor:"start",length:s,shape:t==="bottom"?Aa:$a})}function axisTextKy(e,t,n,{facetAnchor:r=t+(e==="y"?"-empty":""),frameAnchor:o=t,tickSize:a,tickRotate:i=0,tickPadding:l=Math.max(3,9-a)+(Math.abs(i)>60?4*Math.cos(i*ia):0),text:s,textAnchor:c=(Math.abs(i)>60?"middle":t==="left"?"end":"start"),lineAnchor:u=(i>60?"top":i<-60?"bottom":"middle"),fontVariant:f,inset:d=0,insetLeft:p=d,insetRight:h=d,dx:m=0,ariaLabel:y,y:g=(e==="y"?void 0:null),...b}){return axisMark(textY,e,n,{ariaLabel:`${y} tick label`},{facetAnchor:r,frameAnchor:o,text:s,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:i,y:g,...b,dx:t==="left"?+m-a-l+ +p:+m+ +a+ +l-h},(function(e,n,r,o,a){f===void 0&&(this.fontVariant=inferFontVariant(e));s===void 0&&(a.text=inferTextChannel(e,n,r,o,t))}))}function axisTextKx(e,t,n,{facetAnchor:r=t+(e==="x"?"-empty":""),frameAnchor:o=t,tickSize:a,tickRotate:i=0,tickPadding:l=Math.max(3,9-a)+(Math.abs(i)>=10?4*Math.cos(i*ia):0),text:s,textAnchor:c=(Math.abs(i)>=10?i<0^t==="bottom"?"start":"end":"middle"),lineAnchor:u=(Math.abs(i)>=10?"middle":t==="bottom"?"top":"bottom"),fontVariant:f,inset:d=0,insetTop:p=d,insetBottom:h=d,dy:m=0,x:y=(e==="x"?void 0:null),ariaLabel:g,...b}){return axisMark(textX,e,n,{ariaLabel:`${g} tick label`},{facetAnchor:r,frameAnchor:o,text:s===void 0?null:s,textAnchor:c,lineAnchor:u,fontVariant:f,rotate:i,x:y,...b,dy:t==="bottom"?+m+ +a+ +l-h:+m-a-l+ +p},(function(e,n,r,o,a){f===void 0&&(this.fontVariant=inferFontVariant(e));s===void 0&&(a.text=inferTextChannel(e,n,r,o,t))}))}function gridY(){const[e,t]=maybeData(...arguments);return gridKy("y",anchorY(t),e,t)}function gridFy(){const[e,t]=maybeData(...arguments);return gridKy("fy",anchorFy(t),e,t)}function gridX(){const[e,t]=maybeData(...arguments);return gridKx("x",anchorX(t),e,t)}function gridFx(){const[e,t]=maybeData(...arguments);return gridKx("fx",anchorFx(t),e,t)}function gridKy(e,t,n,{y:r=(e==="y"?void 0:null),x:o=null,x1:a=(t==="left"?o:null),x2:i=(t==="right"?o:null),ariaLabel:l=`${e}-grid`,ariaHidden:s=true,...c}){return axisMark(ruleY,e,n,{ariaLabel:l,ariaHidden:s},{y:r,x1:a,x2:i,...gridDefaults(c)})}function gridKx(e,t,n,{x:r=(e==="x"?void 0:null),y:o=null,y1:a=(t==="top"?o:null),y2:i=(t==="bottom"?o:null),ariaLabel:l=`${e}-grid`,ariaHidden:s=true,...c}){return axisMark(ruleX,e,n,{ariaLabel:l,ariaHidden:s},{x:r,y1:a,y2:i,...gridDefaults(c)})}function gridDefaults({color:e="currentColor",opacity:t=.1,stroke:n=e,strokeOpacity:r=t,strokeWidth:o=1,...a}){return{stroke:n,strokeOpacity:r,strokeWidth:o,...a}}function labelOptions({fill:e,fillOpacity:t,fontFamily:n,fontSize:r,fontStyle:o,fontVariant:a,fontWeight:i,monospace:l,pointerEvents:s,shapeRendering:c,clip:u=false},f){[,e]=maybeColorChannel(e);[,t]=maybeNumberChannel(t);return{facet:"super",x:null,y:null,fill:e,fillOpacity:t,fontFamily:n,fontSize:r,fontStyle:o,fontVariant:a,fontWeight:i,monospace:l,pointerEvents:s,shapeRendering:c,clip:u,initializer:f}}function axisMark(e,t,n,r,o,a){let i;function axisInitializer(e,n,r,l,s,c){const u=e==null&&(t==="fx"||t==="fy");const{[t]:f}=l;if(!f)throw new Error(`missing scale: ${t}`);const d=f.domain();let{interval:p,ticks:h,tickFormat:m,tickSpacing:y=(t==="x"?80:35)}=o;typeof h==="string"&&hasTemporalDomain(f)&&(p=h,h=void 0);h===void 0&&(h=maybeRangeInterval(p,f.type)??inferTickCount(f,y));if(e==null){if(isIterable(h))e=arrayify(h);else if(isInterval(h))e=inclusiveRange(h,...Pt(d));else if(f.interval){let t=f.interval;if(f.ticks){const[n,r]=Pt(d);const o=(r-n)/t[Gr];t=generalizeTimeInterval(t,o/h)??t;e=inclusiveRange(t,n,r)}else{e=d;const n=e.length;t=generalizeTimeInterval(t,n/h)??t;t!==f.interval&&(e=inclusiveRange(t,...Pt(e)))}if(t===f.interval){const t=Math.round(e.length/h);t>1&&(e=e.filter(((e,n)=>n%t===0)))}}else e=f.ticks?f.ticks(h):d;if(!f.ticks&&e.length&&e!==d){const n=new ue(d);e=e.filter((e=>n.has(e)));e.length||warn(`Warning: the ${t}-axis ticks appear to not align with the scale domain, resulting in no ticks. Try different ticks?`)}t==="y"||t==="x"?n=[range(e)]:i[t]={scale:t,value:no}}a?.call(this,f,e,h,m,i);const g=Object.fromEntries(Object.entries(i).map((([t,n])=>[t,{...n,value:valueof(e,n.value)}])));u&&(n=c.filterFacets(e,g));return{data:e,facets:n,channels:g}}const l=initializer(o).initializer;const s=e(n,initializer({...o,initializer:axisInitializer},l));if(n==null){i=s.channels;s.channels={}}else i={};r!==void 0&&Object.assign(s,r);s.clip===void 0&&(s.clip=false);return s}function inferTickCount(e,t){const[n,r]=Pt(e.range());return(r-n)/t}function inferTextChannel(e,t,n,r,o){return{value:inferTickFormat(e,t,n,r,o)}}function inferTickFormat(e,t,n,r,o){return typeof r!=="function"||e.type==="log"&&e.tickFormat?r===void 0&&t&&isTemporal(t)?inferTimeFormat(e.type,t,o)??Uo:e.tickFormat?e.tickFormat(typeof n==="number"?n:null,r):typeof r==="string"&&e.domain().length>0?(isTemporal(e.domain())?R:Fn)(r):r===void 0?Uo:constant(r):r}function inclusiveRange(e,t,n){return e.range(t,e.offset(e.floor(n)))}const Aa={draw(e,t){e.moveTo(0,0);e.lineTo(0,t)}};const $a={draw(e,t){e.moveTo(0,0);e.lineTo(0,-t)}};const Ma={draw(e,t){e.moveTo(0,0);e.lineTo(-t,0)}};const Ta={draw(e,t){e.moveTo(0,0);e.lineTo(t,0)}};function inferFontVariant(e){return e.bandwidth&&!e.interval?void 0:"tabular-nums"}function formatAxisLabel(e,t,{anchor:n,label:r=t.label,labelAnchor:o,labelArrow:a}={}){if(!(r==null||r.inferred&&hasTemporalDomain(t)&&/^(date|time|year)$/i.test(r))){r=String(r);a==="auto"&&(a=(!t.bandwidth||t.interval)&&!/[â†‘â†“â†’â†]/.test(r));if(!a)return r;if(a===true){const n=inferScaleOrder(t);n&&(a=/x$/.test(e)||o==="center"?/x$/.test(e)===n<0?"left":"right":n<0?"up":"down")}switch(a){case"left":return`â† ${r}`;case"right":return`${r} â†’`;case"up":return n==="right"?`${r} â†‘`:`â†‘ ${r}`;case"down":return n==="right"?`${r} â†“`:`â†“ ${r}`}return r}}function maybeLabelArrow(e="auto"){return!isNoneish(e)&&(typeof e==="boolean"?e:keyword(e,"labelArrow",["auto","up","right","down","left"]))}function hasTemporalDomain(e){return isTemporal(e.domain())}function maybeScale(e,t){if(t==null)return t;const n=e(t);if(!n)throw new Error(`scale not found: ${t}`);return n}function legendSwatches(e,{opacity:t,...n}={}){if(!isOrdinalScale(e)&&!isThresholdScale(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return legendItems(e,n,((e,n,r,o)=>e.append("svg").attr("width",r).attr("height",o).attr("fill",n.scale).attr("fill-opacity",maybeNumberChannel(t)[1]).append("rect").attr("width","100%").attr("height","100%")))}function legendSymbols(e,{fill:t=(e.hint?.fill!==void 0?e.hint.fill:"none"),fillOpacity:n=1,stroke:r=(e.hint?.stroke!==void 0?e.hint.stroke:isNoneish(t)?"currentColor":"none"),strokeOpacity:o=1,strokeWidth:a=1.5,r:i=4.5,...l}={},s){const[c,u]=maybeColorChannel(t);const[f,d]=maybeColorChannel(r);const p=maybeScale(s,c);const h=maybeScale(s,f);const m=i*i*Math.PI;n=maybeNumberChannel(n)[1];o=maybeNumberChannel(o)[1];a=maybeNumberChannel(a)[1];return legendItems(e,l,((t,r,i,l)=>t.append("svg").attr("viewBox","-8 -8 16 16").attr("width",i).attr("height",l).attr("fill",c==="color"?e=>p.scale(e):u).attr("fill-opacity",n).attr("stroke",f==="color"?e=>h.scale(e):d).attr("stroke-opacity",o).attr("stroke-width",a).append("path").attr("d",(t=>{const n=Xn();e.scale(t).draw(n,m);return n}))))}function legendItems(e,t={},n){let{columns:r,tickFormat:o,fontVariant:a=inferFontVariant$2(e),swatchSize:i=15,swatchWidth:l=i,swatchHeight:s=i,marginLeft:c=0,className:u,style:f,width:d}=t;const p=createContext(t);u=maybeClassName(u);o=inferTickFormat(e.scale,e.domain,void 0,o);const h=create("div",p).attr("class",`${u}-swatches ${u}-swatches-${r!=null?"columns":"wrap"}`);let m;if(r!=null){m=`:where(.${u}-swatches-columns .${u}-swatch) {\n  display: flex;\n  align-items: center;\n  break-inside: avoid;\n  padding-bottom: 1px;\n}\n:where(.${u}-swatches-columns .${u}-swatch::before) {\n  flex-shrink: 0;\n}\n:where(.${u}-swatches-columns .${u}-swatch-label) {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}`;h.style("columns",r).selectAll().data(e.domain).enter().append("div").attr("class",`${u}-swatch`).call(n,e,l,s).call((e=>e.append("div").attr("class",`${u}-swatch-label`).attr("title",o).text(o)))}else{m=`:where(.${u}-swatches-wrap) {\n  display: flex;\n  align-items: center;\n  min-height: 33px;\n  flex-wrap: wrap;\n}\n:where(.${u}-swatches-wrap .${u}-swatch) {\n  display: inline-flex;\n  align-items: center;\n  margin-right: 1em;\n}`;h.selectAll().data(e.domain).enter().append("span").attr("class",`${u}-swatch`).call(n,e,l,s).append((function(){return this.ownerDocument.createTextNode(o.apply(this,arguments))}))}return h.call((e=>e.insert("style","*").text(`:where(.${u}-swatches) {\n  font-family: system-ui, sans-serif;\n  font-size: 10px;\n  margin-bottom: 0.5em;\n}\n:where(.${u}-swatch > svg) {\n  margin-right: 0.5em;\n  overflow: visible;\n}\n${m}`))).style("margin-left",c?+c+"px":null).style("width",d===void 0?null:+d+"px").style("font-variant",impliedString(a,"normal")).call(applyInlineStyles,f).node()}const Ca=new Map([["symbol",legendSymbols],["color",legendColor],["opacity",legendOpacity]]);function legend(e={}){for(const[t,n]of Ca){const r=e[t];if(isScaleOptions(r)){const o=createContext(e);let a;if(t==="symbol"){const{fill:t,stroke:n=(t===void 0&&isScaleOptions(e.color)?"color":void 0)}=e;a={fill:t,stroke:n}}return n(normalizeScale(t,r,a),legendOptions(o,r,e),(t=>isScaleOptions(e[t])?normalizeScale(t,e[t]):null))}}throw new Error("unknown legend type; no scale found")}function exposeLegends(e,t,n={}){return(r,o)=>{if(!Ca.has(r))throw new Error(`unknown legend type: ${r}`);if(r in e)return Ca.get(r)(e[r],legendOptions(t,n[r],o),(t=>e[t]))}}function legendOptions({className:e,...t},{label:n,ticks:r,tickFormat:o}={},a){return inherit(a,{className:e,...t},{label:n,ticks:r,tickFormat:o})}function legendColor(e,{legend:t=true,...n}){t===true&&(t=e.type==="ordinal"?"swatches":"ramp");if(e.domain!==void 0)switch(`${t}`.toLowerCase()){case"swatches":return legendSwatches(e,n);case"ramp":return legendRamp(e,n);default:throw new Error(`unknown legend type: ${t}`)}}function legendOpacity({type:e,interpolate:t,...n},{legend:r=true,color:o=Bn(0,0,0),...a}){if(!t)throw new Error(`${e} opacity scales are not supported`);r===true&&(r="ramp");if(`${r}`.toLowerCase()!=="ramp")throw new Error(`${r} opacity legends are not supported`);return legendColor({type:e,...n,interpolate:interpolateOpacity(o)},{legend:r,...a})}function interpolateOpacity(e){const{r:t,g:n,b:r}=Bn(e)||Bn(0,0,0);return e=>`rgba(${t},${n},${r},${e})`}function createLegends(e,t,n){const r=[];for(const[o,a]of Ca){const i=n[o];if(i?.legend&&o in e){const n=a(e[o],legendOptions(t,e[o],i),(t=>e[t]));n!=null&&r.push(n)}}return r}function maybeIdentityX(e={},t="x"){return hasX(e)?e:{...e,[t]:no}}function maybeIdentityY(e={},t="y"){return hasY(e)?e:{...e,[t]:no}}function exclusiveFacets(e,t){if(t.length===1)return{data:e,facets:t};const n=lengthof(e);const r=new Uint8Array(n);let o=0;for(const e of t)for(const t of e){r[t]&&++o;r[t]=1}if(o===0)return{data:e,facets:t};e=slice(e);const a=e[Jr]=new Uint32Array(n+o);t=t.map((e=>slice(e,Uint32Array)));let i=n;r.fill(0);for(const n of t)for(let t=0,o=n.length;t<o;++t){const o=n[t];r[o]?(n[t]=i,e[i]=e[o],a[i]=o,++i):a[o]=o;r[o]=1}return{data:e,facets:t}}function stackX(e={},t={}){arguments.length===1&&([e,t]=mergeOptions$2(e));const{y1:n,y:r=n,x:o,...a}=t;const[i,l,s,c]=stack(r,o,"y","x",e,a);return{...i,y1:n,y:l,x1:s,x2:c,x:mid(s,c)}}function stackX1(e={},t={}){arguments.length===1&&([e,t]=mergeOptions$2(e));const{y1:n,y:r=n,x:o}=t;const[a,i,l]=stack(r,o,"y","x",e,t);return{...a,y1:n,y:i,x:l}}function stackX2(e={},t={}){arguments.length===1&&([e,t]=mergeOptions$2(e));const{y1:n,y:r=n,x:o}=t;const[a,i,,l]=stack(r,o,"y","x",e,t);return{...a,y1:n,y:i,x:l}}function stackY(e={},t={}){arguments.length===1&&([e,t]=mergeOptions$2(e));const{x1:n,x:r=n,y:o,...a}=t;const[i,l,s,c]=stack(r,o,"x","y",e,a);return{...i,x1:n,x:l,y1:s,y2:c,y:mid(s,c)}}function stackY1(e={},t={}){arguments.length===1&&([e,t]=mergeOptions$2(e));const{x1:n,x:r=n,y:o}=t;const[a,i,l]=stack(r,o,"x","y",e,t);return{...a,x1:n,x:i,y:l}}function stackY2(e={},t={}){arguments.length===1&&([e,t]=mergeOptions$2(e));const{x1:n,x:r=n,y:o}=t;const[a,i,,l]=stack(r,o,"x","y",e,t);return{...a,x1:n,x:i,y:l}}function maybeStackX({x:e,x1:t,x2:n,...r}={}){r=withTip(r,"y");if(t===void 0&&n===void 0)return stackX({x:e,...r});[t,n]=maybeZero(e,t,n);return{...r,x1:t,x2:n}}function maybeStackY({y:e,y1:t,y2:n,...r}={}){r=withTip(r,"x");if(t===void 0&&n===void 0)return stackY({y:e,...r});[t,n]=maybeZero(e,t,n);return{...r,y1:t,y2:n}}function mergeOptions$2(e){const{offset:t,order:n,reverse:r,...o}=e;return[{offset:t,order:n,reverse:r},o]}const Oa={length:true};function stack(e,t=one,n,r,{offset:o,order:a,reverse:i},l){if(t===null)throw new Error(`stack requires ${r}`);const s=maybeZ(l);const[c,u]=maybeColumn(e);const[f,d]=column(t);const[p,h]=column(t);f.hint=p.hint=Oa;o=maybeOffset(o);a=maybeOrder(a,o,r);return[basic(l,((r,l,c)=>{({data:r,facets:l}=exclusiveFacets(r,l));const f=e==null?void 0:u(maybeApplyInterval(valueof(r,e),c?.[n]));const p=valueof(r,t,Float64Array);const m=valueof(r,s);const y=a&&a(r,f,p,m);const g=lengthof(r);const b=d(new Float64Array(g));const x=h(new Float64Array(g));const w=[];for(const e of l){const t=f?Array.from(Q(e,(e=>f[e])).values()):[e];if(y)for(const e of t)e.sort(y);for(const e of t){let t=0;let n=0;i&&e.reverse();for(const r of e){const e=p[r];e<0?t=x[r]=(b[r]=t)+e:e>0?n=x[r]=(b[r]=n)+e:x[r]=b[r]=n}}w.push(t)}o&&o(w,b,x,m);return{data:r,facets:l}})),c,f,p]}function maybeOffset(e){if(e!=null){if(typeof e==="function")return e;switch(`${e}`.toLowerCase()){case"expand":case"normalize":return offsetExpand;case"center":case"silhouette":return offsetCenter;case"wiggle":return offsetWiggle}throw new Error(`unknown offset: ${e}`)}}function extent(e,t){let n=0,r=0;for(const o of e){const e=t[o];e<n&&(n=e);e>r&&(r=e)}return[n,r]}function offsetExpand(e,t,n){for(const r of e)for(const e of r){const[r,o]=extent(e,n);for(const a of e){const e=1/(o-r||1);t[a]=e*(t[a]-r);n[a]=e*(n[a]-r)}}}function offsetCenter(e,t,n){for(const r of e){for(const e of r){const[r,o]=extent(e,n);for(const a of e){const e=(o+r)/2;t[a]-=e;n[a]-=e}}offsetZero(r,t,n)}offsetCenterFacets(e,t,n)}function offsetWiggle(e,t,n,r){for(const o of e){const e=new hn;let a=0;for(const i of o){let o=-1;const l=i.map((e=>Math.abs(n[e]-t[e])));const s=i.map((a=>{o=r?r[a]:++o;const i=n[a]-t[a];const l=e.has(o)?i-e.get(o):0;e.set(o,i);return l}));const c=[0,...jn(s)];for(const e of i){t[e]+=a;n[e]+=a}const u=ce(l);u&&(a-=ce(l,((e,t)=>(s[t]/2+c[t])*e))/u)}offsetZero(o,t,n)}offsetCenterFacets(e,t,n)}function offsetZero(e,t,n){const r=ae(e,(e=>ae(e,(e=>t[e]))));for(const o of e)for(const e of o){t[e]-=r;n[e]-=r}}function offsetCenterFacets(e,t,n){const r=e.length;if(r===1)return;const o=e.map((e=>e.flat()));const a=o.map((e=>(ae(e,(e=>t[e]))+z(e,(e=>n[e])))/2));const i=ae(a);for(let e=0;e<r;e++){const r=i-a[e];for(const a of o[e]){t[a]+=r;n[a]+=r}}}function maybeOrder(e,t,n){if(e===void 0&&t===offsetWiggle)return orderInsideOut(ascendingDefined);if(e!=null){if(typeof e==="string"){const t=e.startsWith("-");const r=t?descendingDefined:ascendingDefined;switch((t?e.slice(1):e).toLowerCase()){case"value":case n:return orderY(r);case"z":return orderZ(r);case"sum":return orderSum(r);case"appearance":return orderAppearance(r);case"inside-out":return orderInsideOut(r)}return orderAccessor(field(e))}if(typeof e==="function")return(e.length===1?orderAccessor:orderComparator)(e);if(isArray(e))return orderGiven(e);throw new Error(`invalid order: ${e}`)}}function orderY(e){return(t,n,r)=>(t,n)=>e(r[t],r[n])}function orderZ(e){return(t,n,r,o)=>(t,n)=>e(o[t],o[n])}function orderSum(e){return orderZDomain(e,((e,t,n,r)=>Wn(range(e),(e=>ce(e,(e=>n[e]))),(e=>r[e]))))}function orderAppearance(e){return orderZDomain(e,((e,t,n,r)=>Wn(range(e),(e=>t[Pn(e,(e=>n[e]))]),(e=>r[e]))))}function orderInsideOut(e){return orderZDomain(e,((e,t,n,r)=>{const o=range(e);const a=Wn(o,(e=>t[Pn(e,(e=>n[e]))]),(e=>r[e]));const i=se(o,(e=>ce(e,(e=>n[e]))),(e=>r[e]));const l=[],s=[];let c=0;for(const e of a)if(c<0){c+=i.get(e);l.push(e)}else{c-=i.get(e);s.push(e)}return s.reverse().concat(l)}))}function orderAccessor(e){return t=>{const n=valueof(t,e);return(e,t)=>ascendingDefined(n[e],n[t])}}function orderComparator(e){return t=>isArray(t)?(n,r)=>e(t[n],t[r]):(n,r)=>e(t.get(n),t.get(r))}function orderGiven(e){return orderZDomain(ascendingDefined,(()=>e))}function orderZDomain(e,t){return(n,r,o,a)=>{if(!a)throw new Error("missing channel: z");const i=new hn(t(n,r,o,a).map(((e,t)=>[e,t])));return(t,n)=>e(i.get(a[t]),i.get(a[n]))}}const Ia={ariaLabel:"rect"};class Rect extends Mark{constructor(e,t={}){const{x1:n,y1:r,x2:o,y2:a}=t;super(e,{x1:{value:n,scale:"x",type:n!=null&&o==null?"band":void 0,optional:true},y1:{value:r,scale:"y",type:r!=null&&a==null?"band":void 0,optional:true},x2:{value:o,scale:"x",optional:true},y2:{value:a,scale:"y",optional:true}},t,Ia);rectInsets(this,t);rectRadii(this,t)}render(e,t,n,r,o){const{x:a,y:i}=t;let{x1:l,y1:s,x2:c,y2:u}=n;const{marginTop:f,marginRight:d,marginBottom:p,marginLeft:h,width:m,height:y}=r;const{projection:g}=o;const{insetTop:b,insetRight:x,insetBottom:w,insetLeft:k}=this;const{rx:S,ry:A,rx1y1:$,rx1y2:M,rx2y1:T,rx2y2:C}=this;(l||c)&&!g&&isCollapsed(a)&&(l=c=null);(s||u)&&!g&&isCollapsed(i)&&(s=u=null);const O=a?.bandwidth?a.bandwidth():0;const I=i?.bandwidth?i.bandwidth():0;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{},0,0).call((t=>t.selectAll().data(e).enter().call($||M||T||C?e=>e.append("path").call(applyDirectStyles,this).call(applyRoundedRect,l&&c?e=>l[e]+(c[e]<l[e]?-x:k):l?e=>l[e]+k:h+k,s&&u?e=>s[e]+(u[e]<s[e]?-w:b):s?e=>s[e]+b:f+b,l&&c?e=>c[e]-(c[e]<l[e]?-k:x):l?e=>l[e]+O-x:m-d-x,s&&u?e=>u[e]-(u[e]<s[e]?-b:w):s?e=>s[e]+I-w:y-p-w,this).call(applyChannelStyles,this,n):e=>e.append("rect").call(applyDirectStyles,this).attr("x",l?c?e=>Math.min(l[e],c[e])+k:e=>l[e]+k:h+k).attr("y",s?u?e=>Math.min(s[e],u[e])+b:e=>s[e]+b:f+b).attr("width",l?c?e=>Math.max(0,Math.abs(c[e]-l[e])+O-k-x):O-k-x:m-d-h-x-k).attr("height",s?u?e=>Math.max(0,Math.abs(s[e]-u[e])+I-b-w):I-b-w:y-f-p-b-w).call(applyAttr,"rx",S).call(applyAttr,"ry",A).call(applyChannelStyles,this,n)))).node()}}function rectInsets(e,{inset:t=0,insetTop:n=t,insetRight:r=t,insetBottom:o=t,insetLeft:a=t}={}){e.insetTop=number$1(n);e.insetRight=number$1(r);e.insetBottom=number$1(o);e.insetLeft=number$1(a)}function rectRadii(e,{r:t,rx:n,ry:r,rx1:o=t,ry1:a=t,rx2:i=t,ry2:l=t,rx1y1:s=(o!==void 0?+o:a!==void 0?+a:0),rx1y2:c=(o!==void 0?+o:l!==void 0?+l:0),rx2y1:u=(i!==void 0?+i:a!==void 0?+a:0),rx2y2:f=(i!==void 0?+i:l!==void 0?+l:0)}={}){if(s||c||u||f){e.rx1y1=s;e.rx1y2=c;e.rx2y1=u;e.rx2y2=f}else{e.rx=impliedString(n,"auto");e.ry=impliedString(r,"auto")}}function applyRoundedRect(e,t,n,r,o,a){const{rx1y1:i,rx1y2:l,rx2y1:s,rx2y2:c}=a;typeof t!=="function"&&(t=constant(t));typeof n!=="function"&&(n=constant(n));typeof r!=="function"&&(r=constant(r));typeof o!=="function"&&(o=constant(o));const u=Math.max(Math.abs(i+s),Math.abs(l+c));const f=Math.max(Math.abs(i+l),Math.abs(s+c));e.attr("d",(e=>{const a=t(e);const d=n(e);const p=r(e);const h=o(e);const m=a>p;const y=d>h;const g=m?p:a;const b=m?a:p;const x=y?h:d;const w=y?d:h;const k=Math.min(1,(b-g)/u,(w-x)/f);const S=k*(m?y?c:s:y?l:i);const A=k*(m?y?l:i:y?c:s);const $=k*(m?y?i:l:y?s:c);const M=k*(m?y?s:c:y?i:l);return`M${g},${x+biasY(S,M)}A${S},${S} 0 0 ${S<0?0:1} ${g+biasX(S,M)},${x}H${b-biasX(A,$)}A${A},${A} 0 0 ${A<0?0:1} ${b},${x+biasY(A,$)}V${w-biasY($,A)}A${$},${$} 0 0 ${$<0?0:1} ${b-biasX($,A)},${w}H${g+biasX(M,S)}A${M},${M} 0 0 ${M<0?0:1} ${g},${w-biasY(M,S)}Z`}))}function biasX(e,t){return t<0?e:Math.abs(e)}function biasY(e,t){return t<0?Math.abs(e):e}function rect(e,t){return new Rect(e,maybeTrivialIntervalX(maybeTrivialIntervalY(t)))}function rectX(e,t={}){hasXY(t)||(t={...t,y:to,x2:no,interval:1});return new Rect(e,maybeStackX(maybeTrivialIntervalY(maybeIdentityX(t))))}function rectY(e,t={}){hasXY(t)||(t={...t,x:to,y2:no,interval:1});return new Rect(e,maybeStackY(maybeTrivialIntervalX(maybeIdentityY(t))))}const La={ariaLabel:"frame",fill:"none",stroke:"currentColor",clip:false};const Na={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square",clip:false};class Frame extends Mark{constructor(e={}){const{anchor:t=null}=e;super(eo,void 0,e,t==null?La:Na);this.anchor=maybeKeyword(t,"anchor",["top","right","bottom","left"]);rectInsets(this,e);t||rectRadii(this,e)}render(e,t,n,r,o){const{marginTop:a,marginRight:i,marginBottom:l,marginLeft:s,width:c,height:u}=r;const{anchor:f,insetTop:d,insetRight:p,insetBottom:h,insetLeft:m}=this;const{rx:y,ry:g,rx1y1:b,rx1y2:x,rx2y1:w,rx2y2:k}=this;const S=s+m;const A=c-i-p;const $=a+d;const M=u-l-h;return create(f?"svg:line":b||x||w||k?"svg:path":"svg:rect",o).datum(0).call(applyIndirectStyles,this,r,o).call(applyDirectStyles,this).call(applyChannelStyles,this,n).call(applyTransform,this,{}).call(f==="left"?e=>e.attr("x1",S).attr("x2",S).attr("y1",$).attr("y2",M):f==="right"?e=>e.attr("x1",A).attr("x2",A).attr("y1",$).attr("y2",M):f==="top"?e=>e.attr("x1",S).attr("x2",A).attr("y1",$).attr("y2",$):f==="bottom"?e=>e.attr("x1",S).attr("x2",A).attr("y1",M).attr("y2",M):b||x||w||k?e=>e.call(applyRoundedRect,S,$,A,M,this):e=>e.attr("x",S).attr("y",$).attr("width",A-S).attr("height",M-$).attr("rx",y).attr("ry",g)).node()}}function frame(e){return new Frame(e)}const Ra={ariaLabel:"tip",fill:"var(--plot-background)",stroke:"currentColor"};const za=new Set(["geometry","href","src","ariaLabel","scales"]);class Tip extends Mark{constructor(e,t={}){t.tip&&(t={...t,tip:false});t.title===void 0&&isIterable(e)&&isTextual(e)&&(t={...t,title:no});const{x:n,y:r,x1:o,x2:a,y1:i,y2:l,anchor:s,preferredAnchor:c="bottom",monospace:u,fontFamily:f=(u?"ui-monospace, monospace":void 0),fontSize:d,fontStyle:p,fontVariant:h,fontWeight:m,lineHeight:y=1,lineWidth:g=20,frameAnchor:b,format:x,textAnchor:w="start",textOverflow:k,textPadding:S=8,title:A,pointerSize:$=12,pathFilter:M="drop-shadow(0 3px 4px rgba(0,0,0,0.2))"}=t;super(e,{x:{value:o!=null&&a!=null?null:n,scale:"x",optional:true},y:{value:i!=null&&l!=null?null:r,scale:"y",optional:true},x1:{value:o,scale:"x",optional:a==null},y1:{value:i,scale:"y",optional:l==null},x2:{value:a,scale:"x",optional:o==null},y2:{value:l,scale:"y",optional:i==null},title:{value:A,optional:true}},t,Ra);this.anchor=maybeAnchor$3(s,"anchor");this.preferredAnchor=maybeAnchor$3(c,"preferredAnchor");this.frameAnchor=maybeFrameAnchor(b);this.textAnchor=impliedString(w,"middle");this.textPadding=+S;this.pointerSize=+$;this.pathFilter=string(M);this.lineHeight=+y;this.lineWidth=+g;this.textOverflow=maybeTextOverflow(k);this.monospace=!!u;this.fontFamily=string(f);this.fontSize=number$1(d);this.fontStyle=string(p);this.fontVariant=string(h);this.fontWeight=string(m);for(const e in Ra)e in this.channels&&(this[e]=Ra[e]);this.splitLines=splitter(this);this.clipLine=clipper(this);this.format=typeof x==="string"||typeof x==="function"?{title:x}:{...x}}render(e,t,n,r,o){const a=this;const{x:i,y:l,fx:s,fy:c}=t;const{ownerSVGElement:u,document:f}=o;const{anchor:d,monospace:p,lineHeight:h,lineWidth:m}=this;const{textPadding:y,pointerSize:g,pathFilter:b}=this;const{marginTop:x,marginLeft:w}=r;const{x1:k,y1:S,x2:A,y2:$,x:M=k??A,y:T=S??$}=n;const C=s?s(e.fx)-w:0;const O=c?c(e.fy)-x:0;const[I,L]=applyFrameAnchor(this,r);const N=anchorX$1(n,I);const R=anchorY$1(n,L);const z=p?monospaceWidth:defaultWidth;const D=z(ma);let E,F;if("title"in n){E=getSourceChannels.call(this,{title:n.channels.title},t);F=formatTitle}else{E=getSourceChannels.call(this,n.channels,t);F=formatChannels}const Y=create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyIndirectTextStyles,this).call(applyTransform,this,{x:M&&i,y:T&&l}).call((r=>r.selectAll().data(e).enter().append("g").attr("transform",(e=>`translate(${Math.round(N(e))},${Math.round(R(e))})`)).call(applyDirectStyles,this).call((e=>e.append("path").attr("filter",b))).call((r=>r.append("text").each((function(r){const o=Rn(this);this.setAttribute("fill","currentColor");this.setAttribute("fill-opacity",1);this.setAttribute("stroke","none");const i=F.call(a,r,e,E,t,n);if(typeof i==="string")for(const e of a.splitLines(i))renderLine(o,{value:a.clipLine(e)});else{const e=new Set;for(const t of i){const{label:n=""}=t;if(!n||!e.has(n)){e.add(n);renderLine(o,t)}}}}))))));function renderLine(e,{label:t,value:n,color:r,opacity:o}){t??="",n??="";const a=r!=null||o!=null;let i;let l=m*100;const[s]=cut(t,l,z,D);if(s>=0){t=t.slice(0,s).trimEnd()+ma;i=n.trim();n=""}else{(t||!n&&!a)&&(n=" "+n);const[e]=cut(n,l-z(t),z,D);if(e>=0){i=n.trim();n=n.slice(0,e).trimEnd()+ma}}const c=e.append("tspan").attr("x",0).attr("dy",`${h}em`).text("â€‹");t&&c.append("tspan").attr("font-weight","bold").text(t);n&&c.append((()=>f.createTextNode(n)));a&&c.append("tspan").text(" â– ").attr("fill",r).attr("fill-opacity",o).style("user-select","none");i&&c.append("title").text(i)}function postrender(){const{width:e,height:t}=r.facet??r;Y.selectChildren().each((function(n){let{x:r,width:o,height:i}=this.getBBox();o=Math.round(o),i=Math.round(i);let l=d;if(l===void 0){const r=N(n)+C;const s=R(n)+O;const c=r+o+g+y*2<e;const u=r-o-g-y*2>0;const f=s+i+g+y*2<t;const d=s-i-g-y*2>0;l=c&&u?f&&d?a.preferredAnchor:d?"bottom":"top":f&&d?c?"left":"right":(c||u)&&(f||d)?`${d?"bottom":"top"}-${c?"left":"right"}`:a.preferredAnchor}const s=this.firstChild;const c=this.lastChild;s.setAttribute("d",getPath(l,g,y,o,i));if(r)for(const e of c.childNodes)e.setAttribute("x",-r);c.setAttribute("y",+getLineOffset(l,c.childNodes.length,h).toFixed(6)+"em");c.setAttribute("transform",`translate(${getTextTranslate(l,g,y,o,i)})`)}));Y.attr("visibility",null)}if(e.length){Y.attr("visibility","hidden");u.isConnected?Promise.resolve().then(postrender):typeof requestAnimationFrame!=="undefined"&&requestAnimationFrame(postrender)}return Y.node()}}function tip(e,{x:t,y:n,...r}={}){r.frameAnchor===void 0&&([t,n]=maybeTuple(t,n));return new Tip(e,{...r,x:t,y:n})}function getLineOffset(e,t,n){return/^top(?:-|$)/.test(e)?.94-n:/^bottom(?:-|$)/?-.29-t*n:t/2*n}function getTextTranslate(e,t,n,r,o){switch(e){case"middle":return[-r/2,o/2];case"top-left":return[n,t+n];case"top":return[-r/2,t/2+n];case"top-right":return[-r-n,t+n];case"right":return[-t/2-r-n,o/2];case"bottom-left":return[n,-t-n];case"bottom":return[-r/2,-t/2-n];case"bottom-right":return[-r-n,-t-n];case"left":return[n+t/2,o/2]}}function getPath(e,t,n,r,o){const a=r+n*2;const i=o+n*2;switch(e){case"middle":return`M${-a/2},${-i/2}h${a}v${i}h${-a}z`;case"top-left":return`M0,0l${t},${t}h${a-t}v${i}h${-a}z`;case"top":return`M0,0l${t/2},${t/2}h${(a-t)/2}v${i}h${-a}v${-i}h${(a-t)/2}z`;case"top-right":return`M0,0l${-t},${t}h${t-a}v${i}h${a}z`;case"right":return`M0,0l${-t/2},${-t/2}v${t/2-i/2}h${-a}v${i}h${a}v${t/2-i/2}z`;case"bottom-left":return`M0,0l${t},${-t}h${a-t}v${-i}h${-a}z`;case"bottom":return`M0,0l${t/2},${-t/2}h${(a-t)/2}v${-i}h${-a}v${i}h${(a-t)/2}z`;case"bottom-right":return`M0,0l${-t},${-t}h${t-a}v${-i}h${a}z`;case"left":return`M0,0l${t/2},${-t/2}v${t/2-i/2}h${a}v${i}h${-a}v${t/2-i/2}z`}}function getSourceChannels(e,t){const n={};let r=this.format;r=maybeExpandPairedFormat(r,e,"x");r=maybeExpandPairedFormat(r,e,"y");this.format=r;for(const t in r){const o=r[t];if(o!==null&&o!==false)if(t==="fx"||t==="fy")n[t]=true;else{const r=getSource(e,t);r&&(n[t]=r)}}for(const t in e){if(t in n||t in r||za.has(t))continue;if((t==="x"||t==="y")&&e.geometry)continue;const o=getSource(e,t);if(o){if(o.scale==null&&o.defaultScale==="color")continue;n[t]=o}}if(this.facet){t.fx&&!("fx"in r)&&(n.fx=true);t.fy&&!("fy"in r)&&(n.fy=true)}for(const e in n){const r=this.format[e];if(typeof r==="string"){const o=n[e]?.value??t[e]?.domain()??[];this.format[e]=(isTemporal(o)?R:Fn)(r)}else if(r===void 0||r===true){const n=t[e];this.format[e]=n?.bandwidth?inferTickFormat(n,n.domain()):Uo}}return n}function maybeExpandPairedFormat(e,t,n){if(!(n in e))return e;const r=`${n}1`;const o=`${n}2`;if((r in e||!(r in t))&&(o in e||!(o in t)))return e;const a=Object.entries(e);const i=e[n];a.splice(a.findIndex((([e])=>e===n))+1,0,[r,i],[o,i]);return Object.fromEntries(a)}function formatTitle(e,t,{title:n}){return this.format.title(n.value[e],e)}function*formatChannels(e,t,n,r,o){for(const a in n){if(a==="fx"||a==="fy"){yield{label:formatLabel(r,n,a),value:this.format[a](t[a],e)};continue}if(a==="x1"&&"x2"in n)continue;if(a==="y1"&&"y2"in n)continue;const i=n[a];if(a==="x2"&&"x1"in n)yield{label:formatPairLabel(r,n,"x"),value:formatPair(this.format.x2,n.x1,i,e)};else if(a==="y2"&&"y1"in n)yield{label:formatPairLabel(r,n,"y"),value:formatPair(this.format.y2,n.y1,i,e)};else{const t=i.value[e];const l=i.scale;if(!defined(t)&&l==null)continue;yield{label:formatLabel(r,n,a),value:this.format[a](t,e),color:l==="color"?o[a][e]:null,opacity:l==="opacity"?o[a][e]:null}}}}function formatPair(e,t,n,r){return n.hint?.length?`${e(n.value[r]-t.value[r],r)}`:`${e(t.value[r],r)}â€“${e(n.value[r],r)}`}function formatPairLabel(e,t,n){const r=formatLabel(e,t,`${n}1`,n);const o=formatLabel(e,t,`${n}2`,n);return r===o?r:`${r}â€“${o}`}function formatLabel(e,t,n,r=n){const o=t[n];const a=e[o?.scale??n];return String(a?.label??o?.label??r)}function plot(e={}){const{facet:t,style:n,title:r,subtitle:o,caption:a,ariaLabel:i,ariaDescription:l}=e;const s=maybeClassName(e.className);const c=e.marks===void 0?[]:flatMarks(e.marks);c.push(...inferTips(c));const u=maybeTopFacet(t,e);const f=new Map;for(const t of c){const n=maybeMarkFacet(t,u,e);n&&f.set(t,n)}const d=new Map;u&&addScaleChannels(d,[u],e);addScaleChannels(d,f,e);const p=flatMarks(inferAxes(c,d,e));for(const t of p){const n=maybeMarkFacet(t,u,e);n&&f.set(t,n)}c.unshift(...p);let h=createFacets(d,e);if(h!==void 0){const e=u?facetFilter(h,u):void 0;for(const t of c){if(t.facet===null||t.facet==="super")continue;const n=f.get(t);n!==void 0&&(n.facetsIndex=t.fx!=null||t.fy!=null?facetFilter(h,n):e)}const t=new Set;for(const{facetsIndex:e}of f.values())e?.forEach(((e,n)=>{e?.length>0&&t.add(n)}));h.forEach(0<t.size&&t.size<h.length?(e,n)=>e.empty=!t.has(n):e=>e.empty=false);for(const e of c)if(e.facet==="exclude"){const t=f.get(e);t!==void 0&&(t.facetsIndex=facetExclude(t.facetsIndex))}}for(const t of fo.keys())isScaleOptions(e[t])&&t!=="fx"&&t!=="fy"&&d.set(t,[]);const m=new Map;for(const t of c){if(m.has(t))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:n,channels:r}=f.get(t)??{};const{data:o,facets:a,channels:i}=t.initialize(n,r,e);applyScaleTransforms(i,e);m.set(t,{data:o,facets:a,channels:i})}const y=createScales(addScaleChannels(d,m,e),e);const g=createDimensions(y,c,e);autoScaleRange(y,g);const b=createScaleFunctions(y);const{fx:x,fy:w}=b;const k=x||w?innerDimensions(y,g):g;const S=x||w?actualDimensions(b,g):g;const A=createContext(e);const $=A.document;const M=zn("svg").call($.documentElement);let T=M;A.ownerSVGElement=M;A.className=s;A.projection=createProjection(e,k);A.path=function(){return mn(this.projection??xyProjection(b))};A.filterFacets=(e,t)=>facetFilter(h,{channels:t,groups:facetGroups(e,t)});A.getMarkState=e=>{const t=m.get(e);const n=f.get(e);return{...t,channels:{...t.channels,...n?.channels}}};A.dispatchValue=e=>{if(T.value!==e){T.value=e;T.dispatchEvent(new A.document.defaultView.Event("input",{bubbles:true}))}};const C=new Set;for(const[t,n]of m)if(t.initializer!=null){const r=t.facet==="super"?S:k;const o=t.initializer(n.data,n.facets,n.channels,b,r,A);o.data!==void 0&&(n.data=o.data);o.facets!==void 0&&(n.facets=o.facets);if(o.channels!==void 0){const{fx:r,fy:a,...i}=o.channels;inferChannelScales(i);Object.assign(n.channels,i);for(const t of Object.values(i)){const{scale:n}=t;if(n!=null&&!isPosition(fo.get(n))){applyScaleTransform(t,e);C.add(n)}}r==null&&a==null||f.set(t,true)}}if(C.size){const t=new Map;addScaleChannels(t,m,e,(e=>C.has(e)));addScaleChannels(d,m,e,(e=>C.has(e)));const n=inheritScaleLabels(createScales(t,e),y);const{scales:r,...o}=createScaleFunctions(n);Object.assign(y,n);Object.assign(b,o);Object.assign(b.scales,r)}let O,I;if(h!==void 0){O={x:x?.domain(),y:w?.domain()};h=recreateFacets(h,O);I=facetTranslator(x,w,g)}for(const[e,t]of m)t.values=e.scale(t.channels,b,A);const{width:L,height:N}=g;Rn(M).attr("class",s).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",L).attr("height",N).attr("viewBox",`0 0 ${L} ${N}`).attr("aria-label",i).attr("aria-description",l).call((e=>e.append("style").text(`:where(.${s}) {\n  --plot-background: white;\n  display: block;\n  height: auto;\n  height: intrinsic;\n  max-width: 100%;\n}\n:where(.${s} text),\n:where(.${s} tspan) {\n  white-space: pre;\n}`))).call(applyInlineStyles,n);for(const e of c){const{channels:t,values:n,facets:r}=m.get(e);if(h===void 0||e.facet==="super"){let o=null;if(r){o=r[0];o=e.filter(o,t,n);if(o.length===0)continue}const a=e.render(o,b,n,S,A);if(a==null)continue;M.appendChild(a)}else{let o;for(const a of h){if(!(e.facetAnchor?.(h,O,a)??!a.empty))continue;let i=null;if(r){const o=f.has(e);i=r[o?a.i:0];i=e.filter(i,t,n);if(i.length===0)continue;o||i!==r[0]||(i=subarray(i));i.fx=a.x,i.fy=a.y,i.fi=a.i}const l=e.render(i,b,n,k,A);if(l!=null){(o??=Rn(M).append("g")).append((()=>l)).datum(a);for(const e of["aria-label","aria-description","aria-hidden","transform"])if(l.hasAttribute(e)){o.attr(e,l.getAttribute(e));l.removeAttribute(e)}}}o?.selectChildren().each(I)}}const R=createLegends(y,A,e);const{figure:z=r!=null||o!=null||a!=null||R.length>0}=e;if(z){T=$.createElement("figure");T.className=`${s}-figure`;T.style.maxWidth="initial";r!=null&&T.append(createTitleElement($,r,"h2"));o!=null&&T.append(createTitleElement($,o,"h3"));T.append(...R,M);a!=null&&T.append(createFigcaption($,a));"value"in M&&(T.value=M.value,delete M.value)}T.scale=exposeScales(b.scales);T.legend=exposeLegends(y,A,e);const D=consumeWarnings();D>0&&Rn(M).append("text").attr("x",L).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("âš ï¸").append("title").text(`${D.toLocaleString("en-US")} warning${D===1?"":"s"}. Please check the console.`);return T}function createTitleElement(e,t,n){if(t.ownerDocument)return t;const r=e.createElement(n);r.append(t);return r}function createFigcaption(e,t){const n=e.createElement("figcaption");n.append(t);return n}function flatMarks(e){return e.flat(Infinity).filter((e=>e!=null)).map(markify)}function markify(e){return typeof e.render==="function"?e:new Render(e)}class Render extends Mark{constructor(e){if(typeof e!=="function")throw new TypeError("invalid mark; missing render function");super();this.render=e}render(){}}function applyScaleTransforms(e,t){for(const n in e)applyScaleTransform(e[n],t);return e}function applyScaleTransform(e,t){const{scale:n,transform:r=true}=e;if(n==null||!r)return;const{type:o,percent:a,interval:i,transform:l=(a?e=>e==null?NaN:e*100:maybeIntervalTransform(i,o))}=t[n]??{};if(l!=null){e.value=map$1(e.value,l);e.transform=false}}function inferChannelScales(e){for(const t in e)inferChannelScale(t,e[t])}function addScaleChannels(e,t,n,r=yes){for(const{channels:o}of t.values())for(const t in o){const a=o[t];const{scale:i}=a;if(i!=null&&r(i))if(i==="projection"){if(!hasProjection(n)){const t=n.x?.domain===void 0;const r=n.y?.domain===void 0;if(t||r){const[n,o]=getGeometryChannels(a);t&&addScaleChannel(e,"x",n);r&&addScaleChannel(e,"y",o)}}}else addScaleChannel(e,i,a)}return e}function addScaleChannel(e,t,n){const r=e.get(t);r!==void 0?r.push(n):e.set(t,[n])}function maybeTopFacet(e,t){if(e==null)return;const{x:n,y:r}=e;if(n==null&&r==null)return;const o=dataify(e.data);if(o==null)throw new Error("missing facet data");const a={};n!=null&&(a.fx=createChannel(o,{value:n,scale:"fx"}));r!=null&&(a.fy=createChannel(o,{value:r,scale:"fy"}));applyScaleTransforms(a,t);const i=facetGroups(o,a);return{channels:a,groups:i,data:e.data}}function maybeMarkFacet(e,t,n){if(e.facet===null||e.facet==="super")return;const{fx:r,fy:o}=e;if(r!=null||o!=null){const t=dataify(e.data??r??o);if(t===void 0)throw new Error(`missing facet data in ${e.ariaLabel}`);if(t===null)return;const a={};r!=null&&(a.fx=createChannel(t,{value:r,scale:"fx"}));o!=null&&(a.fy=createChannel(t,{value:o,scale:"fy"}));applyScaleTransforms(a,n);return{channels:a,groups:facetGroups(t,a)}}if(t===void 0)return;const{channels:a,groups:i,data:l}=t;if(e.facet!=="auto"||e.data===l)return{channels:a,groups:i};l.length>0&&(i.size>1||i.size===1&&a.fx&&a.fy&&[...i][0][1].size>1)&&lengthof(dataify(e.data))===lengthof(l)&&warn(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isnâ€™t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function derive(e,t={}){return initializer({...t,x:null,y:null},((t,n,r,o,a,i)=>i.getMarkState(e)))}function inferTips(e){const t=[];for(const n of e){let e=n.tip;if(e){e===true?e={}:typeof e==="string"&&(e={pointer:e});let{pointer:r,preferredAnchor:o}=e;r=/^x$/i.test(r)?pointerX:/^y$/i.test(r)?pointerY:pointer;e=r(derive(n,e));e.title=null;o===void 0&&(e.preferredAnchor=r===pointerY?"left":"bottom");const a=tip(n.data,e);a.facet=n.facet;a.facetAnchor=n.facetAnchor;t.push(a)}}return t}function inferAxes(e,t,n){let{projection:r,x:o={},y:a={},fx:i={},fy:l={},axis:s,grid:c,facet:u={},facet:{axis:f=s,grid:d}=u,x:{axis:p=s,grid:h=(p===null?null:c)}=o,y:{axis:m=s,grid:y=(m===null?null:c)}=a,fx:{axis:g=f,grid:b=(g===null?null:d)}=i,fy:{axis:x=f,grid:w=(x===null?null:d)}=l}=n;(r||!isScaleOptions(o)&&!hasPositionChannel("x",e))&&(p=h=null);(r||!isScaleOptions(a)&&!hasPositionChannel("y",e))&&(m=y=null);t.has("fx")||(g=b=null);t.has("fy")||(x=w=null);p===void 0&&(p=!hasAxis(e,"x"));m===void 0&&(m=!hasAxis(e,"y"));g===void 0&&(g=!hasAxis(e,"fx"));x===void 0&&(x=!hasAxis(e,"fy"));p===true&&(p="bottom");m===true&&(m="left");g===true&&(g=p==="top"||p===null?"bottom":"top");x===true&&(x=m==="right"||m===null?"left":"right");const k=[];maybeGrid(k,w,gridFy,l);maybeAxis(k,x,axisFy,"right","left",u,l);maybeGrid(k,b,gridFx,i);maybeAxis(k,g,axisFx,"top","bottom",u,i);maybeGrid(k,y,gridY,a);maybeAxis(k,m,axisY,"left","right",n,a);maybeGrid(k,h,gridX,o);maybeAxis(k,p,axisX,"bottom","top",n,o);return k}function maybeAxis(e,t,n,r,o,a,i){if(!t)return;const l=isBoth(t);i=axisOptions(l?r:t,a,i);const{line:s}=i;n!==axisY&&n!==axisX||!s||isNone(s)||e.push(frame(lineOptions(i)));e.push(n(i));l&&e.push(n({...i,anchor:o,label:null}))}function maybeGrid(e,t,n,r){t&&!isNone(t)&&e.push(n(gridOptions(t,r)))}function isBoth(e){return/^\s*both\s*$/i.test(e)}function axisOptions(e,t,{line:n=t.line,ticks:r,tickSize:o,tickSpacing:a,tickPadding:i,tickFormat:l,tickRotate:s,fontVariant:c,ariaLabel:u,ariaDescription:f,label:d=t.label,labelAnchor:p,labelArrow:h=t.labelArrow,labelOffset:m}){return{anchor:e,line:n,ticks:r,tickSize:o,tickSpacing:a,tickPadding:i,tickFormat:l,tickRotate:s,fontVariant:c,ariaLabel:u,ariaDescription:f,label:d,labelAnchor:p,labelArrow:h,labelOffset:m}}function lineOptions(e){const{anchor:t,line:n}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:n===true?void 0:n}}function gridOptions(e,{stroke:t=(isColor(e)?e:void 0),ticks:n=(isGridTicks(e)?e:void 0),tickSpacing:r,ariaLabel:o,ariaDescription:a}){return{stroke:t,ticks:n,tickSpacing:r,ariaLabel:o,ariaDescription:a}}function isGridTicks(e){switch(typeof e){case"number":return true;case"string":return!isColor(e)}return isIterable(e)||typeof e?.range==="function"}function hasAxis(e,t){const n=`${t}-axis `;return e.some((e=>e.ariaLabel?.startsWith(n)))}function hasPositionChannel(e,t){for(const n of t)for(const t in n.channels){const{scale:r}=n.channels[t];if(r===e||r==="projection")return true}return false}function inheritScaleLabels(e,t){for(const n in e){const r=e[n];const o=t[n];r.label===void 0&&o&&(r.label=o.label)}return e}function actualDimensions({fx:e,fy:t},n){const{marginTop:r,marginRight:o,marginBottom:a,marginLeft:i,width:l,height:s}=outerDimensions(n);const c=e&&outerRange(e);const u=t&&outerRange(t);return{marginTop:t?u[0]:r,marginRight:e?l-c[1]:o,marginBottom:t?s-u[1]:a,marginLeft:e?c[0]:i,inset:{marginTop:n.marginTop,marginRight:n.marginRight,marginBottom:n.marginBottom,marginLeft:n.marginLeft},width:l,height:s}}function outerRange(e){const t=e.domain();if(t.length===0)return[0,e.bandwidth()];let n=e(t[0]);let r=e(t[t.length-1]);r<n&&([n,r]=[r,n]);return[n,r+e.bandwidth()]}const Da=new Map([["basis",Vn],["basis-closed",qn],["basis-open",Gn],["bundle",_n],["bump-x",Hn],["bump-y",Zn],["cardinal",Kn],["cardinal-closed",Un],["cardinal-open",Qn],["catmull-rom",Jn],["catmull-rom-closed",er],["catmull-rom-open",tr],["linear",nr],["linear-closed",rr],["monotone-x",or],["monotone-y",ar],["natural",ir],["step",lr],["step-after",sr],["step-before",cr]]);function maybeCurve(e=nr,t){if(typeof e==="function")return e;const n=Da.get(`${e}`.toLowerCase());if(!n)throw new Error(`unknown curve: ${e}`);if(t!==void 0){if("beta"in n)return n.beta(t);if("tension"in n)return n.tension(t);if("alpha"in n)return n.alpha(t)}return n}function maybeCurveAuto(e=curveAuto,t){return typeof e!=="function"&&`${e}`.toLowerCase()==="auto"?curveAuto:maybeCurve(e,t)}function curveAuto(e){return nr(e)}function binX(e={y:"count"},t={}){[e,t]=mergeOptions$1(e,t);const{x:n,y:r}=t;return binn(maybeBinValue(n,t,no),null,null,r,e,maybeInsetX(t))}function binY(e={x:"count"},t={}){[e,t]=mergeOptions$1(e,t);const{x:n,y:r}=t;return binn(null,maybeBinValue(r,t,no),n,null,e,maybeInsetY(t))}function bin(e={fill:"count"},t={}){[e,t]=mergeOptions$1(e,t);const{x:n,y:r}=maybeBinValueTuple(t);return binn(n,r,null,null,e,maybeInsetX(maybeInsetY(t)))}function maybeDenseInterval(e,t,n={}){if(n?.interval==null)return n;const{reduce:r=bo}=n;const o={filter:null};n[t]!=null&&(o[t]=r);n[`${t}1`]!=null&&(o[`${t}1`]=r);n[`${t}2`]!=null&&(o[`${t}2`]=r);return e(o,n)}function maybeDenseIntervalX(e={}){return maybeDenseInterval(binX,"y",withTip(e,"x"))}function maybeDenseIntervalY(e={}){return maybeDenseInterval(binY,"x",withTip(e,"y"))}function binn(e,t,n,r,{data:o=go,filter:a=wo,sort:i,reverse:l,...s}={},c={}){e=maybeBin(e);t=maybeBin(t);s=maybeBinOutputs(s,c);o=maybeBinReduce(o,no);i=i==null?void 0:maybeBinOutput("sort",i,c);a=a==null?void 0:maybeBinEvaluator("filter",a,c);n!=null&&hasOutput(s,"x","x1","x2")&&(n=null);r!=null&&hasOutput(s,"y","y1","y2")&&(r=null);const[u,f]=maybeColumn(e);const[d,p]=maybeColumn(e);const[h,m]=maybeColumn(t);const[y,g]=maybeColumn(t);const[b,x]=n!=null?[n,"x"]:r!=null?[r,"y"]:[];const[w,k]=maybeColumn(b);const{x:S,y:A,z:$,fill:M,stroke:T,x1:C,x2:O,y1:I,y2:L,domain:N,cumulative:R,thresholds:z,interval:D,...E}=c;const[F,Y]=maybeColumn($);const[X]=maybeColorChannel(M);const[B]=maybeColorChannel(T);const[j,W]=maybeColumn(X);const[P,V]=maybeColumn(B);return{..."z"in c&&{z:F||$},..."fill"in c&&{fill:j||M},..."stroke"in c&&{stroke:P||T},...basic(E,((n,r,c)=>{const u=maybeApplyInterval(valueof(n,b),c?.[x]);const d=valueof(n,$);const h=valueof(n,X);const y=valueof(n,B);const w=maybeSubgroup(s,{z:d,fill:h,stroke:y});const S=[];const A=[];const M=u&&k([]);const T=d&&Y([]);const C=h&&W([]);const O=y&&V([]);const I=e&&f([]);const L=e&&p([]);const N=t&&m([]);const R=t&&g([]);const z=bing(e,t,n);let D=0;for(const e of s)e.initialize(n);i&&i.initialize(n);a&&a.initialize(n);for(const e of r){const t=[];for(const t of s)t.scope("facet",e);i&&i.scope("facet",e);a&&a.scope("facet",e);for(const[r,l]of maybeGroup(e,w))for(const[e,c]of maybeGroup(l,u))for(const[l,f]of z(c)){w&&(f.z=r);if(!a||a.reduce(l,f)){t.push(D++);A.push(o.reduceIndex(l,n,f));u&&M.push(e);d&&T.push(w===d?r:d[(l.length>0?l:c)[0]]);h&&C.push(w===h?r:h[(l.length>0?l:c)[0]]);y&&O.push(w===y?r:y[(l.length>0?l:c)[0]]);I&&(I.push(f.x1),L.push(f.x2));N&&(N.push(f.y1),R.push(f.y2));for(const e of s)e.reduce(l,f);i&&i.reduce(l,f)}}S.push(t)}maybeSort(S,i,l);return{data:A,facets:S}})),...!hasOutput(s,"x")&&(u?{x1:u,x2:d,x:mid(u,d)}:{x:S,x1:C,x2:O}),...!hasOutput(s,"y")&&(h?{y1:h,y2:y,y:mid(h,y)}:{y:A,y1:I,y2:L}),...w&&{[x]:w},...Object.fromEntries(s.map((({name:e,output:t})=>[e,t])))}}function mergeOptions$1({cumulative:e,domain:t,thresholds:n,interval:r,...o},a){return[o,{cumulative:e,domain:t,thresholds:n,interval:r,...a}]}function maybeBinValue(e,{cumulative:t,domain:n,thresholds:r,interval:o},a){e={...maybeValue(e)};e.domain===void 0&&(e.domain=n);e.cumulative===void 0&&(e.cumulative=t);e.thresholds===void 0&&(e.thresholds=r);e.interval===void 0&&(e.interval=o);e.value===void 0&&(e.value=a);e.thresholds=maybeThresholds(e.thresholds,e.interval);return e}function maybeBinValueTuple(e){let{x:t,y:n}=e;t=maybeBinValue(t,e);n=maybeBinValue(n,e);[t.value,n.value]=maybeTuple(t.value,n.value);return{x:t,y:n}}function maybeBin(e){if(e==null)return;const{value:t,cumulative:n,domain:r=Pt,thresholds:o}=e;const bin=e=>{let a=valueof(e,t);let i;if(isTemporal(a)||isTimeThresholds(o)){a=map$1(a,coerceDate,Float64Array);let[e,t]=typeof r==="function"?r(a):r;let n=typeof o!=="function"||isInterval(o)?o:o(a,e,t);typeof n==="number"&&(n=ur(e,t,n));if(isInterval(n)){if(r===Pt){e=n.floor(e);t=n.offset(n.floor(t))}n=n.range(e,n.offset(t))}i=n}else{a=coerceNumbers(a);let[e,t]=typeof r==="function"?r(a):r;let n=typeof o!=="function"||isInterval(o)?o:o(a,e,t);if(typeof n==="number")if(r===Pt){let r=fr(e,t,n);if(isFinite(r))if(r>0){let o=Math.round(e/r);let a=Math.round(t/r);o*r<=e||--o;a*r>t||++a;let i=a-o+1;n=new Float64Array(i);for(let e=0;e<i;++e)n[e]=(o+e)*r}else if(r<0){r=-r;let o=Math.round(e*r);let a=Math.round(t*r);o/r<=e||--o;a/r>t||++a;let i=a-o+1;n=new Float64Array(i);for(let e=0;e<i;++e)n[e]=(o+e)/r}else n=[e];else n=[e]}else n=Ut(e,t,n);else if(isInterval(n)){if(r===Pt){e=n.floor(e);t=n.offset(n.floor(t))}n=n.range(e,n.offset(t))}i=n}const l=[];if(i.length===1)l.push([i[0],i[0]]);else for(let e=1;e<i.length;++e)l.push([i[e-1],i[e]]);l.bin=(n<0?bin1cn:n>0?bin1cp:bin1)(l,i,a);return l};bin.label=labelof(t);return bin}function maybeThresholds(e,t,n=thresholdAuto){if(e===void 0)return t===void 0?n:maybeRangeInterval(t);if(typeof e==="string"){switch(e.toLowerCase()){case"freedman-diaconis":return hr;case"scott":return pr;case"sturges":return dr;case"auto":return thresholdAuto}return utcInterval(e)}return e}function maybeBinOutputs(e,t){return maybeOutputs(e,t,maybeBinOutput)}function maybeBinOutput(e,t,n){return maybeOutput(e,t,n,maybeBinEvaluator)}function maybeBinEvaluator(e,t,n){return maybeEvaluator(e,t,n,maybeBinReduce)}function maybeBinReduce(e,t){return maybeReduce$1(e,t,maybeBinReduceFallback)}function maybeBinReduceFallback(e){switch(`${e}`.toLowerCase()){case"x":return Ea;case"x1":return Ya;case"x2":return Xa;case"y":return Fa;case"y1":return Ba;case"y2":return ja;case"z":return Mo}throw new Error(`invalid bin reduce: ${e}`)}function thresholdAuto(e,t,n){return Math.min(200,pr(e,t,n))}function isTimeThresholds(e){return isTimeInterval(e)||isIterable(e)&&isTemporal(e)}function bing(e,t,n){const r=e?.(n);const o=t?.(n);return r&&o?function*(e){const t=r.bin(e);for(const[e,[a,i]]of r.entries()){const r=o.bin(t[e]);for(const[e,[t,l]]of o.entries())yield[r[e],{data:n,x1:a,y1:t,x2:i,y2:l}]}}:r?function*(e){const t=r.bin(e);for(const[e,[o,a]]of r.entries())yield[t[e],{data:n,x1:o,x2:a}]}:function*(e){const t=o.bin(e);for(const[e,[r,a]]of o.entries())yield[t[e],{data:n,y1:r,y2:a}]}}function bin1(e,t,n){t=coerceNumbers(t);return r=>{const o=e.map((()=>[]));for(const e of r)o[mr(t,n[e])-1]?.push(e);return o}}function bin1cp(e,t,n){const r=bin1(e,t,n);return e=>{const t=r(e);for(let e=1,n=t.length;e<n;++e){const n=t[e-1];const r=t[e];for(const e of n)r.push(e)}return t}}function bin1cn(e,t,n){const r=bin1(e,t,n);return e=>{const t=r(e);for(let e=t.length-2;e>=0;--e){const n=t[e+1];const r=t[e];for(const e of n)r.push(e)}return t}}function mid1(e,t){const n=(+e+ +t)/2;return e instanceof Date?new Date(n):n}const Ea={reduceIndex(e,t,{x1:n,x2:r}){return mid1(n,r)}};const Fa={reduceIndex(e,t,{y1:n,y2:r}){return mid1(n,r)}};const Ya={reduceIndex(e,t,{x1:n}){return n}};const Xa={reduceIndex(e,t,{x2:n}){return n}};const Ba={reduceIndex(e,t,{y1:n}){return n}};const ja={reduceIndex(e,t,{y2:n}){return n}};const Wa={ariaLabel:"area",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class Area extends Mark{constructor(e,t={}){const{x1:n,y1:r,x2:o,y2:a,z:i,curve:l,tension:s}=t;super(e,{x1:{value:n,scale:"x"},y1:{value:r,scale:"y"},x2:{value:o,scale:"x",optional:true},y2:{value:a,scale:"y",optional:true},z:{value:maybeZ(t),optional:true}},t,Wa);this.z=i;this.curve=maybeCurve(l,s)}filter(e){return e}render(e,t,n,r,o){const{x1:a,y1:i,x2:l=a,y2:s=i}=n;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,t,0,0).call((t=>t.selectAll().data(groupIndex(e,[a,i,l,s],this,n)).enter().append("path").call(applyDirectStyles,this).call(applyGroupedChannelStyles,this,n).attr("d",yr().curve(this.curve).defined((e=>e>=0)).x0((e=>a[e])).y0((e=>i[e])).x1((e=>l[e])).y1((e=>s[e]))))).node()}}function area(e,t){return t===void 0?areaY(e,{x:first,y:second}):new Area(e,t)}function areaX(e,t){const{y:n=to,...r}=maybeDenseIntervalY(t);return new Area(e,maybeStackX(maybeIdentityX({...r,y1:n,y2:void 0},n===to?"x2":"x")))}function areaY(e,t){const{x:n=to,...r}=maybeDenseIntervalX(t);return new Area(e,maybeStackY(maybeIdentityY({...r,x1:n,x2:void 0},n===to?"y2":"y")))}const Pa={ariaLabel:"link",fill:"none",stroke:"currentColor",strokeMiterlimit:1};class Link extends Mark{constructor(e,t={}){const{x1:n,y1:r,x2:o,y2:a,curve:i,tension:l}=t;super(e,{x1:{value:n,scale:"x"},y1:{value:r,scale:"y"},x2:{value:o,scale:"x",optional:true},y2:{value:a,scale:"y",optional:true}},t,Pa);this.curve=maybeCurveAuto(i,l);markers(this,t)}project(e,t,n){this.curve!==curveAuto&&super.project(e,t,n)}render(e,t,n,r,o){const{x1:a,y1:i,x2:l=a,y2:s=i}=n;const{curve:c}=this;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,t).call((t=>t.selectAll().data(e).enter().append("path").call(applyDirectStyles,this).attr("d",c===curveAuto&&o.projection?sphereLink(o.path(),a,i,l,s):e=>{const t=Xn();const n=c(t);n.lineStart();n.point(a[e],i[e]);n.point(l[e],s[e]);n.lineEnd();return t}).call(applyChannelStyles,this,n).call(applyMarkers,this,n,o))).node()}}function sphereLink(e,t,n,r,o){t=coerceNumbers(t);n=coerceNumbers(n);r=coerceNumbers(r);o=coerceNumbers(o);return a=>e({type:"LineString",coordinates:[[t[a],n[a]],[r[a],o[a]]]})}function link(e,{x:t,x1:n,x2:r,y:o,y1:a,y2:i,...l}={}){[n,r]=maybeSameValue(t,n,r);[a,i]=maybeSameValue(o,a,i);return new Link(e,{...l,x1:n,x2:r,y1:a,y2:i})}function maybeSameValue(e,t,n){if(e===void 0){if(t===void 0){if(n!==void 0)return[n]}else if(n===void 0)return[t]}else{if(t===void 0)return n===void 0?[e]:[e,n];if(n===void 0)return[e,t]}return[t,n]}const Va={ariaLabel:"arrow",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:1,strokeWidth:1.5};class Arrow extends Mark{constructor(e,t={}){const{x1:n,y1:r,x2:o,y2:a,bend:i=0,headAngle:l=60,headLength:s=8,inset:c=0,insetStart:u=c,insetEnd:f=c,sweep:d}=t;super(e,{x1:{value:n,scale:"x"},y1:{value:r,scale:"y"},x2:{value:o,scale:"x",optional:true},y2:{value:a,scale:"y",optional:true}},t,Va);this.bend=i===true?22.5:Math.max(-90,Math.min(90,i));this.headAngle=+l;this.headLength=+s;this.insetStart=+u;this.insetEnd=+f;this.sweep=maybeSweep(d)}render(e,t,n,r,o){const{x1:a,y1:i,x2:l=a,y2:s=i,SW:c}=n;const{strokeWidth:u,bend:f,headAngle:d,headLength:p,insetStart:h,insetEnd:m}=this;const y=c?e=>c[e]:constant(u===void 0?1:u);const g=d*ia/2;const b=p/1.5;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,t).call((t=>t.selectAll().data(e).enter().append("path").call(applyDirectStyles,this).attr("d",(e=>{let t=a[e],n=i[e],r=l[e],o=s[e];const c=Math.hypot(r-t,o-n);if(c<=h+m)return null;let u=Math.atan2(o-n,r-t);const d=Math.min(b*y(e),c/3);const p=this.sweep(t,n,r,o)*f*ia;const x=Math.hypot(c/Math.tan(p),c)/2;if(h||m)if(x<1e5){const e=Math.sign(p);const[a,i]=pointPointCenter([t,n],[r,o],x,e);h&&([t,n]=circleCircleIntersect([a,i,x],[t,n,h],-e*Math.sign(h)));if(m){const[t,n]=circleCircleIntersect([a,i,x],[r,o,m],e*Math.sign(m));u+=Math.atan2(n-i,t-a)-Math.atan2(o-i,r-a);r=t,o=n}}else{const e=r-t,a=o-n,i=Math.hypot(e,a);h&&(t+=e/i*h,n+=a/i*h);m&&(r-=e/i*m,o-=a/i*m)}const w=u+p;const k=w+g;const S=w-g;const A=r-d*Math.cos(k);const $=o-d*Math.sin(k);const M=r-d*Math.cos(S);const T=o-d*Math.sin(S);const C=x<1e5?`A${x},${x} 0,0,${p>0?1:0} `:"L";const O=d?`M${A},${$}L${r},${o}L${M},${T}`:"";return`M${t},${n}${C}${r},${o}${O}`})).call(applyChannelStyles,this,n))).node()}}function maybeSweep(n=1){if(typeof n==="number")return constant(Math.sign(n));if(typeof n==="function")return(e,t,r,o)=>Math.sign(n(e,t,r,o));switch(keyword(n,"sweep",["+x","-x","+y","-y"])){case"+x":return(t,n,r)=>e(t,r);case"-x":return(e,n,r)=>t(e,r);case"+y":return(t,n,r,o)=>e(n,o);case"-y":return(e,n,r,o)=>t(n,o)}}function pointPointCenter([e,t],[n,r],o,a){const i=n-e,l=r-t,s=Math.hypot(i,l);const c=a*Math.sqrt(o*o-s*s/4)/s;return[(e+n)/2-l*c,(t+r)/2+i*c]}function circleCircleIntersect([e,t,n],[r,o,a],i){const l=r-e,s=o-t,c=Math.hypot(l,s);const u=(l*l+s*s-a*a+n*n)/(2*c);const f=i*Math.sqrt(n*n-u*u);return[e+(l*u+s*f)/c,t+(s*u-l*f)/c]}function arrow(e,{x:t,x1:n,x2:r,y:o,y1:a,y2:i,...l}={}){[n,r]=maybeSameValue(t,n,r);[a,i]=maybeSameValue(o,a,i);return new Arrow(e,{...l,x1:n,x2:r,y1:a,y2:i})}const qa={ariaLabel:"bar"};class AbstractBar extends Mark{constructor(e,t,n={},r=qa){super(e,t,n,r);rectInsets(this,n);rectRadii(this,n)}render(e,t,n,r,o){const{rx:a,ry:i,rx1y1:l,rx1y2:s,rx2y1:c,rx2y2:u}=this;const f=this._x(t,n,r);const d=this._y(t,n,r);const p=this._width(t,n,r);const h=this._height(t,n,r);return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(this._transform,this,t).call((t=>t.selectAll().data(e).enter().call(l||s||c||u?e=>e.append("path").call(applyDirectStyles,this).call(applyRoundedRect,f,d,add(f,p),add(d,h),this).call(applyChannelStyles,this,n):e=>e.append("rect").call(applyDirectStyles,this).attr("x",f).attr("width",p).attr("y",d).attr("height",h).call(applyAttr,"rx",a).call(applyAttr,"ry",i).call(applyChannelStyles,this,n)))).node()}_x(e,{x:t},{marginLeft:n}){const{insetLeft:r}=this;return t?e=>t[e]+r:n+r}_y(e,{y:t},{marginTop:n}){const{insetTop:r}=this;return t?e=>t[e]+r:n+r}_width({x:e},{x:t},{marginRight:n,marginLeft:r,width:o}){const{insetLeft:a,insetRight:i}=this;const l=t&&e?e.bandwidth():o-n-r;return Math.max(0,l-a-i)}_height({y:e},{y:t},{marginTop:n,marginBottom:r,height:o}){const{insetTop:a,insetBottom:i}=this;const l=t&&e?e.bandwidth():o-n-r;return Math.max(0,l-a-i)}}function add(e,t){return typeof e==="function"&&typeof t==="function"?n=>e(n)+t(n):typeof e==="function"?n=>e(n)+t:typeof t==="function"?n=>e+t(n):e+t}class BarX extends AbstractBar{constructor(e,t={},n){const{x1:r,x2:o,y:a}=t;super(e,{x1:{value:r,scale:"x"},x2:{value:o,scale:"x"},y:{value:a,scale:"y",type:"band",optional:true}},t,n)}_transform(e,t,{x:n}){e.call(applyTransform,t,{x:n},0,0)}_x({x:e},{x1:t,x2:n},{marginLeft:r}){const{insetLeft:o}=this;return isCollapsed(e)?r+o:e=>Math.min(t[e],n[e])+o}_width({x:e},{x1:t,x2:n},{marginRight:r,marginLeft:o,width:a}){const{insetLeft:i,insetRight:l}=this;return isCollapsed(e)?a-r-o-i-l:e=>Math.max(0,Math.abs(n[e]-t[e])-i-l)}}class BarY extends AbstractBar{constructor(e,t={},n){const{x:r,y1:o,y2:a}=t;super(e,{y1:{value:o,scale:"y"},y2:{value:a,scale:"y"},x:{value:r,scale:"x",type:"band",optional:true}},t,n)}_transform(e,t,{y:n}){e.call(applyTransform,t,{y:n},0,0)}_y({y:e},{y1:t,y2:n},{marginTop:r}){const{insetTop:o}=this;return isCollapsed(e)?r+o:e=>Math.min(t[e],n[e])+o}_height({y:e},{y1:t,y2:n},{marginTop:r,marginBottom:o,height:a}){const{insetTop:i,insetBottom:l}=this;return isCollapsed(e)?a-r-o-i-l:e=>Math.max(0,Math.abs(n[e]-t[e])-i-l)}}function barX(e,t={}){hasXY(t)||(t={...t,y:to,x2:no});return new BarX(e,maybeStackX(maybeIntervalX(maybeIdentityX(t))))}function barY(e,t={}){hasXY(t)||(t={...t,x:to,y2:no});return new BarY(e,maybeStackY(maybeIntervalY(maybeIdentityY(t))))}const Ga={ariaLabel:"cell"};class Cell extends AbstractBar{constructor(e,{x:t,y:n,...r}={}){super(e,{x:{value:t,scale:"x",type:"band",optional:true},y:{value:n,scale:"y",type:"band",optional:true}},r,Ga)}_transform(e,t){e.call(applyTransform,t,{},0,0)}}function cell(e,{x:t,y:n,...r}={}){[t,n]=maybeTuple(t,n);return new Cell(e,{...r,x:t,y:n})}function cellX(e,{x:t=to,fill:n,stroke:r,...o}={}){n===void 0&&maybeColorChannel(r)[0]===void 0&&(n=no);return new Cell(e,{...o,x:t,fill:n,stroke:r})}function cellY(e,{y:t=to,fill:n,stroke:r,...o}={}){n===void 0&&maybeColorChannel(r)[0]===void 0&&(n=no);return new Cell(e,{...o,y:t,fill:n,stroke:r})}const _a={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};function withDefaultSort(e){return e.sort===void 0&&e.reverse===void 0?sort({channel:"-r"},e):e}class Dot extends Mark{constructor(e,t={}){const{x:n,y:r,r:o,rotate:a,symbol:i=X,frameAnchor:l}=t;const[s,c]=maybeNumberChannel(a,0);const[u,f]=maybeSymbolChannel(i);const[d,p]=maybeNumberChannel(o,u==null?3:4.5);super(e,{x:{value:n,scale:"x",optional:true},y:{value:r,scale:"y",optional:true},r:{value:d,scale:"r",filter:positive,optional:true},rotate:{value:s,optional:true},symbol:{value:u,scale:"auto",optional:true}},withDefaultSort(t),_a);this.r=p;this.rotate=c;this.symbol=f;this.frameAnchor=maybeFrameAnchor(l);const{channels:h}=this;const{symbol:m}=h;if(m){const{fill:e,stroke:t}=h;m.hint={fill:e?e.value===m.value?"color":"currentColor":this.fill??"currentColor",stroke:t?t.value===m.value?"color":"currentColor":this.stroke??"none"}}}render(e,t,n,r,o){const{x:a,y:i}=t;const{x:l,y:s,r:c,rotate:u,symbol:f}=n;const{r:d,rotate:p,symbol:h}=this;const[m,y]=applyFrameAnchor(this,r);const g=h===X;const b=c?void 0:d*d*Math.PI;negative(d)&&(e=[]);return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{x:l&&a,y:s&&i}).call((t=>t.selectAll().data(e).enter().append(g?"circle":"path").call(applyDirectStyles,this).call(g?e=>{e.attr("cx",l?e=>l[e]:m).attr("cy",s?e=>s[e]:y).attr("r",c?e=>c[e]:d)}:e=>{e.attr("transform",template`translate(${l?e=>l[e]:m},${s?e=>s[e]:y})${u?e=>` rotate(${u[e]})`:p?` rotate(${p})`:""}`).attr("d",c&&f?e=>{const t=Xn();f[e].draw(t,c[e]*c[e]*Math.PI);return t}:c?e=>{const t=Xn();h.draw(t,c[e]*c[e]*Math.PI);return t}:f?e=>{const t=Xn();f[e].draw(t,b);return t}:(()=>{const e=Xn();h.draw(e,b);return e})())}).call(applyChannelStyles,this,n))).node()}}function dot(e,{x:t,y:n,...r}={}){r.frameAnchor===void 0&&([t,n]=maybeTuple(t,n));return new Dot(e,{...r,x:t,y:n})}function dotX(e,{x:t=no,...n}={}){return new Dot(e,maybeIntervalMidY({...n,x:t}))}function dotY(e,{y:t=no,...n}={}){return new Dot(e,maybeIntervalMidX({...n,y:t}))}function circle(e,t){return dot(e,{...t,symbol:"circle"})}function hexagon(e,t){return dot(e,{...t,symbol:"hexagon"})}const Ha={ariaLabel:"line",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class Line extends Mark{constructor(e,t={}){const{x:n,y:r,z:o,curve:a,tension:i}=t;super(e,{x:{value:n,scale:"x"},y:{value:r,scale:"y"},z:{value:maybeZ(t),optional:true}},t,Ha);this.z=o;this.curve=maybeCurveAuto(a,i);markers(this,t)}filter(e){return e}project(e,t,n){this.curve!==curveAuto&&super.project(e,t,n)}render(e,t,n,r,o){const{x:a,y:i}=n;const{curve:l}=this;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,t).call((t=>t.selectAll().data(groupIndex(e,[a,i],this,n)).enter().append("path").call(applyDirectStyles,this).call(applyGroupedChannelStyles,this,n).call(applyGroupedMarkers,this,n,o).attr("d",l===curveAuto&&o.projection?sphereLine(o.path(),a,i):gr().curve(l).defined((e=>e>=0)).x((e=>a[e])).y((e=>i[e]))))).node()}}function sphereLine(e,t,n){t=coerceNumbers(t);n=coerceNumbers(n);return r=>{let o=[];const a=[o];for(const e of r)if(e===-1){o=[];a.push(o)}else o.push([t[e],n[e]]);return e({type:"MultiLineString",coordinates:a})}}function line(e,{x:t,y:n,...r}={}){[t,n]=maybeTuple(t,n);return new Line(e,{...r,x:t,y:n})}function lineX(e,{x:t=no,y:n=to,...r}={}){return new Line(e,maybeDenseIntervalY({...r,x:t,y:n}))}function lineY(e,{x:t=to,y:n=no,...r}={}){return new Line(e,maybeDenseIntervalX({...r,x:t,y:n}))}function autoSpec(e,t){t=normalizeOptions(t);const{x:n,y:r,color:o,size:a}=t;const i=materializeValue(e,n);const l=materializeValue(e,r);const s=materializeValue(e,o);const c=materializeValue(e,a);let{fx:u,fy:f,x:{value:d,reduce:p,zero:h,...m},y:{value:y,reduce:g,zero:b,...x},color:{value:w,color:k,reduce:S},size:{value:A,reduce:$},mark:M}=t;p===void 0&&(p=g==null&&d==null&&A==null&&y!=null?"count":null);g===void 0&&(g=p==null&&y==null&&A==null&&d!=null?"count":null);$!==void 0||A!=null||S!=null||p!=null||g!=null||d!=null&&!isOrdinal(i)||y!=null&&!isOrdinal(l)||($="count");h===void 0&&(h=!!isZeroReducer(p)||void 0);b===void 0&&(b=!!isZeroReducer(g)||void 0);if(d==null&&y==null)throw new Error("must specify x or y");if(p!=null&&y==null)throw new Error("reducing x requires y");if(g!=null&&d==null)throw new Error("reducing y requires x");M===void 0&&(M=A!=null||$!=null?"dot":isZeroReducer(p)||isZeroReducer(g)||S!=null?"bar":d!=null&&y!=null?isOrdinal(i)||isOrdinal(l)||p==null&&g==null&&!isMonotonic(i)&&!isMonotonic(l)?"dot":"line":d!=null||y!=null?"rule":null);let T;let C;let O;switch(M){case"dot":O=dot;C="stroke";break;case"line":O=i&&l||p!=null||g!=null?b||g!=null||i&&isMonotonic(i)?lineY:h||p!=null||l&&isMonotonic(l)?lineX:line:i?lineX:lineY;C="stroke";isHighCardinality(s)&&(T=null);break;case"area":O=b||g!=null||!(h||p!=null||l&&isMonotonic(l))?areaY:areaX;C="fill";isHighCardinality(s)&&(T=null);break;case"rule":O=i?ruleX:ruleY;C="stroke";break;case"bar":O=p!=null?isOrdinal(l)?isSelectReducer(p)&&i&&isOrdinal(i)?cell:barX:rectX:g!=null?isOrdinal(i)?isSelectReducer(g)&&l&&isOrdinal(l)?cell:barY:rectY:S!=null||$!=null?i&&isOrdinal(i)&&l&&isOrdinal(l)?cell:i&&isOrdinal(i)?barY:l&&isOrdinal(l)?barX:rect:!i||!isNumeric(i)||l&&isNumeric(l)?!l||!isNumeric(l)||i&&isNumeric(i)?cell:barY:barX;C="fill";break;default:throw new Error(`invalid mark: ${M}`)}let I={fx:u,fy:f,x:i??void 0,y:l??void 0,[C]:s??k,z:T,r:c??void 0,tip:true};let L;let N={[C]:S??void 0,r:$??void 0};if(p!=null&&g!=null)throw new Error("cannot reduce both x and y");if(g!=null){N.y=g;L=isOrdinal(i)?groupX:binX}else if(p!=null){N.x=p;L=isOrdinal(l)?groupY:binY}else S==null&&$==null||(i&&l?L=isOrdinal(i)&&isOrdinal(l)?group:isOrdinal(i)?binY:isOrdinal(l)?binX:bin:i?L=isOrdinal(i)?groupX:binX:l&&(L=isOrdinal(l)?groupY:binY));L!==bin&&L!==binX||(I.x={value:i,...m});L!==bin&&L!==binY||(I.y={value:l,...x});h===void 0&&(h=i&&!(L===bin||L===binX)&&(O===barX||O===areaX||O===rectX||O===ruleY));b===void 0&&(b=l&&!(L===bin||L===binY)&&(O===barY||O===areaY||O===rectY||O===ruleX));return{fx:u??null,fy:f??null,x:{value:d??null,reduce:p??null,zero:!!h,...m},y:{value:y??null,reduce:g??null,zero:!!b,...x},color:{value:w??null,reduce:S??null,...k!==void 0&&{color:k}},size:{value:A??null,reduce:$??null},mark:M,markImpl:Ka[O],markOptions:I,transformImpl:Ka[L],transformOptions:N,colorMode:C}}function auto(e,t){const n=autoSpec(e,t);const{fx:r,fy:o,x:{zero:a},y:{zero:i},markOptions:l,transformOptions:s,colorMode:c}=n;const u=Za[n.markImpl];const f=Za[n.transformImpl];const d=r!=null||o!=null?frame({strokeOpacity:.1}):null;const p=[a?ruleX([0]):null,i?ruleY([0]):null];const h=u(e,f?f(s,l):l);return c==="stroke"?marks(d,p,h):marks(d,h,p)}function isMonotonic(t){let n;let r;for(const o of t){if(o==null)continue;if(n===void 0){n=o;continue}const t=Math.sign(e(n,o));if(t){if(r!==void 0&&t!==r)return false;n=o;r=t}}return true}function normalizeOptions({x:e,y:t,color:n,size:r,fx:o,fy:a,mark:i}={}){isOptions(e)||(e=makeOptions(e));isOptions(t)||(t=makeOptions(t));isOptions(n)||(n=isColor(n)?{color:n}:makeOptions(n));isOptions(r)||(r=makeOptions(r));isOptions(o)&&({value:o}=makeOptions(o));isOptions(a)&&({value:a}=makeOptions(a));i!=null&&(i=`${i}`.toLowerCase());return{x:e,y:t,color:n,size:r,fx:o,fy:a,mark:i}}function materializeValue(e,t){const n=valueof(e,t.value);n&&(n.label=labelof(t.value));return n}function makeOptions(e){return isReducer(e)?{reduce:e}:{value:e}}function isZeroReducer(e){return/^(?:distinct|count|sum|proportion)$/i.test(e)}function isSelectReducer(e){return/^(?:first|last|mode)$/i.test(e)}function isReducer(e){if(e==null)return false;if(typeof e.reduceIndex==="function")return true;if(typeof e.reduce==="function"&&isObject(e))return true;if(/^p\d{2}$/i.test(e))return true;switch(`${e}`.toLowerCase()){case"first":case"last":case"count":case"distinct":case"sum":case"proportion":case"proportion-facet":case"deviation":case"min":case"min-index":case"max":case"max-index":case"mean":case"median":case"variance":case"mode":return true}return false}function isHighCardinality(e){return!!e&&new ue(e).size>e.length>>1}const Za={dot:dot,line:line,lineX:lineX,lineY:lineY,areaX:areaX,areaY:areaY,ruleX:ruleX,ruleY:ruleY,barX:barX,barY:barY,rect:rect,rectX:rectX,rectY:rectY,cell:cell,bin:bin,binX:binX,binY:binY,group:group,groupX:groupX,groupY:groupY};const Ka=Object.fromEntries(Object.entries(Za).map((([e,t])=>[t,e])));function mapX(e,t={}){let{x:n,x1:r,x2:o}=t;n===void 0&&r===void 0&&o===void 0&&(t={...t,x:n=no});const a={};n!=null&&(a.x=e);r!=null&&(a.x1=e);o!=null&&(a.x2=e);return map(a,t)}function mapY(e,t={}){let{y:n,y1:r,y2:o}=t;n===void 0&&r===void 0&&o===void 0&&(t={...t,y:n=no});const a={};n!=null&&(a.y=e);r!=null&&(a.y1=e);o!=null&&(a.y2=e);return map(a,t)}function map(e={},t={}){const n=maybeZ(t);const r=Object.entries(e).map((([e,n])=>{const r=maybeInput(e,t);if(r==null)throw new Error(`missing channel: ${e}`);const[o,a]=column(r);return{key:e,input:r,output:o,setOutput:a,map:maybeMap(n)}}));return{...basic(t,((e,t)=>{const o=valueof(e,n);const a=r.map((({input:t})=>valueof(e,t)));const i=r.map((({setOutput:t})=>t(new Array(e.length))));for(const e of t)for(const t of o?Q(e,(e=>o[e])).values():[e])r.forEach((({map:e},n)=>e.mapIndex(t,a[n],i[n])));return{data:e,facets:t}})),...Object.fromEntries(r.map((({key:e,output:t})=>[e,t])))}}function maybeMap(e){if(e==null)throw new Error("missing map");if(typeof e.mapIndex==="function")return e;if(typeof e.map==="function"&&isObject(e))return mapMap(e);if(typeof e==="function")return mapFunction(taker(e));switch(`${e}`.toLowerCase()){case"cumsum":return Ua;case"rank":return mapFunction(((e,t)=>br(e,(e=>t[e]))));case"quantile":return mapFunction(((e,t)=>rankQuantile(e,(e=>t[e]))))}throw new Error(`invalid map: ${e}`)}function mapMap(e){console.warn("deprecated map interface; implement mapIndex instead.");return{mapIndex:e.map.bind(e)}}function rankQuantile(e,t){const n=vr(e,t)-1;return br(e,t).map((e=>e/n))}function mapFunction(e){return{mapIndex(t,n,r){const o=e(t,n);if(o.length!==t.length)throw new Error("map function returned a mismatched length");for(let e=0,n=t.length;e<n;++e)r[t[e]]=o[e]}}}const Ua={mapIndex(e,t,n){let r=0;for(const o of e)n[o]=r+=t[o]}};function windowX(e={},t){arguments.length===1&&(t=e);return mapX(window$1(e),t)}function windowY(e={},t){arguments.length===1&&(t=e);return mapY(window$1(e),t)}function window$1(e={}){typeof e==="number"&&(e={k:e});let{k:t,reduce:n,shift:r,anchor:o,strict:a}=e;if(o===void 0&&r!==void 0){o=maybeShift(r);warn(`Warning: the shift option is deprecated; please use anchor "${o}" instead.`)}if(!((t=Math.floor(t))>0))throw new Error(`invalid k: ${t}`);return maybeReduce(n)(t,maybeAnchor$1(o,t),a)}function maybeAnchor$1(e="middle",t){switch(`${e}`.toLowerCase()){case"middle":return t-1>>1;case"start":return 0;case"end":return t-1}throw new Error(`invalid anchor: ${e}`)}function maybeShift(e){switch(`${e}`.toLowerCase()){case"centered":return"middle";case"leading":return"start";case"trailing":return"end"}throw new Error(`invalid shift: ${e}`)}function maybeReduce(e="mean"){if(typeof e==="string"){if(/^p\d{2}$/i.test(e))return reduceAccessor(percentile(e));switch(e.toLowerCase()){case"deviation":return reduceAccessor(ie);case"max":return reduceArray(((e,t)=>z(e,(e=>t[e]))));case"mean":return reduceMean;case"median":return reduceAccessor(te);case"min":return reduceArray(((e,t)=>ae(e,(e=>t[e]))));case"mode":return reduceArray(((e,t)=>J(e,(e=>t[e]))));case"sum":return reduceSum;case"variance":return reduceAccessor(ee);case"difference":return reduceDifference;case"ratio":return reduceRatio;case"first":return reduceFirst;case"last":return reduceLast}}if(typeof e!=="function")throw new Error(`invalid reduce: ${e}`);return reduceArray(taker(e))}function reduceAccessor(e){return(t,n,r)=>r?{mapIndex(r,o,a){const v=e=>o[e]==null?NaN:+o[e];let i=0;for(let e=0;e<t-1;++e)isNaN(v(e))&&++i;for(let o=0,l=r.length-t+1;o<l;++o){isNaN(v(o+t-1))&&++i;a[r[o+n]]=i===0?e(subarray(r,o,o+t),v):NaN;isNaN(v(o))&&--i}}}:{mapIndex(r,o,a){const v=e=>o[e]==null?NaN:+o[e];for(let o=-n;o<0;++o)a[r[o+n]]=e(subarray(r,0,o+t),v);for(let o=0,i=r.length-n;o<i;++o)a[r[o+n]]=e(subarray(r,o,o+t),v)}}}function reduceArray(e){return(t,n,r)=>r?{mapIndex(r,o,a){let i=0;for(let e=0;e<t-1;++e)i+=defined(o[r[e]]);for(let l=0,s=r.length-t+1;l<s;++l){i+=defined(o[r[l+t-1]]);i===t&&(a[r[l+n]]=e(subarray(r,l,l+t),o));i-=defined(o[r[l]])}}}:{mapIndex(r,o,a){for(let i=-n;i<0;++i)a[r[i+n]]=e(subarray(r,0,i+t),o);for(let i=0,l=r.length-n;i<l;++i)a[r[i+n]]=e(subarray(r,i,i+t),o)}}}function reduceSum(e,t,n){return n?{mapIndex(n,r,o){let a=0;let i=0;for(let t=0;t<e-1;++t){const e=r[n[t]];e===null||isNaN(e)?++a:i+=+e}for(let l=0,s=n.length-e+1;l<s;++l){const s=r[n[l]];const c=r[n[l+e-1]];c===null||isNaN(c)?++a:i+=+c;o[n[l+t]]=a===0?i:NaN;s===null||isNaN(s)?--a:i-=+s}}}:{mapIndex(n,r,o){let a=0;const i=n.length;for(let o=0,l=Math.min(i,e-t-1);o<l;++o)a+=+r[n[o]]||0;for(let l=-t,s=i-t;l<s;++l){a+=+r[n[l+e-1]]||0;o[n[l+t]]=a;a-=+r[n[l]]||0}}}}function reduceMean(e,t,n){if(n){const r=reduceSum(e,t,n);return{mapIndex(n,o,a){r.mapIndex(n,o,a);for(let r=0,o=n.length-e+1;r<o;++r)a[n[r+t]]/=e}}}return{mapIndex(n,r,o){let a=0;let i=0;const l=n.length;for(let o=0,s=Math.min(l,e-t-1);o<s;++o){let e=r[n[o]];e===null||isNaN(e=+e)||(a+=e,++i)}for(let s=-t,c=l-t;s<c;++s){let l=r[n[s+e-1]];let c=r[n[s]];l===null||isNaN(l=+l)||(a+=l,++i);o[n[s+t]]=a/i;c===null||isNaN(c=+c)||(a-=c,--i)}}}}function firstDefined(e,t,n,r){for(let o=n+r;n<o;++n){const r=e[t[n]];if(defined(r))return r}}function lastDefined(e,t,n,r){for(let o=n+r-1;o>=n;--o){const n=e[t[o]];if(defined(n))return n}}function firstNumber(e,t,n,r){for(let o=n+r;n<o;++n){let r=e[t[n]];if(r!==null&&!isNaN(r=+r))return r}}function lastNumber(e,t,n,r){for(let o=n+r-1;o>=n;--o){let n=e[t[o]];if(n!==null&&!isNaN(n=+n))return n}}function reduceDifference(e,t,n){return n?{mapIndex(n,r,o){for(let a=0,i=n.length-e;a<i;++a){const i=r[n[a]];const l=r[n[a+e-1]];o[n[a+t]]=i===null||l===null?NaN:l-i}}}:{mapIndex(n,r,o){for(let a=-t,i=n.length-e+t+1;a<i;++a)o[n[a+t]]=lastNumber(r,n,a,e)-firstNumber(r,n,a,e)}}}function reduceRatio(e,t,n){return n?{mapIndex(n,r,o){for(let a=0,i=n.length-e;a<i;++a){const i=r[n[a]];const l=r[n[a+e-1]];o[n[a+t]]=i===null||l===null?NaN:l/i}}}:{mapIndex(n,r,o){for(let a=-t,i=n.length-e+t+1;a<i;++a)o[n[a+t]]=lastNumber(r,n,a,e)/firstNumber(r,n,a,e)}}}function reduceFirst(e,t,n){return n?{mapIndex(n,r,o){for(let a=0,i=n.length-e;a<i;++a)o[n[a+t]]=r[n[a]]}}:{mapIndex(n,r,o){for(let a=-t,i=n.length-e+t+1;a<i;++a)o[n[a+t]]=firstDefined(r,n,a,e)}}}function reduceLast(e,t,n){return n?{mapIndex(n,r,o){for(let a=0,i=n.length-e;a<i;++a)o[n[a+t]]=r[n[a+e-1]]}}:{mapIndex(n,r,o){for(let a=-t,i=n.length-e+t+1;a<i;++a)o[n[a+t]]=lastDefined(r,n,a,e)}}}const Qa={n:20,k:2,color:"currentColor",opacity:.2,strict:true,anchor:"end"};function bollingerX(e,{x:t=no,y:n,k:r=Qa.k,color:o=Qa.color,opacity:a=Qa.opacity,fill:i=o,fillOpacity:l=a,stroke:s=o,strokeOpacity:c,strokeWidth:u,...f}={}){return marks(isNoneish(i)?null:areaX(e,map({x1:bollinger({k:-r,...f}),x2:bollinger({k:r,...f})},{x1:t,x2:t,y:n,fill:i,fillOpacity:l,...f})),isNoneish(s)?null:lineX(e,map({x:bollinger(f)},{x:t,y:n,stroke:s,strokeOpacity:c,strokeWidth:u,...f})))}function bollingerY(e,{x:t,y:n=no,k:r=Qa.k,color:o=Qa.color,opacity:a=Qa.opacity,fill:i=o,fillOpacity:l=a,stroke:s=o,strokeOpacity:c,strokeWidth:u,...f}={}){return marks(isNoneish(i)?null:areaY(e,map({y1:bollinger({k:-r,...f}),y2:bollinger({k:r,...f})},{x:t,y1:n,y2:n,fill:i,fillOpacity:l,...f})),isNoneish(s)?null:lineY(e,map({y:bollinger(f)},{x:t,y:n,stroke:s,strokeOpacity:c,strokeWidth:u,...f})))}function bollinger({n:e=Qa.n,k:t=0,strict:n=Qa.strict,anchor:r=Qa.anchor}={}){return window$1({k:e,reduce:e=>ne(e)+t*(ie(e)||0),strict:n,anchor:r})}const Ja={ariaLabel:"tick",fill:null,stroke:"currentColor"};class AbstractTick extends Mark{constructor(e,t,n){super(e,t,n,Ja);markers(this,n)}render(e,t,n,r,o){return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(this._transform,this,t).call((a=>a.selectAll().data(e).enter().append("line").call(applyDirectStyles,this).attr("x1",this._x1(t,n,r)).attr("x2",this._x2(t,n,r)).attr("y1",this._y1(t,n,r)).attr("y2",this._y2(t,n,r)).call(applyChannelStyles,this,n).call(applyMarkers,this,n,o))).node()}}class TickX extends AbstractTick{constructor(e,t={}){const{x:n,y:r,inset:o=0,insetTop:a=o,insetBottom:i=o}=t;super(e,{x:{value:n,scale:"x"},y:{value:r,scale:"y",type:"band",optional:true}},t);this.insetTop=number$1(a);this.insetBottom=number$1(i)}_transform(e,t,{x:n}){e.call(applyTransform,t,{x:n},Qo,0)}_x1(e,{x:t}){return e=>t[e]}_x2(e,{x:t}){return e=>t[e]}_y1({y:e},{y:t},{marginTop:n}){const{insetTop:r}=this;return t&&e?e=>t[e]+r:n+r}_y2({y:e},{y:t},{height:n,marginBottom:r}){const{insetBottom:o}=this;return t&&e?n=>t[n]+e.bandwidth()-o:n-r-o}}class TickY extends AbstractTick{constructor(e,t={}){const{x:n,y:r,inset:o=0,insetRight:a=o,insetLeft:i=o}=t;super(e,{y:{value:r,scale:"y"},x:{value:n,scale:"x",type:"band",optional:true}},t);this.insetRight=number$1(a);this.insetLeft=number$1(i)}_transform(e,t,{y:n}){e.call(applyTransform,t,{y:n},0,Qo)}_x1({x:e},{x:t},{marginLeft:n}){const{insetLeft:r}=this;return t&&e?e=>t[e]+r:n+r}_x2({x:e},{x:t},{width:n,marginRight:r}){const{insetRight:o}=this;return t&&e?n=>t[n]+e.bandwidth()-o:n-r-o}_y1(e,{y:t}){return e=>t[e]}_y2(e,{y:t}){return e=>t[e]}}function tickX(e,{x:t=no,...n}={}){return new TickX(e,{...n,x:t})}function tickY(e,{y:t=no,...n}={}){return new TickY(e,{...n,y:t})}function boxX(e,{x:t=no,y:n=null,r:r,fill:o="#ccc",fillOpacity:a,stroke:i="currentColor",strokeOpacity:l,strokeWidth:s=2,sort:c,...u}={}){const f=n!=null?groupY:groupZ$1;return marks(ruleY(e,f({x1:loqr1,x2:hiqr2},{x:t,y:n,stroke:i,strokeOpacity:l,...u})),barX(e,f({x1:"p25",x2:"p75"},{x:t,y:n,fill:o,fillOpacity:a,...u})),tickX(e,f({x:"p50"},{x:t,y:n,stroke:i,strokeOpacity:l,strokeWidth:s,sort:c,...u})),dot(e,map({x:oqr},{x:t,y:n,z:n,r:r,stroke:i,strokeOpacity:l,...u})))}function boxY(e,{y:t=no,x:n=null,r:r,fill:o="#ccc",fillOpacity:a,stroke:i="currentColor",strokeOpacity:l,strokeWidth:s=2,sort:c,...u}={}){const f=n!=null?groupX:groupZ$1;return marks(ruleX(e,f({y1:loqr1,y2:hiqr2},{x:n,y:t,stroke:i,strokeOpacity:l,...u})),barY(e,f({y1:"p25",y2:"p75"},{x:n,y:t,fill:o,fillOpacity:a,...u})),tickY(e,f({y:"p50"},{x:n,y:t,stroke:i,strokeOpacity:l,strokeWidth:s,sort:c,...u})),dot(e,map({y:oqr},{x:n,y:t,z:n,r:r,stroke:i,strokeOpacity:l,...u})))}function oqr(e){const t=loqr1(e);const n=hiqr2(e);return e.map((e=>e<t||e>n?e:NaN))}function loqr1(e){const t=quartile1(e)*2.5-quartile3(e)*1.5;return ae(e,(e=>e>=t?e:NaN))}function hiqr2(e){const t=quartile3(e)*2.5-quartile1(e)*1.5;return z(e,(e=>e<=t?e:NaN))}function quartile1(e){return E(e,.25)}function quartile3(e){return E(e,.75)}const ei={ariaLabel:"raster",stroke:null,pixelSize:1};function number(e,t){const n=+e;if(isNaN(n))throw new Error(`invalid ${t}: ${e}`);return n}function integer(e,t){const n=Math.floor(e);if(isNaN(n))throw new Error(`invalid ${t}: ${e}`);return n}class AbstractRaster extends Mark{constructor(e,t,n={},r){let{width:o,height:a,x:i,y:l,x1:s=(i==null?0:void 0),y1:c=(l==null?0:void 0),x2:u=(i==null?o:void 0),y2:f=(l==null?a:void 0),pixelSize:d=r.pixelSize,blur:p=0,interpolate:h}=n;o!=null&&(o=integer(o,"width"));a!=null&&(a=integer(a,"height"));s!=null&&(s=number(s,"x1"));c!=null&&(c=number(c,"y1"));u!=null&&(u=number(u,"x2"));f!=null&&(f=number(f,"y2"));if(i==null&&(s==null||u==null))throw new Error("missing x");if(l==null&&(c==null||f==null))throw new Error("missing y");if(e!=null&&o!=null&&a!=null){i===void 0&&s!=null&&u!=null&&(i=denseX(s,u,o,a));l===void 0&&c!=null&&f!=null&&(l=denseY(c,f,o,a))}super(e,{x:{value:i,scale:"x",optional:true},y:{value:l,scale:"y",optional:true},x1:{value:s==null?null:[s],scale:"x",optional:true,filter:null},y1:{value:c==null?null:[c],scale:"y",optional:true,filter:null},x2:{value:u==null?null:[u],scale:"x",optional:true,filter:null},y2:{value:f==null?null:[f],scale:"y",optional:true,filter:null},...t},n,r);this.width=o;this.height=a;this.pixelSize=number(d,"pixelSize");this.blur=number(p,"blur");this.interpolate=i==null||l==null?null:maybeInterpolate(h)}}class Raster extends AbstractRaster{constructor(e,t={}){const{imageRendering:n}=t;if(e==null){const{fill:e,fillOpacity:n}=t;maybeNumberChannel(n)[0]!==void 0&&(t=sampler("fillOpacity",t));maybeColorChannel(e)[0]!==void 0&&(t=sampler("fill",t))}super(e,void 0,t,ei);this.imageRendering=impliedString(n,"auto")}scale(e,{color:t,...n},r){return super.scale(e,n,r)}render(e,t,n,r,o){const a=t[n.channels.fill?.scale]??(e=>e);const{x:i,y:l}=n;const{document:s}=o;const[c,u,f,d]=renderBounds(n,r,o);const p=f-c;const h=d-u;const{pixelSize:m,width:y=Math.round(Math.abs(p)/m),height:g=Math.round(Math.abs(h)/m)}=this;const b=y*g;let{fill:x,fillOpacity:w}=n;let k=0;if(this.interpolate){const t=y/p;const n=g/h;const r=map$1(i,(e=>(e-c)*t),Float64Array);const o=map$1(l,(e=>(e-u)*n),Float64Array);x&&(x=this.interpolate(e,y,g,r,o,x));w&&(w=this.interpolate(e,y,g,r,o,w))}else this.data==null&&e&&(k=e.fi*b);const S=s.createElement("canvas");S.width=y;S.height=g;const A=S.getContext("2d");const $=A.createImageData(y,g);const M=$.data;let{r:T,g:C,b:O}=Bn(this.fill)??{r:0,g:0,b:0};let I=(this.fillOpacity??1)*255;for(let e=0;e<b;++e){const t=e<<2;if(x){const n=a(x[e+k]);if(n==null){M[t+3]=0;continue}({r:T,g:C,b:O}=Bn(n))}w&&(I=w[e+k]*255);M[t+0]=T;M[t+1]=C;M[t+2]=O;M[t+3]=I}this.blur>0&&xr($,this.blur);A.putImageData($,0,0);return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,t).call((e=>e.append("image").attr("transform",`translate(${c},${u}) scale(${Math.sign(f-c)},${Math.sign(d-u)})`).attr("width",Math.abs(p)).attr("height",Math.abs(h)).attr("preserveAspectRatio","none").call(applyAttr,"image-rendering",this.imageRendering).call(applyDirectStyles,this).attr("xlink:href",S.toDataURL()))).node()}}function maybeTuples(e,t,n){arguments.length<3&&(n=t,t=null);let{x:r,y:o,[e]:a,...i}=n;if(r===void 0&&o===void 0&&isTuples(t)){r=first,o=second;a===void 0&&(a=third)}return[t,{...i,x:r,y:o,[e]:a}]}function raster(){const[e,t]=maybeTuples("fill",...arguments);return new Raster(e,e==null||t.fill!==void 0||t.fillOpacity!==void 0?t:{...t,fill:no})}function renderBounds({x1:e,y1:t,x2:n,y2:r},o,{projection:a}){const{width:i,height:l,marginTop:s,marginRight:c,marginBottom:u,marginLeft:f}=o;return[e&&a==null?e[0]:f,t&&a==null?t[0]:s,n&&a==null?n[0]:i-c,r&&a==null?r[0]:l-u]}function rasterBounds({x1:e,y1:t,x2:n,y2:r},o,a,i){const l={};e&&(l.x1=e);t&&(l.y1=t);n&&(l.x2=n);r&&(l.y2=r);return renderBounds(valueObject(l,o),a,i)}function sampler(e,t={}){const{[e]:n}=t;if(typeof n!=="function")throw new Error(`invalid ${e}: not a function`);return initializer({...t,[e]:void 0},(function(r,o,a,i,l,s){const{x:c,y:u}=i;if(!c)throw new Error("missing scale: x");if(!u)throw new Error("missing scale: y");const[f,d,p,h]=rasterBounds(a,i,l,s);const m=p-f;const y=h-d;const{pixelSize:g}=this;const{width:b=Math.round(Math.abs(m)/g),height:x=Math.round(Math.abs(y)/g)}=t;const w=new Array(b*x*(o?o.length:1));const k=m/b;const S=y/x;let A=0;for(const e of o??[void 0])for(let t=.5;t<x;++t)for(let r=.5;r<b;++r,++A)w[A]=n(c.invert(f+r*k),u.invert(d+t*S),e);return{data:w,facets:o,channels:{[e]:{value:w,scale:"auto"}}}}))}function maybeInterpolate(e){if(typeof e==="function")return e;if(e==null)return interpolateNone;switch(`${e}`.toLowerCase()){case"none":return interpolateNone;case"nearest":return interpolateNearest;case"barycentric":return interpolatorBarycentric();case"random-walk":return interpolatorRandomWalk()}throw new Error(`invalid interpolate: ${e}`)}function interpolateNone(e,t,n,r,o,a){const i=new Array(t*n);for(const l of e)r[l]<0||r[l]>=t||o[l]<0||o[l]>=n||(i[Math.floor(o[l])*t+Math.floor(r[l])]=a[l]);return i}function interpolatorBarycentric({random:e=U(42)}={}){return(t,n,r,o,a,i)=>{const{points:l,triangles:s,hull:c}=wr.from(t,(e=>o[e]),(e=>a[e]));const u=new i.constructor(n*r).fill(NaN);const f=new Uint8Array(n*r);const d=mixer(i,e);for(let e=0;e<s.length;e+=3){const o=s[e];const a=s[e+1];const c=s[e+2];const p=l[2*o];const h=l[2*a];const m=l[2*c];const y=l[2*o+1];const g=l[2*a+1];const b=l[2*c+1];const x=Math.min(p,h,m);const w=Math.max(p,h,m);const k=Math.min(y,g,b);const S=Math.max(y,g,b);const A=(g-b)*(p-m)+(y-b)*(m-h);if(!A)continue;const $=i[t[o]];const M=i[t[a]];const T=i[t[c]];for(let e=Math.floor(x);e<w;++e)for(let t=Math.floor(k);t<S;++t){if(e<0||e>=n||t<0||t>=r)continue;const o=e+.5;const a=t+.5;const i=Math.sign(A);const l=(g-b)*(o-m)+(a-b)*(m-h);if(l*i<0)continue;const s=(b-y)*(o-m)+(a-b)*(p-m);if(s*i<0)continue;const c=A-(l+s);if(c*i<0)continue;const x=e+n*t;u[x]=d($,l/A,M,s/A,T,c/A,e,t);f[x]=1}}extrapolateBarycentric(u,f,o,a,i,n,r,c,t,d);return u}}function extrapolateBarycentric(e,t,n,r,o,a,i,l,s,c){n=Float64Array.from(l,(e=>n[s[e]]));r=Float64Array.from(l,(e=>r[s[e]]));o=Array.from(l,(e=>o[s[e]]));const u=n.length;const f=Array.from({length:u},((e,t)=>ray(t,n,r)));let d=0;for(let l=0;l<i;++l){const i=l+.5;for(let s=0;s<a;++s){const p=s+a*l;if(!t[p]){const t=s+.5;for(let a=0;a<u;++a){const h=(u+d+(a%2?(a+1)/2:-a/2))%u;if(f[h](t,i)){const a=segmentProject(n.at(h-1),r.at(h-1),n[h],r[h],t,i);e[p]=c(o.at(h-1),a,o[h],1-a,o[h],0,s,l);d=h;break}}}}}}function segmentProject(e,t,n,r,o,a){const i=n-e;const l=r-t;const s=i*(n-o)+l*(r-a);const c=i*(o-e)+l*(a-t);return s>0&&c>0?s/(s+c):+(s>c)}function cross(e,t,n,r){return e*r-n*t}function ray(e,t,n){const r=t.length;const o=t.at(e-2);const a=n.at(e-2);const i=t.at(e-1);const l=n.at(e-1);const s=t[e];const c=n[e];const u=t.at(e+1-r);const f=n.at(e+1-r);const d=i-s;const p=l-c;const h=o-i;const m=a-l;const y=s-u;const g=c-f;const b=Math.hypot(d,p);const x=Math.hypot(h,m);const w=Math.hypot(y,g);return(e,t)=>{const n=e-i;const r=t-l;const o=e-s;const a=t-c;return cross(n,r,o,a)>-1e-6&&cross(n,r,d,p)*x-cross(n,r,h,m)*b>-1e-6&&cross(o,a,y,g)*b-cross(o,a,d,p)*w<=0}}function interpolateNearest(e,t,n,r,o,a){const i=new a.constructor(t*n);const l=wr.from(e,(e=>r[e]),(e=>o[e]));let s,c;for(let r=.5,o=0;r<n;++r){c=s;for(let n=.5;n<t;++n,++o){c=l.find(n,r,c);n===.5&&(s=c);i[o]=a[e[c]]}}return i}function interpolatorRandomWalk({random:e=U(42),minDistance:t=.5,maxSteps:n=2}={}){return(r,o,a,i,l,s)=>{const c=new s.constructor(o*a);const u=wr.from(r,(e=>i[e]),(e=>l[e]));let f,d,p;for(let h=.5,m=0;h<a;++h){d=f;for(let a=.5;a<o;++a,++m){let o=a;let y=h;p=d=u.find(o,y,d);a===.5&&(f=d);let g;let b=0;while((g=Math.hypot(i[r[p]]-o,l[r[p]]-y))>t&&b<n){const t=e(a,h,b)*2*Math.PI;o+=Math.cos(t)*g;y+=Math.sin(t)*g;p=u.find(o,y,p);++b}c[m]=s[r[p]]}}return c}}function blend(e,t,n,r,o,a){return t*e+r*n+a*o}function pick(e){return(t,n,r,o,a,i,l,s)=>{const c=e(l,s);return c<n?t:c<n+o?r:a}}function mixer(e,t){return isNumeric(e)||isTemporal(e)?blend:pick(t)}function denseX(e,t,n){return{transform(r){const o=r.length;const a=new Float64Array(o);const i=(t-e)/n;const l=e+i/2;for(let e=0;e<o;++e)a[e]=e%n*i+l;return a}}}function denseY(e,t,n,r){return{transform(o){const a=o.length;const i=new Float64Array(a);const l=(t-e)/r;const s=e+l/2;for(let e=0;e<a;++e)i[e]=Math.floor(e/n)%r*l+s;return i}}}const ti={ariaLabel:"contour",fill:"none",stroke:"currentColor",strokeMiterlimit:1,pixelSize:2};class Contour extends AbstractRaster{constructor(e,{smooth:t=true,value:n,...r}={}){const o=styles({},r,ti);if(n===void 0)for(const e in o)if(o[e].value!=null){if(n!==void 0)throw new Error("ambiguous contour value");n=r[e];r[e]="value"}if(n!=null){const e={transform:e=>e.map((e=>e.value)),label:labelof(n)};for(const t in o)r[t]==="value"&&(r[t]=e)}if(e==null){if(n==null)throw new Error("missing contour value");r=sampler("value",{value:n,...r});n=null}else{let{interpolate:e}=r;n===void 0&&(n=no);e===void 0&&(r.interpolate="nearest")}super(e,{value:{value:n,optional:true}},contourGeometry(r),ti);const a={geometry:{value:no}};for(const e in this.channels){const t=this.channels[e];const{scale:n}=t;if(n!=="x"&&n!=="y"&&e!=="value"){a[e]=t;delete this.channels[e]}}this.contourChannels=a;this.smooth=!!t}filter(e,{x:t,y:n,value:r,...o},a){return super.filter(e,o,a)}render(e,t,n,r,o){const{geometry:a}=n;const i=mn();return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,t).call((t=>{t.selectAll().data(e).enter().append("path").call(applyDirectStyles,this).attr("d",(e=>i(a[e]))).call(applyChannelStyles,this,n)})).node()}}function contourGeometry({thresholds:e,interval:t,...n}){e=maybeThresholds(e,t,dr);return initializer(n,(function(t,n,r,o,a,i){const[l,s,c,u]=rasterBounds(r,o,a,i);const f=c-l;const d=u-s;const{pixelSize:p,width:h=Math.round(Math.abs(f)/p),height:m=Math.round(Math.abs(d)/p)}=this;const y=h/f;const g=m/d;const b=r.value.value;const x=[];if(this.interpolate){const{x:e,y:t}=applyPosition(r,o,i);const a=map$1(e,(e=>(e-l)*y),Float64Array);const c=map$1(t,(e=>(e-s)*g),Float64Array);const u=[r.x,r.y,r.value];const f=[a,c,b];for(const e of n){const t=this.filter(e,u,f);x.push(this.interpolate(t,h,m,a,c,b))}}else if(n){const e=h*m;const t=n.length;for(let n=0;n<t;++n)x.push(b.slice(n*e,n*e+e))}else x.push(b);if(this.blur>0)for(const e of x)kr({data:e,width:h,height:m},this.blur);const w=maybeTicks(e,b,...finiteExtent(x));if(w===null)throw new Error(`unsupported thresholds: ${e}`);const{contour:k}=Sr().size([h,m]).smooth(this.smooth);const S=[];const A=[];for(const e of x)A.push(F(S.length,S.push(...map$1(w,(t=>k(e,t))))));for(const{coordinates:e}of S)for(const t of e)for(const e of t)for(const t of e){t[0]=t[0]/y+l;t[1]=t[1]/g+s}return{data:S,facets:A,channels:createChannels(this.contourChannels,S)}}))}function maybeTicks(e,t,n,r){if(typeof e?.range==="function")return e.range(e.floor(n),r);typeof e==="function"&&(e=e(t,n,r));if(typeof e!=="number")return arrayify(e);const o=Ut(...Ar(n,r,e),e);while(o[o.length-1]>=r)o.pop();while(o[1]<n)o.shift();return o}function contour(){return new Contour(...maybeTuples("value",...arguments))}function finiteExtent(e){return[ae(e,(e=>ae(e,finite))),z(e,(e=>z(e,finite)))]}function finite(e){return isFinite(e)?e:NaN}function crosshair(e,t){return crosshairK(pointer,e,t)}function crosshairX(e,t={}){return crosshairK(pointerX,e,t)}function crosshairY(e,t={}){return crosshairK(pointerY,e,t)}function crosshairK(e,t,n={}){const{x:r,y:o,maxRadius:a}=n;const i=e({px:r,py:o,maxRadius:a});const l=[];r!=null&&l.push(ruleX(t,ruleOptions("x",{...i,inset:-6},n)));o!=null&&l.push(ruleY(t,ruleOptions("y",{...i,inset:-6},n)));r!=null&&l.push(text(t,textOptions("x",{...i,dy:9,frameAnchor:"bottom",lineAnchor:"top"},n)));o!=null&&l.push(text(t,textOptions("y",{...i,dx:-9,frameAnchor:"left",textAnchor:"end"},n)));for(const e of l)e.ariaLabel=`crosshair ${e.ariaLabel}`;return marks(...l)}function markOptions(e,{channels:t,...n},{facet:r,facetAnchor:o,fx:a,fy:i,[e]:l,channels:s,transform:c,initializer:u}){return{...n,facet:r,facetAnchor:o,fx:a,fy:i,[e]:l,channels:{...t,...s},transform:c,initializer:pxpy(e,u)}}function pxpy(e,t){return t==null?t:function(n,r,{x:o,y:a,px:i,py:l,...s},...c){const{channels:{x:u,y:f,...d}={},...p}=t.call(this,n,r,{...s,x:i,y:l},...c);return{channels:{...d,...u&&{px:u,...e==="x"&&{x:u}},...f&&{py:f,...e==="y"&&{y:f}}},...p}}}function ruleOptions(e,t,n){const{color:r="currentColor",opacity:o=.2,ruleStroke:a=r,ruleStrokeOpacity:i=o,ruleStrokeWidth:l}=n;return{...markOptions(e,t,n),stroke:a,strokeOpacity:i,strokeWidth:l}}function textOptions(e,t,n){const{color:r="currentColor",textFill:o=r,textFillOpacity:a,textStroke:i="var(--plot-background)",textStrokeOpacity:l,textStrokeWidth:s=5}=n;return{...markOptions(e,t,textChannel(e,n)),fill:o,fillOpacity:a,stroke:i,strokeOpacity:l,strokeWidth:s}}function textChannel(e,t){return initializer(t,((t,n,r)=>({channels:{text:{value:getSource(r,e)?.value}}})))}const ni={ariaLabel:"delaunay link",fill:"none",stroke:"currentColor",strokeMiterlimit:1};const ri={ariaLabel:"delaunay mesh",fill:null,stroke:"currentColor",strokeOpacity:.2};const oi={ariaLabel:"hull",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:1};const ai={ariaLabel:"voronoi",fill:"none",stroke:"currentColor",strokeMiterlimit:1};const ii={ariaLabel:"voronoi mesh",fill:null,stroke:"currentColor",strokeOpacity:.2};class DelaunayLink extends Mark{constructor(e,t={}){const{x:n,y:r,z:o,curve:a,tension:i}=t;super(e,{x:{value:n,scale:"x",optional:true},y:{value:r,scale:"y",optional:true},z:{value:o,optional:true}},t,ni);this.curve=maybeCurve(a,i);markers(this,t)}render(e,t,n,r,o){const{x:a,y:i}=t;const{x:l,y:s,z:c}=n;const{curve:u}=this;const[f,d]=applyFrameAnchor(this,r);const p=l?e=>l[e]:constant(f);const h=s?e=>s[e]:constant(d);const m=this;function links(e){let t=-1;const r=[];const a={};for(const e in n)a[e]=[];const i=[];const l=[];const s=[];const c=[];function link(o,u){o=e[o];u=e[u];r.push(++t);i[t]=p(o);s[t]=h(o);l[t]=p(u);c[t]=h(u);for(const e in n)a[e].push(n[e][u])}const{halfedges:f,hull:d,triangles:y}=wr.from(e,p,h);for(let e=0;e<f.length;++e){const t=f[e];t>e&&link(y[e],y[t])}for(let e=0;e<d.length;++e)link(d[e],d[(e+1)%d.length]);Rn(this).selectAll().data(r).enter().append("path").call(applyDirectStyles,m).attr("d",(e=>{const t=Xn();const n=u(t);n.lineStart();n.point(i[e],s[e]);n.point(l[e],c[e]);n.lineEnd();return t})).call(applyChannelStyles,m,a).call(applyMarkers,m,a,o)}return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{x:l&&a,y:s&&i}).call(c?t=>t.selectAll().data(Q(e,(e=>c[e])).values()).enter().append("g").each(links):t=>t.datum(e).each(links)).node()}}class AbstractDelaunayMark extends Mark{constructor(e,t={},n,r=({z:e})=>e){const{x:o,y:a}=t;super(e,{x:{value:o,scale:"x",optional:true},y:{value:a,scale:"y",optional:true},z:{value:r(t),optional:true}},t,n)}render(e,t,n,r,o){const{x:a,y:i}=t;const{x:l,y:s,z:c}=n;const[u,f]=applyFrameAnchor(this,r);const d=l?e=>l[e]:constant(u);const p=s?e=>s[e]:constant(f);const h=this;function mesh(e){const t=wr.from(e,d,p);Rn(this).append("path").datum(e[0]).call(applyDirectStyles,h).attr("d",h._render(t,r)).call(applyChannelStyles,h,n)}return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{x:l&&a,y:s&&i}).call(c?t=>t.selectAll().data(Q(e,(e=>c[e])).values()).enter().append("g").each(mesh):t=>t.datum(e).each(mesh)).node()}}class DelaunayMesh extends AbstractDelaunayMark{constructor(e,t={}){super(e,t,ri);this.fill="none"}_render(e){return e.render()}}class Hull extends AbstractDelaunayMark{constructor(e,t={}){super(e,t,oi,maybeZ)}_render(e){return e.renderHull()}}class Voronoi extends Mark{constructor(e,t={}){const{x:n,y:r,z:o}=t;super(e,{x:{value:n,scale:"x",optional:true},y:{value:r,scale:"y",optional:true},z:{value:o,optional:true}},initializer(t,(function(e,t,n,r,o,a){let{x:i,y:l,z:s}=n;({x:i,y:l}=applyPosition(n,r,a));s=s?.value;const c=new Array((i??l).length).fill(null);const[u,f]=applyFrameAnchor(this,o);const d=i?e=>i[e]:constant(u);const p=l?e=>l[e]:constant(f);for(let e of t){i&&(e=e.filter((e=>defined(d(e)))));l&&(e=e.filter((e=>defined(p(e)))));for(const[,t]of maybeGroup(e,s)){const e=wr.from(t,d,p);const n=voronoiof(e,o);for(let e=0,r=t.length;e<r;++e)c[t[e]]=n.renderCell(e)}}return{data:e,facets:t,channels:{cells:{value:c}}}})),ai)}render(e,t,n,r,o){const{x:a,y:i}=t;const{x:l,y:s,cells:c}=n;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{x:l&&a,y:s&&i}).call((t=>{t.selectAll().data(e).enter().append("path").call(applyDirectStyles,this).attr("d",(e=>c[e])).call(applyChannelStyles,this,n)})).node()}}class VoronoiMesh extends AbstractDelaunayMark{constructor(e,t){super(e,t,ii);this.fill="none"}_render(e,t){return voronoiof(e,t).render()}}function voronoiof(e,t){const{width:n,height:r,marginTop:o,marginRight:a,marginBottom:i,marginLeft:l}=t;return e.voronoi([l,o,n-a,r-i])}function delaunayMark(e,t,{x:n,y:r,...o}={}){[n,r]=maybeTuple(n,r);return new e(t,{...o,x:n,y:r})}function delaunayLink(e,t){return delaunayMark(DelaunayLink,e,t)}function delaunayMesh(e,t){return delaunayMark(DelaunayMesh,e,t)}function hull(e,t){return delaunayMark(Hull,e,t)}function voronoi(e,{x:t,y:n,initializer:r,...o}={}){return delaunayMark(Voronoi,e,{...basic({...o,x:t,y:n},exclusiveFacets),initializer:r})}function voronoiMesh(e,t){return delaunayMark(VoronoiMesh,e,t)}const li={ariaLabel:"density",fill:"none",stroke:"currentColor",strokeMiterlimit:1};class Density extends Mark{constructor(e,{x:t,y:n,z:r,weight:o,fill:a,stroke:i,...l}={}){const s=isDensity(a)&&(a="currentColor",true);const c=isDensity(i)&&(i="currentColor",true);super(e,{x:{value:t,scale:"x",optional:true},y:{value:n,scale:"y",optional:true},z:{value:maybeZ({z:r,fill:a,stroke:i}),optional:true},weight:{value:o,optional:true}},densityInitializer({...l,fill:a,stroke:i},s,c),li);s&&(this.fill=void 0);c&&(this.stroke=void 0);this.z=r}filter(e){return e}render(e,t,n,r,o){const{contours:a}=n;const i=mn();return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{}).call((t=>t.selectAll().data(e).enter().append("path").call(applyDirectStyles,this).call(applyChannelStyles,this,n).attr("d",(e=>i(a[e]))))).node()}}function density(e,{x:t,y:n,...r}={}){[t,n]=maybeTuple(t,n);return new Density(e,{...r,x:t,y:n})}const si=new Set(["x","y","z","weight"]);function densityInitializer(e,t,n){const r=100;let{bandwidth:o,thresholds:a}=e;o=o===void 0?20:+o;a=a===void 0?20:typeof a?.[Symbol.iterator]==="function"?coerceNumbers(a):+a;return initializer(e,(function(e,i,l,s,c,u){const f=l.weight?coerceNumbers(l.weight.value):null;const d=l.z?.value;const{z:p}=this;const[h,m]=applyFrameAnchor(this,c);const{width:y,height:g}=c;const{x:b,y:x}=applyPosition(l,s,u);const w=Object.fromEntries(Object.entries(l).filter((([e])=>!si.has(e))).map((([e,t])=>[e,{...t,value:[]}])));const k=t&&[];const S=n&&[];const A=$r().x(b?e=>b[e]:h).y(x?e=>x[e]:m).weight(f?e=>f[e]:1).size([y,g]).bandwidth(o);const $=[];for(const e of i){const t=[];$.push(t);for(const n of d?groupZ(e,d,p):[e]){const e=A.contours(n);t.push([n,e])}}let M=a;if(!(M instanceof Ur)){let e=0;for(const t of $)for(const[,n]of t){const t=n.max;t>e&&(e=t)}M=Float64Array.from({length:a-1},((t,n)=>e*r*(n+1)/a))}const T=[];const C=[];for(const e of $){const t=[];T.push(t);for(const[n,o]of e)for(const e of M){t.push(C.length);C.push(o(e/r));k&&k.push(e);S&&S.push(e);for(const e in w)w[e].value.push(l[e].value[n[0]])}}k&&k.push(0);S&&S.push(0);return{data:e,facets:T,channels:{...w,...k&&{fill:{value:k,scale:"color"}},...S&&{stroke:{value:S,scale:"color"}},contours:{value:C}}}}))}function isDensity(e){return/^density$/i.test(e)}function differenceX(e,t){return differenceK("x",e,t)}function differenceY(e,t){return differenceK("y",e,t)}function differenceK(e,t,{x1:n,x2:r,y1:o,y2:a,x:i=(n===void 0&&r===void 0?e==="y"?to:no:void 0),y:l=(o===void 0&&a===void 0?e==="x"?to:no:void 0),fill:s,positiveFill:c="#3ca951",negativeFill:u="#4269d0",fillOpacity:f=1,positiveFillOpacity:d=f,negativeFillOpacity:p=f,stroke:h,strokeOpacity:m,z:y=maybeColorChannel(h)[0],clip:g,tip:b,render:x,...w}={}){[n,r]=memoTuple(i,n,r);[o,a]=memoTuple(l,o,a);n===r&&o===a&&(e==="y"?o=memo(0):n=memo(0));({tip:b}=withTip({tip:b},e==="y"?"x":"y"));return marks(isNoneish(c)?null:Object.assign(area(t,{x1:n,x2:r,y1:o,y2:a,z:y,fill:c,fillOpacity:d,render:composeRender(x,clipDifference(e,true)),clip:g,...w}),{ariaLabel:"positive difference"}),isNoneish(u)?null:Object.assign(area(t,{x1:n,x2:r,y1:o,y2:a,z:y,fill:u,fillOpacity:p,render:composeRender(x,clipDifference(e,false)),clip:g,...w}),{ariaLabel:"negative difference"}),line(t,{x:r,y:a,z:y,stroke:h,strokeOpacity:m,tip:b,clip:true,...w}))}function memoTuple(e,t,n){if(t===void 0&&n===void 0)t=n=memo(e);else if(t===void 0){n=memo(n);t=e===void 0?n:memo(e)}else if(n===void 0){t=memo(t);n=e===void 0?t:memo(e)}else{t=memo(t);n=memo(n)}return[t,n]}function memo(e){let t;const{value:n,label:r=labelof(n)}=maybeValue(e);return{transform:e=>t||(t=valueof(e,n)),label:r}}function clipDifference(e,t){const n=e==="x"?"y":"x";const r=`${n}1`;const o=`${n}2`;const a=`${e}1`;const i=`${e}2`;return(n,l,s,c,u,f)=>{const{[r]:d,[o]:p}=s;const h=new Float32Array(d.length);const m=new Float32Array(p.length);const y=c[e==="y"?"height":"width"];(t===inferScaleOrder(l[e])<0?h:m).fill(y);const g=f(n,l,{...s,[o]:d,[i]:m},c,u);const b=f(n,l,{...s,[r]:p,[a]:h},c,u);const x=g.querySelector("g")??g;const w=b.querySelector("g")??b;for(let e=0;x.firstChild;e+=2){const t=getClipId();const n=create("svg:clipPath",u).attr("id",t).node();n.appendChild(x.firstChild);w.childNodes[e].setAttribute("clip-path",`url(#${t})`);w.insertBefore(n,w.childNodes[e])}return b}}function centroid({geometry:e=no,...t}={}){const n=memoize1((t=>valueof(t,e)));return initializer({...t,x:null,y:null,geometry:{transform:n}},((e,t,r,o,a,i)=>{const l=n(e);const s=l.length;const c=new Float64Array(s);const u=new Float64Array(s);const{centroid:f}=i.path();for(let e=0;e<s;++e)[c[e],u[e]]=f(l[e]);return{data:e,facets:t,channels:{x:{value:c,scale:null,source:null},y:{value:u,scale:null,source:null}}}}))}function geoCentroid({geometry:e=no,...t}={}){const n=memoize1((t=>valueof(t,e)));const r=memoize1((e=>valueof(n(e),Mr)));return{...t,x:{transform:e=>Float64Array.from(r(e),(([e])=>e))},y:{transform:e=>Float64Array.from(r(e),(([,e])=>e))},geometry:{transform:n}}}const ci={ariaLabel:"geo",fill:"none",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class Geo extends Mark{constructor(e,t={}){const[n,r]=maybeNumberChannel(t.r,3);super(e,{x:{value:t.tip?t.x:null,scale:"x",optional:true},y:{value:t.tip?t.y:null,scale:"y",optional:true},r:{value:n,scale:"r",filter:positive,optional:true},geometry:{value:t.geometry,scale:"projection"}},withDefaultSort(t),ci);this.r=r}render(e,t,n,r,o){const{geometry:a,r:i}=n;const l=o.path();const{r:s}=this;negative(s)?e=[]:s!==void 0&&l.pointRadius(s);return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,t).call((t=>{t.selectAll().data(e).enter().append("path").call(applyDirectStyles,this).attr("d",i?e=>l.pointRadius(i[e])(a[e]):e=>l(a[e])).call(applyChannelStyles,this,n)})).node()}}function geo(e,t={}){t.tip&&t.x===void 0&&t.y===void 0?t=centroid(t):t.geometry===void 0&&(t={...t,geometry:no});return new Geo(e,t)}function sphere({strokeWidth:e=1.5,...t}={}){return geo({type:"Sphere"},{strokeWidth:e,...t})}function graticule({strokeOpacity:e=.1,...t}={}){return geo(Tr(),{strokeOpacity:e,...t})}const ui=.5,fi=0;function hexbin(e={fill:"count"},{binWidth:t,...n}={}){const{z:r}=n;t=t===void 0?20:number$1(t);e=maybeGroupOutputs(e,n);hasOutput(e,"fill")&&(n.channels={...n.channels,fill:{value:[]}});n.symbol===void 0&&(n.symbol="hexagon");n.r!==void 0||hasOutput(e,"r")||(n.r=t/2);return initializer(n,((n,o,a,i,l,s)=>{let{x:c,y:u,z:f,fill:d,stroke:p,symbol:h}=a;if(c===void 0)throw new Error("missing channel: x");if(u===void 0)throw new Error("missing channel: y");({x:c,y:u}=applyPosition(a,i,s));f=f?f.value:valueof(n,r);d=d?.value;p=p?.value;h=h?.value;const m=maybeSubgroup(e,{z:f,fill:d,stroke:p,symbol:h});const y=f&&[];const g=d&&[];const b=p&&[];const x=h&&[];const w=[];const k=[];const S=[];let A=-1;for(const t of e)t.initialize(n);for(const r of o){const o=[];for(const t of e)t.scope("facet",r);for(const[a,i]of maybeGroup(r,m))for(const{index:r,extent:l}of hbin(n,i,c,u,t)){o.push(++A);k.push(l.x);S.push(l.y);f&&y.push(m===f?a:f[r[0]]);d&&g.push(m===d?a:d[r[0]]);p&&b.push(m===p?a:p[r[0]]);h&&x.push(m===h?a:h[r[0]]);for(const t of e)t.reduce(r,l)}w.push(o)}const $=a.x.scale;const M=a.y.scale;const T={x:{value:k,source:i[$]?{value:map$1(k,i[$].invert),scale:$}:null},y:{value:S,source:i[M]?{value:map$1(S,i[M].invert),scale:M}:null},...f&&{z:{value:y}},...d&&{fill:{value:g,scale:"auto"}},...p&&{stroke:{value:b,scale:"auto"}},...h&&{symbol:{value:x,scale:"auto"}},...Object.fromEntries(e.map((({name:e,output:n})=>[e,{scale:"auto",label:n.label,radius:e==="r"?t/2:void 0,value:n.transform()}])))};return{data:n,facets:w,channels:T}}))}function hbin(e,t,n,r,o){const a=o*(1.5/po);const i=new Map;for(const l of t){let t=n[l],s=r[l];if(isNaN(t)||isNaN(s))continue;let c=Math.round(s=(s-fi)/a),u=Math.round(t=(t-ui)/o-(c&1)/2),f=s-c;if(Math.abs(f)*3>1){let e=t-u,n=u+(t<u?-1:1)/2,r=c+(s<c?-1:1),o=t-n,a=s-r;e*e+f*f>o*o+a*a&&(u=n+(c&1?1:-1)/2,c=r)}const d=`${u},${c}`;let p=i.get(d);if(p===void 0){p={index:[],extent:{data:e,x:(u+(c&1)/2)*o+ui,y:c*a+fi}};i.set(d,p)}p.index.push(l)}return i.values()}const di={ariaLabel:"hexgrid",fill:"none",stroke:"currentColor",strokeOpacity:.1};function hexgrid(e){return new Hexgrid(e)}class Hexgrid extends Mark{constructor({binWidth:e=20,clip:t=true,...n}={}){super(eo,void 0,{clip:t,...n},di);this.binWidth=number$1(e)}render(e,t,n,r,o){const{binWidth:a}=this;const{marginTop:i,marginRight:l,marginBottom:s,marginLeft:c,width:u,height:f}=r;const d=c-ui,p=u-l-ui,h=i-fi,m=f-s-fi,y=a/2,g=y*ho,b=g/2,x=y*2,w=g*1.5,k=Math.floor(d/x),S=Math.ceil(p/x),A=Math.floor((h+b)/w),$=Math.ceil((m-b)/w)+1,M=`m0,${round(-g)}l${round(y)},${round(b)}v${round(g)}l${round(-y)},${round(b)}`;let T=M;for(let e=A;e<$;++e)for(let t=k;t<S;++t)T+=`M${round(t*x+(e&1)*y)},${round(e*w)}${M}`;return create("svg:g",o).datum(0).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{},Qo+ui,Qo+fi).call((e=>e.append("path").call(applyDirectStyles,this).call(applyChannelStyles,this,n).attr("d",T))).node()}}function round(e){return Math.round(e*1e3)/1e3}const pi={ariaLabel:"image",fill:null,stroke:null};function isPath(e){return/^\.*\//.test(e)}function isUrl(e){return/^(blob|data|file|http|https):/i.test(e)}function maybePathChannel(e){return typeof e==="string"&&(isPath(e)||isUrl(e))?[void 0,e]:[e,void 0]}class Image extends Mark{constructor(e,t={}){let{x:n,y:r,r:o,width:a,height:i,rotate:l,src:s,preserveAspectRatio:c,crossOrigin:u,frameAnchor:f,imageRendering:d}=t;o==null&&(o=void 0);o===void 0&&a===void 0&&i===void 0?a=i=16:a===void 0&&i!==void 0?a=i:i===void 0&&a!==void 0&&(i=a);const[p,h]=maybePathChannel(s);const[m,y]=maybeNumberChannel(o);const[g,b]=maybeNumberChannel(a,y!==void 0?y*2:void 0);const[x,w]=maybeNumberChannel(i,y!==void 0?y*2:void 0);const[k,S]=maybeNumberChannel(l,0);super(e,{x:{value:n,scale:"x",optional:true},y:{value:r,scale:"y",optional:true},r:{value:m,scale:"r",filter:positive,optional:true},width:{value:g,filter:positive,optional:true},height:{value:x,filter:positive,optional:true},rotate:{value:k,optional:true},src:{value:p,optional:true}},withDefaultSort(t),pi);this.src=h;this.width=b;this.rotate=S;this.height=w;this.r=y;this.preserveAspectRatio=impliedString(c,"xMidYMid");this.crossOrigin=string(u);this.frameAnchor=maybeFrameAnchor(f);this.imageRendering=impliedString(d,"auto")}render(e,t,n,r,o){const{x:a,y:i}=t;const{x:l,y:s,width:c,height:u,r:f,rotate:d,src:p}=n;const{r:h,width:m,height:y,rotate:g}=this;const[b,x]=applyFrameAnchor(this,r);return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,{x:l&&a,y:s&&i}).call((t=>t.selectAll().data(e).enter().append("image").call(applyDirectStyles,this).attr("x",position(l,c,f,b,m,h)).attr("y",position(s,u,f,x,y,h)).attr("width",c?e=>c[e]:m!==void 0?m:f?e=>f[e]*2:h*2).attr("height",u?e=>u[e]:y!==void 0?y:f?e=>f[e]*2:h*2).attr("transform",d?e=>`rotate(${d[e]})`:g?`rotate(${g})`:null).attr("transform-origin",d||g?template`${l?e=>l[e]:b}px ${s?e=>s[e]:x}px`:null).call(applyAttr,"href",p?e=>p[e]:this.src).call(applyAttr,"preserveAspectRatio",this.preserveAspectRatio).call(applyAttr,"crossorigin",this.crossOrigin).call(applyAttr,"image-rendering",this.imageRendering).call(applyAttr,"clip-path",f?e=>`circle(${f[e]}px)`:h!==void 0?`circle(${h}px)`:null).call(applyChannelStyles,this,n))).node()}}function position(e,t,n,r,o,a){return t&&e?n=>e[n]-t[n]/2:t?e=>r-t[e]/2:e&&o!==void 0?t=>e[t]-o/2:o!==void 0?r-o/2:n&&e?t=>e[t]-n[t]:n?e=>r-n[e]:e?t=>e[t]-a:r-a}function image(e,{x:t,y:n,...r}={}){r.frameAnchor===void 0&&([t,n]=maybeTuple(t,n));return new Image(e,{...r,x:t,y:n})}function ibetainv(e,t,n){var r=1e-8;var o=t-1;var a=n-1;var i=0;var l,s,c,u,f,d,p,h,m,y,g;if(e<=0)return 0;if(e>=1)return 1;if(t>=1&&n>=1){c=e<.5?e:1-e;u=Math.sqrt(-2*Math.log(c));p=(2.30753+u*.27061)/(1+u*(.99229+u*.04481))-u;e<.5&&(p=-p);h=(p*p-3)/6;m=2/(1/(2*t-1)+1/(2*n-1));y=p*Math.sqrt(h+m)/m-(1/(2*n-1)-1/(2*t-1))*(h+5/6-2/(3*m));p=t/(t+n*Math.exp(2*y))}else{l=Math.log(t/(t+n));s=Math.log(n/(t+n));u=Math.exp(t*l)/t;f=Math.exp(n*s)/n;y=u+f;p=e<u/y?Math.pow(t*y*e,1/t):1-Math.pow(n*y*(1-e),1/n)}g=-gammaln(t)-gammaln(n)+gammaln(t+n);for(;i<10;i++){if(p===0||p===1)return p;d=ibeta(p,t,n)-e;u=Math.exp(o*Math.log(p)+a*Math.log(1-p)+g);f=d/u;p-=u=f/(1-.5*Math.min(1,f*(o/p-a/(1-p))));p<=0&&(p=.5*(p+u));p>=1&&(p=.5*(p+u+1));if(Math.abs(u)<r*p&&i>0)break}return p}function ibeta(e,t,n){var r=e===0||e===1?0:Math.exp(gammaln(t+n)-gammaln(t)-gammaln(n)+t*Math.log(e)+n*Math.log(1-e));return!(e<0||e>1)&&(e<(t+1)/(t+n+2)?r*betacf(e,t,n)/t:1-r*betacf(1-e,n,t)/n)}function betacf(e,t,n){var r=1e-30;var o=1;var a=t+n;var i=t+1;var l=t-1;var s=1;var c=1-a*e/i;var u,f,d,p;Math.abs(c)<r&&(c=r);c=1/c;p=c;for(;o<=100;o++){u=2*o;f=o*(n-o)*e/((l+u)*(t+u));c=1+f*c;Math.abs(c)<r&&(c=r);s=1+f/s;Math.abs(s)<r&&(s=r);c=1/c;p*=c*s;f=-(t+o)*(a+o)*e/((t+u)*(i+u));c=1+f*c;Math.abs(c)<r&&(c=r);s=1+f/s;Math.abs(s)<r&&(s=r);c=1/c;d=c*s;p*=d;if(Math.abs(d-1)<3e-7)break}return p}function gammaln(e){var t=0;var n=[76.18009172947146,-86.5053203294167,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];var r=1.000000000190015;var o,a,i;i=(a=o=e)+5.5;i-=(o+.5)*Math.log(i);for(;t<6;t++)r+=n[t]/++a;return Math.log(2.506628274631*r/o)-i}function qt(e,t){var n=ibetainv(2*Math.min(e,1-e),.5*t,.5);n=Math.sqrt(t*(1-n)/n);return e>.5?n:-n}const hi={ariaLabel:"linear-regression",fill:"currentColor",fillOpacity:.1,stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class LinearRegression extends Mark{constructor(e,t={}){const{x:n,y:r,z:o,ci:a=.95,precision:i=4}=t;super(e,{x:{value:n,scale:"x"},y:{value:r,scale:"y"},z:{value:maybeZ(t),optional:true}},t,hi);this.z=o;this.ci=+a;this.precision=+i;if(!(0<=this.ci&&this.ci<1))throw new Error(`invalid ci; not in [0, 1): ${a}`);if(!(this.precision>0))throw new Error(`invalid precision: ${i}`)}render(e,t,n,r,o){const{x:a,y:i,z:l}=n;const{ci:s}=this;return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(applyTransform,this,t).call((t=>t.selectAll().data(l?groupZ(e,l,this.z):[e]).enter().call((e=>e.append("path").attr("fill","none").call(applyDirectStyles,this).call(applyGroupedChannelStyles,this,{...n,fill:null,fillOpacity:null}).attr("d",(e=>this._renderLine(e,a,i))).call(s&&!isNone(this.fill)?e=>e.select(pathBefore).attr("stroke","none").call(applyDirectStyles,this).call(applyGroupedChannelStyles,this,{...n,stroke:null,strokeOpacity:null,strokeWidth:null}).attr("d",(e=>this._renderBand(e,a,i))):()=>{}))))).node()}}function pathBefore(){return this.parentNode.insertBefore(this.ownerDocument.createElementNS(Dn.svg,"path"),this)}class LinearRegressionX extends LinearRegression{constructor(e,t){super(e,t)}_renderBand(e,t,n){const{ci:r,precision:o}=this;const[a,i]=Pt(e,(e=>n[e]));const l=linearRegressionF(e,n,t);const s=confidenceIntervalF(e,n,t,(1-r)/2,l);return yr().y((e=>e)).x0((e=>s(e,-1))).x1((e=>s(e,1)))(F(a,i-o/2,o).concat(i))}_renderLine(e,t,n){const[r,o]=Pt(e,(e=>n[e]));const a=linearRegressionF(e,n,t);return`M${a(r)},${r}L${a(o)},${o}`}}class LinearRegressionY extends LinearRegression{constructor(e,t){super(e,t)}_renderBand(e,t,n){const{ci:r,precision:o}=this;const[a,i]=Pt(e,(e=>t[e]));const l=linearRegressionF(e,t,n);const s=confidenceIntervalF(e,t,n,(1-r)/2,l);return yr().x((e=>e)).y0((e=>s(e,-1))).y1((e=>s(e,1)))(F(a,i-o/2,o).concat(i))}_renderLine(e,t,n){const[r,o]=Pt(e,(e=>t[e]));const a=linearRegressionF(e,t,n);return`M${r},${a(r)}L${o},${a(o)}`}}function linearRegressionX(e,{y:t=to,x:n=no,stroke:r,fill:o=(isNoneish(r)?"currentColor":r),...a}={}){return new LinearRegressionX(e,maybeDenseIntervalY({...a,x:n,y:t,fill:o,stroke:r}))}function linearRegressionY(e,{x:t=to,y:n=no,stroke:r,fill:o=(isNoneish(r)?"currentColor":r),...a}={}){return new LinearRegressionY(e,maybeDenseIntervalX({...a,x:t,y:n,fill:o,stroke:r}))}function linearRegressionF(e,t,n){let r=0,o=0,a=0,i=0;for(const l of e){const e=t[l];const s=n[l];r+=e;o+=s;a+=e*s;i+=e*e}const l=e.length;const s=(l*a-r*o)/(l*i-r*r);const c=(o-s*r)/l;return e=>s*e+c}function confidenceIntervalF(e,t,n,r,o){const a=ce(e,(e=>t[e]))/e.length;let i=0,l=0;for(const r of e){i+=(t[r]-a)**2;l+=(n[r]-o(t[r]))**2}const s=Math.sqrt(l/(e.length-2));const c=qt(r,e.length-2);return(t,n)=>{const r=o(t);const l=s*Math.sqrt(1/e.length+(t-a)**2/i);return r+n*c*l}}function treeNode({path:e=no,delimiter:t,frameAnchor:n,treeLayout:r=Or,treeSort:o,treeSeparation:a,treeAnchor:i,treeFilter:l,...s}={}){i=maybeTreeAnchor(i);o=maybeTreeSort(o);l!=null&&(l=maybeNodeValue(l));n===void 0&&(n=i.frameAnchor);const c=normalizer(t);const u=treeOutputs(s,maybeNodeValue);const[f,d]=column();const[p,h]=column();return{x:f,y:p,frameAnchor:n,...basic(s,((t,n)=>{const s=c(valueof(t,e));const f=d([]);const p=h([]);let m=-1;const y=[];const g=[];const b=Cr().path((e=>s[e]));const x=isArray(t)?e=>e.data=t[e.data]:e=>e.data=t.get(e.data);const w=r();w.nodeSize&&w.nodeSize([1,1]);w.separation&&a!==void 0&&w.separation(a??one);for(const e of u)e[wi]=e[vi]([]);for(const e of n){const t=[];const n=b(e.filter((e=>s[e]!=null))).each(x);o!=null&&n.sort(o);w(n);for(const e of n.descendants())if(l==null||l(e)){t.push(++m);y[m]=e.data;i.position(e,m,f,p);for(const t of u)t[wi][m]=t[xi](e)}g.push(t)}return{data:y,facets:g}})),...Object.fromEntries(u)}}function treeLink({path:e=no,delimiter:t,curve:n="bump-x",stroke:r="#555",strokeWidth:o=1.5,strokeOpacity:a=.5,treeLayout:i=Or,treeSort:l,treeSeparation:s,treeAnchor:c,treeFilter:u,...f}={}){c=maybeTreeAnchor(c);l=maybeTreeSort(l);u!=null&&(u=maybeLinkValue(u));f={curve:n,stroke:r,strokeWidth:o,strokeOpacity:a,...f};const d=normalizer(t);const p=treeOutputs(f,maybeLinkValue);const[h,m]=column();const[y,g]=column();const[b,x]=column();const[w,k]=column();return{x1:h,x2:y,y1:b,y2:w,...basic(f,((t,n)=>{const r=d(valueof(t,e));const o=m([]);const a=g([]);const f=x([]);const h=k([]);let y=-1;const b=[];const w=[];const S=Cr().path((e=>r[e]));const A=i();A.nodeSize&&A.nodeSize([1,1]);A.separation&&s!==void 0&&A.separation(s??one);for(const e of p)e[wi]=e[vi]([]);for(const e of n){const n=[];const i=S(e.filter((e=>r[e]!=null))).each((e=>e.data=t[e.data]));l!=null&&i.sort(l);A(i);for(const{source:e,target:t}of i.links())if(u==null||u(t,e)){n.push(++y);b[y]=t.data;c.position(e,y,o,f);c.position(t,y,a,h);for(const n of p)n[wi][y]=n[xi](t,e)}w.push(n)}return{data:b,facets:w}})),...Object.fromEntries(p)}}function maybeTreeAnchor(e="left"){switch(`${e}`.trim().toLowerCase()){case"left":return mi;case"right":return yi}throw new Error(`invalid tree anchor: ${e}`)}const mi={frameAnchor:"left",dx:6,position({x:e,y:t},n,r,o){r[n]=t;o[n]=-e}};const yi={frameAnchor:"right",dx:-6,position({x:e,y:t},n,r,o){r[n]=-t;o[n]=-e}};function maybeTreeSort(e){return e==null||typeof e==="function"?e:`${e}`.trim().toLowerCase().startsWith("node:")?nodeSort(maybeNodeValue(e)):nodeSort(nodeData(e))}function nodeSort(e){return(t,n)=>ascendingDefined(e(t),e(n))}function nodeData(e){return t=>t.data?.[e]}function normalizer(e="/"){e=`${e}`;if(e==="/")return e=>e;if(e.length!==1)throw new Error("delimiter must be exactly one character");const t=e.charCodeAt(0);return e=>e.map((e=>slashDelimiter(e,t)))}const gi=92;const bi=47;function slashDelimiter(e,t){if(t===gi)throw new Error("delimiter cannot be backslash");let n=false;for(let r=0,o=e.length;r<o;++r){switch(e.charCodeAt(r)){case gi:if(!n){n=true;continue}break;case t:n?(e=e.slice(0,r-1)+e.slice(r),--r,--o):e=e.slice(0,r)+"/"+e.slice(r+1);break;case bi:n?(e=e.slice(0,r)+"\\\\"+e.slice(r),r+=2,o+=2):(e=e.slice(0,r)+"\\"+e.slice(r),++r,++o);break}n=false}return e}function slashUnescape(e){let t=false;for(let n=0,r=e.length;n<r;++n){switch(e.charCodeAt(n)){case gi:if(!t){t=true;continue}case bi:t&&(e=e.slice(0,n-1)+e.slice(n),--n,--r);break}t=false}return e}function isNodeValue(e){return isObject(e)&&typeof e.node==="function"}function isLinkValue(e){return isObject(e)&&typeof e.link==="function"}function maybeNodeValue(e){if(isNodeValue(e))return e.node;e=`${e}`.trim().toLowerCase();if(e.startsWith("node:")){switch(e){case"node:name":return nodeName;case"node:path":return nodePath;case"node:internal":return nodeInternal;case"node:external":return nodeExternal;case"node:depth":return nodeDepth;case"node:height":return nodeHeight}throw new Error(`invalid node value: ${e}`)}}function maybeLinkValue(e){if(isNodeValue(e))return e.node;if(isLinkValue(e))return e.link;e=`${e}`.trim().toLowerCase();if(e.startsWith("node:")||e.startsWith("parent:")){switch(e){case"parent:name":return parentValue(nodeName);case"parent:path":return parentValue(nodePath);case"parent:depth":return parentValue(nodeDepth);case"parent:height":return parentValue(nodeHeight);case"node:name":return nodeName;case"node:path":return nodePath;case"node:internal":return nodeInternal;case"node:external":return nodeExternal;case"node:depth":return nodeDepth;case"node:height":return nodeHeight}throw new Error(`invalid link value: ${e}`)}}function nodePath(e){return e.id}function nodeName(e){return nameof(e.id)}function nodeDepth(e){return e.depth}function nodeHeight(e){return e.height}function nodeInternal(e){return!!e.children}function nodeExternal(e){return!e.children}function parentValue(e){return(t,n)=>n==null?void 0:e(n)}function nameof(e){let t=e.length;while(--t>0)if(slash(e,t))break;return slashUnescape(e.slice(t+1))}function slash(e,t){if(e[t]==="/"){let n=0;while(t>0&&e[--t]==="\\")++n;if((n&1)===0)return true}return false}const vi=2;const xi=3;const wi=4;function treeOutputs(e,t){const n=[];for(const r in e){const o=e[r];const a=t(o);a!==void 0&&n.push([r,...column(o),a])}return n}function tree(e,{fill:t,stroke:n,strokeWidth:r,strokeOpacity:o,strokeLinejoin:a,strokeLinecap:i,strokeMiterlimit:l,strokeDasharray:s,strokeDashoffset:c,marker:u,markerStart:f=u,markerEnd:d=u,dot:p=isNoneish(f)&&isNoneish(d),text:h="node:name",textStroke:m="var(--plot-background)",title:y="node:path",dx:g,dy:b,textAnchor:x,treeLayout:w=Or,textLayout:k=(w===Or||w===Ir?"mirrored":"normal"),tip:S,...A}={}){g===void 0&&(g=maybeTreeAnchor(A.treeAnchor).dx);if(x!==void 0)throw new Error("textAnchor is not a configurable tree option");k=keyword(k,"textLayout",["mirrored","normal"]);function treeText(n){return text(e,treeNode({treeLayout:w,text:h,fill:t===void 0?"currentColor":t,stroke:m,dx:g,dy:b,title:y,...n,...A}))}return marks(link(e,treeLink({treeLayout:w,markerStart:f,markerEnd:d,stroke:n!==void 0?n:t===void 0?"node:internal":t,strokeWidth:r,strokeOpacity:o,strokeLinejoin:a,strokeLinecap:i,strokeMiterlimit:l,strokeDasharray:s,strokeDashoffset:c,...A})),p?dot(e,treeNode({treeLayout:w,fill:t===void 0?"node:internal":t,title:y,tip:S,...A})):null,h!=null?k==="mirrored"?[treeText({textAnchor:"start",treeFilter:"node:external"}),treeText({textAnchor:"end",treeFilter:"node:internal",dx:-g})]:treeText():null)}function cluster(e,t){return tree(e,{...t,treeLayout:Ir})}const ki={ariaLabel:"waffle"};class WaffleX extends BarX{constructor(e,{unit:t=1,gap:n=1,round:r,multiple:o,...a}={}){super(e,wafflePolygon("x",a),ki);this.unit=Math.max(0,t);this.gap=+n;this.round=maybeRound(r);this.multiple=maybeMultiple(o)}}class WaffleY extends BarY{constructor(e,{unit:t=1,gap:n=1,round:r,multiple:o,...a}={}){super(e,wafflePolygon("y",a),ki);this.unit=Math.max(0,t);this.gap=+n;this.round=maybeRound(r);this.multiple=maybeMultiple(o)}}function wafflePolygon(e,t){const n=e==="y"?"x":"y";const r=`${e}1`;const o=`${e}2`;return initializer(waffleRender(t),(function(t,a,i,l,s){const{round:c,unit:u}=this;const f=i[r].value;const d=i[o].value;const p=valueObject({...n in i&&{[n]:i[n]},[r]:i[r],[o]:i[o]},l);const h=this[e==="y"?"_width":"_height"](l,p,s);const m=this[e==="y"?"_x":"_y"](l,p,s);const y=u*scaleof(l.scales[e]);const{multiple:g=Math.max(1,Math.floor(Math.sqrt(h/y)))}=this;const b=Math.min(h/g,y*g);const x=y*g;const w=(h-g*b)/2;const k=typeof m==="function"?e=>m(e)+w:m+w;const S=l[e](0);const A=e==="y"?([e,t])=>[e*b,-t*x]:([e,t])=>[t*x,e*b];const $=typeof k==="function"?e=>k(e)-h/2:()=>k;const[M,T]=e==="y"?[0,1]:[1,0];const C=d.length;const O=new Array(C);const I=new Float64Array(C);const L=new Float64Array(C);for(let e=0;e<C;++e){O[e]=wafflePoints(c(f[e]/u),c(d[e]/u),g).map(A);const t=O[e].pop();I[e]=t[M]+$(e);L[e]=t[T]+S}return{channels:{polygon:{value:O,source:null,filter:null},[`c${n}`]:{value:[b,k],source:null,filter:null},[`c${e}`]:{value:[x,S],source:null,filter:null},[n]:{value:I,scale:null,source:null},[r]:{value:L,scale:null,source:i[r]},[o]:{value:L,scale:null,source:i[o]}}}}))}function waffleRender({render:e,...t}){return{...t,render:composeRender(e,(function(e,t,n,r,o){const{gap:a,rx:i,ry:l}=this;const{channels:s,ariaLabel:c,href:u,title:f,...d}=n;const{document:p}=o;const h=s.polygon.value;const[m,y]=s.cx.value;const[g,b]=s.cy.value;const x=getPatternId();const w=p.createElementNS(Dn.svg,"pattern");w.setAttribute("width",m);w.setAttribute("height",g);w.setAttribute("patternUnits","userSpaceOnUse");const k=w.appendChild(p.createElementNS(Dn.svg,"rect"));k.setAttribute("x",a/2);k.setAttribute("y",a/2);k.setAttribute("width",m-a);k.setAttribute("height",g-a);i!=null&&k.setAttribute("rx",i);l!=null&&k.setAttribute("ry",l);return create("svg:g",o).call(applyIndirectStyles,this,r,o).call(this._transform,this,t).call((t=>t.selectAll().data(e).enter().append((()=>w.cloneNode(true))).attr("id",(e=>`${x}-${e}`)).select("rect").call(applyDirectStyles,this).call(applyChannelStyles,this,d))).call((t=>t.selectAll().data(e).enter().append("path").attr("transform",template`translate(${y},${b})`).attr("d",(e=>`M${h[e].join("L")}Z`)).attr("fill",(e=>`url(#${x}-${e})`)).attr("stroke",this.stroke==null?null:"none").call(applyChannelStyles,this,{ariaLabel:c,href:u,title:f}))).node()}))}}function wafflePoints(e,t,n){if(t<e)return wafflePoints(t,e,n);if(e<0)return wafflePointsOffset(e,t,n,Math.ceil(-Math.min(e,t)/n));const r=Math.floor(e%n);const o=Math.ceil(e%n);const a=Math.floor(t%n);const i=Math.ceil(t%n);const l=Math.floor(e/n);const s=Math.ceil(e/n);const c=Math.floor(t/n);const u=Math.ceil(t/n);const f=[];u>s&&f.push([0,s]);f.push([r,s],[r,l+e%1],[o,l+e%1]);if(!(e%n>n-1)){f.push([o,l]);c>l&&f.push([n,l])}c>l&&f.push([n,c]);f.push([i,c],[i,c+t%1],[a,c+t%1]);if(!(t%n<1)){f.push([a,u]);u>s&&f.push([0,u])}f.push(waffleCentroid(e,t,n));return f}function wafflePointsOffset(e,t,n,r){return wafflePoints(e+r*n,t+r*n,n).map((([e,t])=>[e,t-r]))}function waffleCentroid(e,t,n){const r=Math.floor(t/n)-Math.floor(e/n);return r===0?waffleRowCentroid(e,t,n):r===1?Math.floor(t%n)>Math.ceil(e%n)?[(Math.floor(t%n)+Math.ceil(e%n))/2,Math.floor(t/n)]:t%n>n-e%n?waffleRowCentroid(t-t%n,t,n):waffleRowCentroid(e,n*Math.ceil(e/n),n):[n/2,(Math.round(e/n)+Math.round(t/n))/2]}function waffleRowCentroid(e,t,n){const r=Math.floor(t)-Math.floor(e);return r===0?[Math.floor(e%n)+.5,Math.floor(e/n)+(e+t)/2%1]:r===1?t%1-e%1>.5?[Math.ceil(e%n),Math.floor(t/n)+(e%1+t%1)/2]:t%1>1-e%1?[Math.floor(t%n)+.5,Math.floor(t/n)+t%1/2]:[Math.floor(e%n)+.5,Math.floor(e/n)+(1+e%1)/2]:[Math.ceil(e%n)+Math.ceil(Math.floor(t)-Math.ceil(e))/2,Math.floor(e/n)+(t>=1+e?.5:(e+t)/2%1)]}function maybeRound(e){if(e===void 0||e===false)return Number;if(e===true)return Math.round;if(typeof e!=="function")throw new Error(`invalid round: ${e}`);return e}function maybeMultiple(e){return e===void 0?void 0:Math.max(1,Math.floor(e))}function scaleof({domain:e,range:t}){return spread(t)/spread(e)}function spread(e){const[t,n]=Pt(e);return n-t}function waffleX(e,{tip:t,...n}={}){hasXY(n)||(n={...n,y:to,x2:no});return new WaffleX(e,{tip:waffleTip(t),...maybeStackX(maybeIntervalX(maybeIdentityX(n)))})}function waffleY(e,{tip:t,...n}={}){hasXY(n)||(n={...n,x:to,y2:no});return new WaffleY(e,{tip:waffleTip(t),...maybeStackY(maybeIntervalY(maybeIdentityY(n)))})}function waffleTip(e){return e===true?{maxRadius:Infinity}:isObject(e)&&e.maxRadius===void 0?{...e,maxRadius:Infinity}:void 0}const anchorXLeft=({marginLeft:e})=>[1,e];const anchorXRight=({width:e,marginRight:t})=>[-1,e-t];const anchorXMiddle=({width:e,marginLeft:t,marginRight:n})=>[0,(t+e-n)/2];const anchorYTop=({marginTop:e})=>[1,e];const anchorYBottom=({height:e,marginBottom:t})=>[-1,e-t];const anchorYMiddle=({height:e,marginTop:t,marginBottom:n})=>[0,(t+e-n)/2];function maybeAnchor(e){return typeof e==="string"?{anchor:e}:e}function dodgeX(e={},t={}){arguments.length===1&&([e,t]=mergeOptions(e));let{anchor:n="left",padding:r=1,r:o=t.r}=maybeAnchor(e);switch(`${n}`.toLowerCase()){case"left":n=anchorXLeft;break;case"right":n=anchorXRight;break;case"middle":n=anchorXMiddle;break;default:throw new Error(`unknown dodge anchor: ${n}`)}return dodge("x","y",n,number$1(r),o,t)}function dodgeY(e={},t={}){arguments.length===1&&([e,t]=mergeOptions(e));let{anchor:n="bottom",padding:r=1,r:o=t.r}=maybeAnchor(e);switch(`${n}`.toLowerCase()){case"top":n=anchorYTop;break;case"bottom":n=anchorYBottom;break;case"middle":n=anchorYMiddle;break;default:throw new Error(`unknown dodge anchor: ${n}`)}return dodge("y","x",n,number$1(r),o,t)}function mergeOptions(e){const{anchor:t,padding:n,...r}=e;const{r:o}=r;return[{anchor:t,padding:n,r:o},r]}function dodge(e,t,n,r,o,a){if(o!=null&&typeof o!=="number"){let{channels:e,sort:t,reverse:n}=a;e=maybeNamed(e);e?.r===void 0&&(a={...a,channels:{...e,r:{value:o,scale:"r"}}});t===void 0&&n===void 0&&(a.sort={channel:"-r"})}return initializer(a,(function(a,i,l,s,c,u){let{[t]:f,r:d}=l;if(!l[t])throw new Error(`missing channel: ${t}`);({[t]:f}=applyPosition(l,s,u));const p=d?void 0:o!==void 0?number$1(o):this.r!==void 0?this.r:3;d&&(d=valueof(d.value,s[d.scale]||no,Float64Array));let[h,m]=n(c);const y=h?compareAscending:compareSymmetric;const g=new Float64Array(f.length);const b=d?e=>d[e]:()=>p;for(let e of i){const t=zr();e=e.filter(d?e=>finite$1(f[e])&&positive(d[e]):e=>finite$1(f[e]));const n=new Float64Array(2*e.length+2);for(const o of e){const e=b(o);const a=h?e+r:0;const i=f[o]-e;const l=f[o]+e;let s=2;t.queryInterval(i-r,l+r,(([,,e])=>{const t=g[e]-a;const i=f[o]-f[e];const l=r+(d?d[o]+d[e]:2*p);const c=Math.sqrt(l*l-i*i);n[s++]=t-c;n[s++]=t+c}));let c=n.slice(0,s);h&&(c=c.filter((e=>e>=0)));e:for(const e of c.sort(y)){for(let t=0;t<s;t+=2)if(n[t]+1e-6<e&&e<n[t+1]-1e-6)continue e;g[o]=e+a;break}t.insert([i,l,o])}}h||(h=1);for(const e of i)for(const t of e)g[t]=g[t]*h+m;return{data:a,facets:i,channels:{[e]:{value:g,source:null},[t]:{value:f,source:l[t]},...d&&{r:{value:d,source:l.r}}}}}))}function compareSymmetric(e,t){return Math.abs(e)-Math.abs(t)}function compareAscending(e,t){return e-t}function normalizeX(e,t){arguments.length===1&&({basis:e,...t}=e);return mapX(normalize(e),t)}function normalizeY(e,t){arguments.length===1&&({basis:e,...t}=e);return mapY(normalize(e),t)}function normalize(e){if(e===void 0)return Ai;if(typeof e==="function")return normalizeBasis(taker(e));if(/^p\d{2}$/i.test(e))return normalizeAccessor(percentile(e));switch(`${e}`.toLowerCase()){case"deviation":return Mi;case"first":return Ai;case"last":return $i;case"max":return Ti;case"mean":return Ci;case"median":return Oi;case"min":return Ii;case"sum":return Li;case"extent":return Si}throw new Error(`invalid basis: ${e}`)}function normalizeBasis(e){return{mapIndex(t,n,r){const o=+e(t,n);for(const e of t)r[e]=n[e]===null?NaN:n[e]/o}}}function normalizeAccessor(e){return normalizeBasis(((t,n)=>e(t,(e=>n[e]))))}const Si={mapIndex(e,t,n){const[r,o]=Pt(e,(e=>t[e]));const a=o-r;for(const o of e)n[o]=t[o]===null?NaN:(t[o]-r)/a}};const Ai=normalizeBasis(((e,t)=>{for(let n=0;n<e.length;++n){const r=t[e[n]];if(defined(r))return r}}));const $i=normalizeBasis(((e,t)=>{for(let n=e.length-1;n>=0;--n){const r=t[e[n]];if(defined(r))return r}}));const Mi={mapIndex(e,t,n){const r=ne(e,(e=>t[e]));const o=ie(e,(e=>t[e]));for(const a of e)n[a]=t[a]===null?NaN:o?(t[a]-r)/o:0}};const Ti=normalizeAccessor(z);const Ci=normalizeAccessor(ne);const Oi=normalizeAccessor(te);const Ii=normalizeAccessor(ae);const Li=normalizeAccessor(ce);function shiftX(e,t){return shiftK("x",e,t)}function shiftY(e,t){return shiftK("y",e,t)}function shiftK(e,t,n={}){let r;let o=1;if(typeof t==="number"){o=t;r=(e,t)=>+e+t}else{if(typeof t==="string"){const e=t.startsWith("-")?-1:1;[t,o]=parseTimeInterval(t.replace(/^[+-]/,""));o*=e}t=maybeInterval(t);r=(e,n)=>t.offset(e,n)}const a=`${e}1`;const i=`${e}2`;const l=map({[a]:e=>e.map((e=>r(e,o))),[i]:e=>e},n);const s=l[i].transform;l[i].transform=()=>{const e=s();const[t,n]=Pt(e);e.domain=o<0?[t,r(n,o)]:[r(t,o),n];return e};return l}function select(e,t={}){if(typeof e==="string")switch(e.toLowerCase()){case"first":return selectFirst(t);case"last":return selectLast(t)}if(typeof e==="function")return selectChannel(null,e,t);let n,r;for(n in e){if(r!==void 0)throw new Error("ambiguous selector; multiple inputs");r=maybeSelector(e[n])}if(r===void 0)throw new Error(`invalid selector: ${e}`);return selectChannel(n,r,t)}function maybeSelector(e){if(typeof e==="function")return e;switch(`${e}`.toLowerCase()){case"min":return selectorMin;case"max":return selectorMax}throw new Error(`unknown selector: ${e}`)}function selectFirst(e){return selectChannel(null,selectorFirst,e)}function selectLast(e){return selectChannel(null,selectorLast,e)}function selectMinX(e){return selectChannel("x",selectorMin,e)}function selectMinY(e){return selectChannel("y",selectorMin,e)}function selectMaxX(e){return selectChannel("x",selectorMax,e)}function selectMaxY(e){return selectChannel("y",selectorMax,e)}function*selectorFirst(e){yield e[0]}function*selectorLast(e){yield e[e.length-1]}function*selectorMin(e,t){yield Lr(e,(e=>t[e]))}function*selectorMax(e,t){yield Pn(e,(e=>t[e]))}function selectChannel(e,t,n){if(e!=null){if(n[e]==null)throw new Error(`missing channel: ${e}`);e=n[e]}const r=maybeZ(n);return basic(n,((n,o)=>{const a=valueof(n,r);const i=valueof(n,e);const l=[];for(const e of o){const n=[];for(const r of a?Q(e,(e=>a[e])).values():[e])for(const e of t(r,i))n.push(e);l.push(n)}return{data:n,facets:l}}))}Mark.prototype.plot=function({marks:e=[],...t}={}){return plot({...t,marks:[...e,this]})};export{Area,Arrow,BarX,BarY,Cell,Contour,Density,Dot,Frame,Geo,Hexgrid,Image,Line,Link,Mark,Raster,Rect,RuleX,RuleY,Text,TickX,TickY,Tip,Vector,WaffleX,WaffleY,area,areaX,areaY,arrow,auto,autoSpec,axisFx,axisFy,axisX,axisY,barX,barY,bin,binX,binY,bollinger,bollingerX,bollingerY,boxX,boxY,cell,cellX,cellY,centroid,circle,cluster,column,contour,crosshair,crosshairX,crosshairY,delaunayLink,delaunayMesh,density,differenceX,differenceY,dodgeX,dodgeY,dot,dotX,dotY,filter,find,formatIsoDate,formatMonth,formatNumber,formatWeekday,frame,geo,geoCentroid,graticule,gridFx,gridFy,gridX,gridY,group,groupX,groupY,groupZ$1 as groupZ,hexagon,hexbin,hexgrid,hull,no as identity,image,to as indexOf,initializer,interpolateNearest,interpolateNone,interpolatorBarycentric,interpolatorRandomWalk,legend,line,lineX,lineY,linearRegressionX,linearRegressionY,link,map,mapX,mapY,marks,normalize,normalizeX,normalizeY,numberInterval,plot,pointer,pointerX,pointerY,raster,rect,rectX,rectY,reverse,ruleX,ruleY,scale,select,selectFirst,selectLast,selectMaxX,selectMaxY,selectMinX,selectMinY,shiftX,shiftY,shuffle,sort,sphere,spike,stackX,stackX1,stackX2,stackY,stackY1,stackY2,text,textX,textY,tickX,tickY,timeInterval,tip,basic as transform,tree,treeLink,treeNode,utcInterval,valueof,vector,vectorX,vectorY,voronoi,voronoiMesh,waffleX,waffleY,window$1 as window,windowX,windowY};

