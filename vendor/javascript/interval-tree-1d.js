// interval-tree-1d@1.0.4 downloaded from https://ga.jspm.io/npm:interval-tree-1d@1.0.4/interval-tree.js

import*as t from"binary-search-bounds";var i="default"in t?t.default:t;var r={};var e=i;var n=0;var h=1;var s=2;r=createWrapper;function IntervalTreeNode(t,i,r,e,n){this.mid=t;this.left=i;this.right=r;this.leftPoints=e;this.rightPoints=n;this.count=(i?i.count:0)+(r?r.count:0)+e.length}var o=IntervalTreeNode.prototype;function copy(t,i){t.mid=i.mid;t.left=i.left;t.right=i.right;t.leftPoints=i.leftPoints;t.rightPoints=i.rightPoints;t.count=i.count}function rebuild(t,i){var r=createIntervalTree(i);t.mid=r.mid;t.left=r.left;t.right=r.right;t.leftPoints=r.leftPoints;t.rightPoints=r.rightPoints;t.count=r.count}function rebuildWithInterval(t,i){var r=t.intervals([]);r.push(i);rebuild(t,r)}function rebuildWithoutInterval(t,i){var r=t.intervals([]);var e=r.indexOf(i);if(e<0)return n;r.splice(e,1);rebuild(t,r);return h}o.intervals=function(t){t.push.apply(t,this.leftPoints);this.left&&this.left.intervals(t);this.right&&this.right.intervals(t);return t};o.insert=function(t){var i=this.count-this.leftPoints.length;this.count+=1;if(t[1]<this.mid)this.left?4*(this.left.count+1)>3*(i+1)?rebuildWithInterval(this,t):this.left.insert(t):this.left=createIntervalTree([t]);else if(t[0]>this.mid)this.right?4*(this.right.count+1)>3*(i+1)?rebuildWithInterval(this,t):this.right.insert(t):this.right=createIntervalTree([t]);else{var r=e.ge(this.leftPoints,t,compareBegin);var n=e.ge(this.rightPoints,t,compareEnd);this.leftPoints.splice(r,0,t);this.rightPoints.splice(n,0,t)}};o.remove=function(t){var i=this.count-this.leftPoints;if(t[1]<this.mid){if(!this.left)return n;var r=this.right?this.right.count:0;if(4*r>3*(i-1))return rebuildWithoutInterval(this,t);var o=this.left.remove(t);if(o===s){this.left=null;this.count-=1;return h}o===h&&(this.count-=1);return o}if(t[0]>this.mid){if(!this.right)return n;var l=this.left?this.left.count:0;if(4*l>3*(i-1))return rebuildWithoutInterval(this,t);o=this.right.remove(t);if(o===s){this.right=null;this.count-=1;return h}o===h&&(this.count-=1);return o}if(1===this.count)return this.leftPoints[0]===t?s:n;if(1===this.leftPoints.length&&this.leftPoints[0]===t){if(this.left&&this.right){var f=this;var u=this.left;while(u.right){f=u;u=u.right}if(f===this)u.right=this.right;else{var a=this.left;o=this.right;f.count-=u.count;f.right=u.left;u.left=a;u.right=o}copy(this,u);this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?copy(this,this.left):copy(this,this.right);return h}for(a=e.ge(this.leftPoints,t,compareBegin);a<this.leftPoints.length;++a){if(this.leftPoints[a][0]!==t[0])break;if(this.leftPoints[a]===t){this.count-=1;this.leftPoints.splice(a,1);for(o=e.ge(this.rightPoints,t,compareEnd);o<this.rightPoints.length;++o){if(this.rightPoints[o][1]!==t[1])break;if(this.rightPoints[o]===t){this.rightPoints.splice(o,1);return h}}}}return n};function reportLeftRange(t,i,r){for(var e=0;e<t.length&&t[e][0]<=i;++e){var n=r(t[e]);if(n)return n}}function reportRightRange(t,i,r){for(var e=t.length-1;e>=0&&t[e][1]>=i;--e){var n=r(t[e]);if(n)return n}}function reportRange(t,i){for(var r=0;r<t.length;++r){var e=i(t[r]);if(e)return e}}o.queryPoint=function(t,i){if(t<this.mid){if(this.left){var r=this.left.queryPoint(t,i);if(r)return r}return reportLeftRange(this.leftPoints,t,i)}if(t>this.mid){if(this.right){r=this.right.queryPoint(t,i);if(r)return r}return reportRightRange(this.rightPoints,t,i)}return reportRange(this.leftPoints,i)};o.queryInterval=function(t,i,r){if(t<this.mid&&this.left){var e=this.left.queryInterval(t,i,r);if(e)return e}if(i>this.mid&&this.right){e=this.right.queryInterval(t,i,r);if(e)return e}return i<this.mid?reportLeftRange(this.leftPoints,i,r):t>this.mid?reportRightRange(this.rightPoints,t,r):reportRange(this.leftPoints,r)};function compareNumbers(t,i){return t-i}function compareBegin(t,i){var r=t[0]-i[0];return r||t[1]-i[1]}function compareEnd(t,i){var r=t[1]-i[1];return r||t[0]-i[0]}function createIntervalTree(t){if(0===t.length)return null;var i=[];for(var r=0;r<t.length;++r)i.push(t[r][0],t[r][1]);i.sort(compareNumbers);var e=i[i.length>>1];var n=[];var h=[];var s=[];for(r=0;r<t.length;++r){var o=t[r];o[1]<e?n.push(o):e<o[0]?h.push(o):s.push(o)}var l=s;var f=s.slice();l.sort(compareBegin);f.sort(compareEnd);return new IntervalTreeNode(e,createIntervalTree(n),createIntervalTree(h),l,f)}function IntervalTree(t){this.root=t}var l=IntervalTree.prototype;l.insert=function(t){this.root?this.root.insert(t):this.root=new IntervalTreeNode(t[0],null,null,[t],[t])};l.remove=function(t){if(this.root){var i=this.root.remove(t);i===s&&(this.root=null);return i!==n}return false};l.queryPoint=function(t,i){if(this.root)return this.root.queryPoint(t,i)};l.queryInterval=function(t,i,r){if(t<=i&&this.root)return this.root.queryInterval(t,i,r)};Object.defineProperty(l,"count",{get:function(){return this.root?this.root.count:0}});Object.defineProperty(l,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}});function createWrapper(t){return t&&0!==t.length?new IntervalTree(createIntervalTree(t)):new IntervalTree(null)}var f=r;export default f;

