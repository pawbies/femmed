<div class="w-full">
  <h1 class="font-bold text-4xl">Timeline</h1>

  <%= render "partials/nav", links: [["Home", root_path], ["Timeline", timeline_path], ["Calendar", calendar_path]] %>

  <div class="flex items-center gap-4 mb-8">

    <%= link_to timeline_path(date: @date - 1.day), class: "p-2 rounded-lg border border-rose-200 hover:bg-rose-50 text-rose-400 transition-colors" do %>
      &#8592;
    <% end %>

    <%= form_with url: timeline_path, method: :get, class: "flex items-center" do |f| %>
      <%= f.date_field :date, value: @date,
          onchange: "this.form.submit()",
          class: "border border-rose-200 bg-rose-50 rounded-lg px-3 py-1.5 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-rose-300" %>
    <% end %>

    <%= link_to timeline_path(date: @date + 1.day), class: "p-2 rounded-lg border border-rose-200 hover:bg-rose-50 text-rose-400 transition-colors #{'opacity-30 pointer-events-none' if @date >= Date.today}" do %>
      &#8594;
    <% end %>
  </div>

  <p class="text-rose-400 mt-2 mb-8"><%= @date.strftime("%B %e, %Y") %></p>

  <div class="relative md:w-2/5">
    <div class="absolute left-16 top-0 bottom-0 w-px bg-rose-100"></div>

    <div class="space-y-1">
      <% (0..23).each do |hour| %>
        <div class="flex gap-4 items-start">

          <div class="w-12 text-right shrink-0 pt-2">
            <span class="text-xs font-medium text-gray-400"><%= "%02d:00" % hour %></span>
          </div>

          <div class="shrink-0 pt-2.5 z-10">
            <% if @doses_by_hour[hour].any? %>
              <div class="w-3 h-3 rounded-full bg-rose-400 ring-2 ring-rose-100"></div>
            <% else %>
              <div class="w-3 h-3 rounded-full bg-rose-100"></div>
            <% end %>
          </div>

          <div class="flex-1 pb-2">
            <% if @doses_by_hour[hour].any? %>
              <div class="flex flex-col gap-1">
                <% @doses_by_hour[hour].each do |dose| %>
                  <div class="bg-white border border-rose-200 rounded-xl px-4 py-2 shadow-sm flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-800"><%= dose.prescription.full_name %></span>
                    <span class="ml-2 text-xs bg-rose-100 text-rose-500 font-medium px-2 py-1 rounded-full">
                      Ã— <%= format("%g", dose.amount_taken) %>
                    </span>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="h-6"></div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
